(()=>{var Is=Object.defineProperty;var As=(r,e,t)=>e in r?Is(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var l=(r,e,t)=>(As(r,typeof e!="symbol"?e+"":e,t),t),wi=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var i=(r,e,t)=>(wi(r,e,"read from private field"),t?t.call(r):e.get(r)),o=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},d=(r,e,t,s)=>(wi(r,e,"write to private field"),s?s.call(r,t):e.set(r,t),t);var h=(r,e,t)=>(wi(r,e,"access private method"),t);var S=(r,e)=>({code:r,emit:t=>{let s=r<80?"error":"warn",n=`[WUSE:${s.toUpperCase()}] ${r} | ${e(t)}`;if(window.Wuse&&window.Wuse.FATALS||r<10)throw new window.Error(n);return window.console[s](n),null}}),y=class{static get UNKNOWN_ERROR(){return S(0,e=>"Unknown error.")}static get UNSUPPORTED_FEATURE(){return S(1,e=>`Unsupported feature: ${e}.`)}static get UNREGISTERED_CLASS(){return S(2,e=>`Unregistered class: ${e}.`)}static get UNREGISTRABLE_CLASS(){return S(3,e=>`Unregistrable class: ${e}.`)}static get INVALID_CLASS(){return S(4,e=>`Invalid class: ${e}.`)}static get MISNAMED_CLASS(){return S(5,e=>`Misnamed class: ${e}.`)}static get INVALID_DEFINITION(){return S(10,e=>`Invalid definition: ${e}.`)}static get INVALID_ID(){return S(11,e=>`Invalid id: ${e}.`)}static get INVALID_KEY(){return S(12,e=>"Call first: this.setElementsStoreKey(<your-valid-key>).")}static get ALLOW_HTML(){return S(13,e=>"Call first: this.allowRawContent(true).")}static get INVALID_STATE(){return S(14,e=>"Invalid state.")}static get TAKEN_ID(){return S(15,e=>`Taken id: ${e}.`)}static get INEXISTENT_TEMPLATE(){return S(20,e=>`Inexistent template: #${e}.`)}static get EXTINCT_TEMPLATE(){return S(21,e=>`Extinct template: #${e}.`)}static get INVALID_TEMPLATE(){return S(22,e=>`Invalid template: #${e}.`)}static get UNESPECIFIED_SLOT(){return S(30,e=>`Unespecified slot: #${e}.`)}static get LOCKED_DEFINITION(){return S(40,e=>`Locked definition: #${e}.`)}static get UNKNOWN_TAG(){return S(80,e=>`Unknown tag: ${e}.`)}static get BAD_TARGET(){return S(81,e=>`Bad target: ${e}.`)}static get ALREADY_REGISTERED(){return S(90,e=>`Already registered: ${e}.`)}};var ke,Ue,ki=(r,e)=>(typeof e=="function"&&e(r),r),p=class{static get EMPTY_STRING(){return i(this,ke)}static get EMPTY_ARRAY(){return i(this,Ue)}static noop(){}static isNonEmptyString(e){return typeof e=="string"&&!!e.length}static forcedStringSplit(e,t){return typeof e=="string"?e.split(t):new window.Array}static buildArray(e){return ki(new window.Array,e)}static buildObject(e){return ki(new window.Object,e)}static ensureFunction(e,t=()=>{}){return typeof e=="function"?e:t}static isOf(e,t){return e!=null&&(e.constructor===t||t!=null&&e.constructor.name===t.name)}static areOf(e,t){var s=!!(e&&e.constructor===window.Array&&!!e.length);if(s)for(var n in e){let a=e[n];if(!(a!=null&&(a.constructor===t||t!=null&&a.constructor.name===t.name))){s=!1;break}}return s}static hasObjectKeys(e){return!!(e&&!!window.Object.keys(e).length)}static cloneObject(e){return window.Object.assign(new window.Object,e)}static forEachOwnProperty(e,t){e&&window.Object.getOwnPropertyNames(e).forEach(t)}static isAssignedObject(e){return typeof e=="object"&&e!==null}static isAssignedArray(e){return typeof e=="object"&&e!==null&&e.constructor.name==="Array"}static isNonEmptyArray(e){return typeof e=="object"&&e!==null&&e.constructor.name==="Array"&&!!e.length}static isIntegerNumber(e){return(typeof e=="number"||typeof e=="string"&&!!e.length)&&window.Number.isInteger(window.Number(e))}};ke=new WeakMap,Ue=new WeakMap,o(p,ke,new window.String().valueOf()),o(p,Ue,window.Object.freeze(new window.Array));var Ot,Nt,{noop:Ui,ensureFunction:Wi,isAssignedObject:Ss}=p,rt=class{static fetch(e){let t=window.document.getElementById(e);return t===null?i(this,Ot).call(this,e):t.tagName!=="TEMPLATE"?i(this,Nt).call(this,e):t.innerHTML}static initialize(e){Ss(e)&&(d(this,Ot,Wi(e.onExtinctTemplate,i(this,Ot))),d(this,Nt,Wi(e.onInvalidTemplate,i(this,Nt))))}};Ot=new WeakMap,Nt=new WeakMap,o(rt,Ot,Ui),o(rt,Nt,Ui);var Lt,Rt,kt,Ut,Wt,Mt,Ft,We,xi,Me,$i,ie,pi,Fe,Ki,se,gi,{noop:ft,ensureFunction:ot,isAssignedObject:Ct,isAssignedArray:Ln,isNonEmptyArray:Mi,isOf:Fi,forEachOwnProperty:Rn}=p,_s=r=>r.toLowerCase().replaceAll("_","-"),A=class{static registerClasses(e){Mi(e)&&window.Array.prototype.forEach.call(e,t=>typeof t=="function"?h(this,ie,pi).call(this,t):i(this,Ut).call(this,t))}static instantiateClasses(e,t,s,n){Mi(e)&&window.Array.prototype.forEach.call(e,a=>h(this,se,gi).call(this,a,Ct(t)?t:t instanceof window.HTMLElement?{node:t}:{selector:t},Ct(s)?s:new window.Object,n))}static createInstance(e,t,s){if(Ct(e)&&Fi(e.type,window.Function))return e.register===!0&&h(this,ie,pi).call(this,e.type),t=Ct(t)?t:new window.Object,s=Ct(s)?s:new window.Object,h(this,se,gi).call(this,e.type,t,{on_bad_target:t.on_bad_target,on_element_instantiated:s.on_element_instantiated},s.parameters)}static initialize(e){Ct(e)&&(d(this,Lt,ot(e.onBadTarget,i(this,Lt))),d(this,Rt,ot(e.onDeferredInstantiation,i(this,Rt))),d(this,Ut,ot(e.onInvalidClass,i(this,Ut))),d(this,kt,ot(e.onMisnamedClass,i(this,kt))),d(this,Wt,ot(e.onUnregistrableClass,i(this,Wt))),d(this,Mt,ot(e.onUnregisteredClass,i(this,Mt))),d(this,Ft,ot(e.onAlreadyRegistered,i(this,Ft))))}};Lt=new WeakMap,Rt=new WeakMap,kt=new WeakMap,Ut=new WeakMap,Wt=new WeakMap,Mt=new WeakMap,Ft=new WeakMap,We=new WeakSet,xi=function(e){window.HTMLElement.isPrototypeOf(e)?window.customElements.define(e.tag,e):i(this,Wt).call(this,e.name)},Me=new WeakSet,$i=function(e){window.customElements.get(e.tag=_s(e.name))?i(this,Ft).call(this,e.name):h(this,We,xi).call(this,e)},ie=new WeakSet,pi=function(e){e.name.indexOf("_")>0?h(this,Me,$i).call(this,e):i(this,kt).call(this,e.name)},Fe=new WeakSet,Ki=function(e,t,s,n){let a=t.selector,c=t.node;if(!(c instanceof window.HTMLElement))try{c=window.document.querySelector(a)}catch(O){if(Fi(s.on_bad_target,window.Function)){if(s.on_bad_target(a)===!1)return}else{i(this,Lt).call(this,a);return}}finally{c=c||window.document.body}let u=window.document.createElement(e.tag);return u.parameters=n,ot(s.on_element_instantiated)(u,a),c.appendChild(u),u},se=new WeakSet,gi=function(e,t,s,n){let a=()=>h(this,Fe,Ki).call(this,e,t,s,n);return window.customElements.get(e.tag)?window.document.body?a():i(this,Rt).call(this,a):i(this,Mt).call(this,e.name)},o(A,We),o(A,Me),o(A,ie),o(A,Fe),o(A,se),o(A,Lt,ft),o(A,Rt,ft),o(A,kt,ft),o(A,Ut,ft),o(A,Wt,ft),o(A,Mt,ft),o(A,Ft,ft);var J=class{static defaultRoutine(e=""){var t=0;for(let s=0;s<e.length;s++)t=(t=(t<<5)-t+e.charCodeAt(s))&t;return t}};var ji=J.defaultRoutine,vs=["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","bgsound","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","content","col","colgroup","datalist","dd","del","details","dfn","dialog","dir","div","dl","dt","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","i","iframe","img","input","ins","isindex","kbd","keygen","label","legend","li","link","listing","main","map","marquee","mark","menu","menuitem","meta","meter","multicol","nav","nextid","nobr","noembed","noframes","noscript","object","ol","optgroup","option","output","p","param","plaintext","pre","progress","q","rb","rp","rt","rtc","ruby","s","samp","script","section","shadow","select","slot","small","source","spacer","span","strike","strong","style","sub","sup","summary","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","xmp","wbr"].map(ji),F=class{static onDOMContentLoaded(e){if(e&&e.constructor===window.Function){let t=()=>{e(),setTimeout(()=>window.removeEventListener("DOMContentLoaded",t),100)};window.addEventListener("DOMContentLoaded",t)}}static getUniqueId(e="WUSE"){let t="_"+(e||"")+"_";for(var s;window.document.getElementById(s=t+(""+window.Math.random()).substring(2))!==null;);return s}static removeChildren(e){if(e)for(;e.firstChild;)e.removeChild(e.firstChild)}static isHTMLTag(e){return vs.indexOf(ji(e))>-1}static htmlEncode(e=""){return typeof e!="string"?null:e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}static getCSSVendorPrefix(){let e=window.getComputedStyle(window.document.body,""),s=window.Array.prototype.slice.call(e).filter(n=>n.charAt(0)==="-");return s.length?"-"+s[0].split("-")[1]+"-":""}};var x=class{static get TEMPLATES_KIND(){return"%templates%"}static get SLOTS_KIND(){return"%slots%"}static get TEXTNODE_TAG(){return"^text^"}static get DEFAULT_KIND(){return""}static get DEFAULT_TAG(){return"div"}static get DEFAULT_STYLE_MEDIA(){return"screen"}static get DEFAULT_STYLE_TYPE(){return"text/css"}static get DEFAULT_REPLACEMENT_OPEN(){return"~{"}static get DEFAULT_REPLACEMENT_CLOSE(){return"}~"}static get WUSEKEY_ATTRIBUTE(){return"data-wusekey"}static get WUSENODE_ATTRIBUTE(){return"data-wusenode"}};var{noop:$n,isOf:Hi,isNonEmptyString:Ds}=p,Bi=r=>!Hi(r,window.Function),Os=(r,e,t,s,n,a,c,u)=>n(()=>e,O=>{a(O,t),Bi(t)?s(r):t({renderize:vt=>s(r,vt),automate:()=>a(O,null),dereact:()=>n(()=>O,c),remove:()=>u(r)})}),Ns=(r,e,t,s,n,a)=>{let c=(H,Dt)=>{window.Object.defineProperty(r,e,{get:H,set:Dt,enumerable:!0,configurable:!0})},u=Bi(a)?H=>delete r[H]:a,O=H=>{u(e),r[e]=H},vt=(H,Dt)=>Os(e,H,Dt,n,c,vt,O,u);return vt(t,s)},ne=class{static createReactiveField(e,t,s,n,a,c){return e&&Ds(t)&&Hi(a,window.Function)?Ns(e,t,s,n,a,c):null}};var re,xe,mt,oe,ae,{EMPTY_ARRAY:Cs,buildArray:Ei,buildObject:Ls,isNonEmptyString:Rs,isAssignedArray:ks}=p,$t=class{static initialize(e,t){this.begin=e,this.end=t}},Y=$t;l(Y,"begin",null),l(Y,"end",null),l(Y,"enclose",e=>$t.begin+e+$t.end),l(Y,"makeRegExp",()=>new window.RegExp(`(?<=${$t.begin}).*?(?=${$t.end})`,"gs"));var Us=["contents","classes","styles","attributes"],xt=class{};l(xt,"rules",(e,t)=>Ei(s=>e.forEach(n=>n.replacements.forEach(a=>a.field===t&&s.push(n))))),l(xt,"children",(e,t)=>Ei(s=>{let n=a=>{let c=u=>u.forEach(O=>O.field===t&&s.push(a));Us.forEach(u=>c(a.replacements[u])),a.rules.forEach(u=>u.replacements.forEach(O=>O.field===t&&s.push(a)))};e.forEach(a=>a.included&&n(a))}));var C=class{static initialize(e){d(this,re,e)}},W=C;re=new WeakMap,xe=new WeakMap,mt=new WeakMap,oe=new WeakMap,ae=new WeakMap,o(W,re,null),o(W,xe,(e,t,s)=>e.push({at:t,field:s.trim(),find:Y.enclose(s)})),o(W,mt,(e,t,s)=>Rs(s)&&(s.match(i(C,re))||Cs).forEach(n=>{var a;return i(a=C,xe).call(a,e,t,n)})),o(W,oe,(e,t,s)=>{var n;e[t]=new window.Array,i(n=C,mt).call(n,e[t],t,s)}),o(W,ae,(e,t,s)=>{e[t]=new window.Array,window.Object.keys(s).forEach(n=>{var a,c;i(a=C,mt).call(a,e[t],t,n),i(c=C,mt).call(c,e[t],t,s[n])})}),l(W,"child",e=>Ls(t=>{var s,n,a,c;i(s=C,oe).call(s,t,"contents",e.content),i(n=C,oe).call(n,t,"classes",e.classes.join(" ")),i(a=C,ae).call(a,t,"styles",e.style),i(c=C,ae).call(c,t,"attributes",e.attributes),e.rules.forEach(u=>u.replacements=C.rule(u))})),l(W,"rule",e=>Ei(t=>{var n;if(ks(e.nested))return e.nested.map(a=>C.rule(a));var s="";for(let a in e.properties)s+=`${a}:${e.properties[a]};`;i(n=C,mt).call(n,t,"rules",s)}));var L=class{static initialize(e,t){Y.initialize(e,t),W.initialize(Y.makeRegExp())}};l(L,"extractReplacementsFromRule",W.rule),l(L,"extractReplacementsFromChild",W.child),l(L,"scanRulesForReplacements",xt.rules),l(L,"scanChildrenForReplacements",xt.children);var Kt,{noop:Ws,isAssignedArray:Ms,hasObjectKeys:Gi,isNonEmptyString:Pi,isNonEmptyArray:Fs,isAssignedObject:xs,ensureFunction:$s}=p,{htmlEncode:zi}=F,{SLOTS_KIND:Ks,TEMPLATES_KIND:js,TEXTNODE_TAG:Hs}=x,le=class{static initialize(e){xs(e)&&d(this,Kt,$s(e.onFetchTemplate,i(this,Kt)))}},b=le;Kt=new WeakMap,o(b,Kt,Ws),l(b,"cacheInvalidator",e=>e.cache=null),l(b,"slotsInvalidator",e=>e.kind===Ks?le.cacheInvalidator(e):void 0),l(b,"renderingIncluder",e=>e.included=!0),l(b,"renderingExcluder",e=>e.included=!1),l(b,"renderRule",(e,t)=>{if(Ms(t.nested))return`${t.selector}{${t.nested.map(n=>le.renderRule(e,n)).join(`
`)}}`;if(Pi(t.selector)&&!t.nested){var s=new window.String;for(let n in t.properties)s+=`${n}:${t.properties[n]};`;return Fs(t.replacements)&&t.replacements.forEach(n=>s=e(s,n)),`${t.selector}{${s}}`}return null}),l(b,"renderChild",(e,t)=>{var a;if(t.kind===js)return i(a=le,Kt).call(a,t.id);if(t.tag===Hs){var s=t.content;return t.replacements.contents.forEach(c=>s=e(s,c)),t.encode?zi(s):s}var n=Pi(t.id)?`<${t.tag} id='${t.id}'`:`<${t.tag}`;if(t.classes.length){var s=t.classes.join(" ");t.replacements.classes.forEach(u=>s=e(s,u)),n+=` class='${s}'`}if(Gi(t.style)){var s=" style='";for(let u in t.style)s+=`${u}: ${t.style[u]}; `;s+="'",t.replacements.styles.forEach(u=>s=e(s,u)),n+=s}if(Gi(t.attributes)){var s=new window.String;for(let u in t.attributes)s+=` ${u}=${t.attributes[u]}`;t.replacements.attributes.forEach(u=>s=e(s,u)),n+=s}if(typeof t.content=="string"){var s=t.content;t.replacements.contents.forEach(u=>s=e(s,u)),n+=`>${t.encode?zi(s):s}</${t.tag}>`}else n+="/>";return n});var de,he,ce,ue,{ensureFunction:Bs}=p,jt=class{constructor(e){l(this,"rounds",0);o(this,de,0);o(this,he,null);o(this,ce,!1);o(this,ue,null);d(this,ue,Bs(e))}compute(e){return this.rounds+=+d(this,ce,i(this,de)==d(this,he,i(this,ue).call(this,e))),d(this,de,i(this,he)),i(this,ce)}};de=new WeakMap,he=new WeakMap,ce=new WeakMap,ue=new WeakMap;var wt,at,Ht,me,we,N,V,pt,Bt,Ke,{ensureFunction:yi,isNonEmptyString:Gs,isAssignedObject:$e}=p,fe=class{constructor(e,t,s,n={}){o(this,Bt);o(this,wt,new window.String);o(this,at,!1);o(this,Ht,null);o(this,me,null);o(this,we,null);o(this,N,null);o(this,V,null);o(this,pt,new class extends window.Set{name(e,t){let s=`${e}_${t}`;for(var n=0;this.has(s);)s=`${e}_${t}_${++n}`;return this.add(s),s}});d(this,Ht,yi(e)),d(this,me,yi(t)),d(this,we,yi(s)),d(this,V,n)}getStore(){return i(this,V)}setStore(e){d(this,V,e)}get state(){return i(this,N)}get key(){return i(this,wt)}set key(e){return d(this,at,Gs(d(this,wt,e)))}hasKey(){return i(this,at)}validateKey(){return i(this,at)?!0:(this.on_invalid_key(),!1)}nameFiliatedKey(e){return i(this,pt).name(i(this,wt),e)}rememberFiliatedKey(e){i(this,pt).add(e)}hasFiliatedKey(e){return i(this,pt).has(e)}initializeState(){if(i(this,pt).clear(),i(this,at)){let e=i(this,V).hasItem(this.key)?i(this,V).getItem(this.key):i(this,Ht).call(this);if($e(e))d(this,N,e),i(this,N).generation++,h(this,Bt,Ke).call(this);else return this.on_invalid_state(),-1}else d(this,N,i(this,Ht).call(this)),i(this,N).generation++;return i(this,N).generation}writeState(){let e=i(this,N);return $e(e)?(e.data=i(this,we).call(this),h(this,Bt,Ke).call(this),!0):!1}readState(){let e=i(this,N);return $e(e)&&e.persisted?(i(this,me).call(this,e.data),!0):!1}eraseState(){let e=i(this,N);return $e(e)&&e.persisted&&e.data?(delete e.data,h(this,Bt,Ke).call(this),!0):!1}on_invalid_state(){}on_invalid_key(){}};wt=new WeakMap,at=new WeakMap,Ht=new WeakMap,me=new WeakMap,we=new WeakMap,N=new WeakMap,V=new WeakMap,pt=new WeakMap,Bt=new WeakSet,Ke=function(){i(this,at)&&(i(this,N).persisted=!!i(this,N).data,i(this,V).setItem(i(this,wt),i(this,N)))};var q,B,lt,je,Yi,He,Vi,{WUSENODE_ATTRIBUTE:Ji}=x,Gt=class{constructor(e,t){o(this,je);o(this,He);o(this,q,null);o(this,B,null);o(this,lt,null);if(e instanceof window.Node&&t instanceof window.Node)d(this,q,e),this.element=t;else throw new Error("[WUSE:ERROR] Wrong arguments supplied.")}set element(e){h(this,je,Yi).call(this,e.getAttribute(Ji)),d(this,B,e),d(this,lt,e.cloneNode(!1))}get element(){return i(this,B)}affiliate(){i(this,q).appendChild(i(this,B))}disaffiliate(){i(this,q).removeChild(i(this,B))}promote(e){i(this,lt).innerHTML=e,i(this,q).replaceChild(i(this,lt),i(this,B)),h(this,He,Vi).call(this)}};q=new WeakMap,B=new WeakMap,lt=new WeakMap,je=new WeakSet,Yi=function(e){let t=i(this,q).querySelector(`[${Ji}='${e}']`);t&&i(this,q).removeChild(t)},He=new WeakSet,Vi=function(){let e=i(this,lt);d(this,lt,i(this,B).cloneNode(!1)),d(this,B,e)};var gt,Et,{isOf:qi}=p,yt=class{constructor(e,t){o(this,gt,!1);o(this,Et,"");qi(e,window.Function)&&(this.on_content_invalidation=e),qi(t,window.Function)&&(this.on_content_verification=t)}get invalidated(){return i(this,gt)}reset(e){d(this,gt,!1),d(this,Et,e)}append(e){d(this,Et,i(this,Et)+e)}verify(){d(this,gt,this.on_content_verification(i(this,Et)))}process(e){(e||i(this,gt))&&this.on_content_invalidation(i(this,Et))}on_content_verification(e){}on_content_invalidation(e){}};gt=new WeakMap,Et=new WeakMap;var dt,Pt,{isIntegerNumber:Ps,isAssignedObject:bi,cloneObject:zs,forEachOwnProperty:Js,buildArray:Ys}=p,Xi=(r,e,t)=>Js(r,s=>{switch(s){case"owner":case"last":case"length":break;case"version":case"locked":t(s);break;default:Ps(s)&&e(s)}}),Qi=(r,e,t)=>{t(e);let s=zs(e);s.cache=null,r.push(s)},bt=class extends window.Array{constructor(t){super();o(this,dt);l(this,"owner",null);l(this,"last",null);l(this,"version",0);l(this,"locked",!1);this.owner=t}append(t){this.locked?this.on_forbidden_change():bi(t)&&(this.push(t),h(this,dt,Pt).call(this,t))}prepend(t){this.locked?this.on_forbidden_change():bi(t)&&(this.unshift(t),h(this,dt,Pt).call(this,t))}replace(t,s){this.locked?this.on_forbidden_change():t>-1&&bi(s)&&h(this,dt,Pt).call(this,this[t]=s)}remove(t){if(this.locked)this.on_forbidden_change();else if(t>-1){let s=this.splice(t,1);h(this,dt,Pt).call(this,s.length?s[0]:null)}}clear(){this.locked?this.on_forbidden_change():(this.length=0,h(this,dt,Pt).call(this,null))}persist(){return Ys(t=>Xi(this,s=>Qi(t,this[s],this.on_snapshot_part),s=>t[s]=this[s]))}restore(t,s){this.owner=t,Xi(s,n=>Qi(this,s[n],this.on_recall_part),n=>this[n]=s[n])}getIndexOf(t){}on_snapshot_part(){}on_recall_part(){}on_version_change(){}on_forbidden_change(){}};dt=new WeakSet,Pt=function(t){this.last=t,this.version++,this.on_version_change()};var Pe,ns,ze,rs,Je,os,Ye,as,Ve,ls,Jt,Ge,qe,ds,{isHTMLTag:Vs}=F,{EMPTY_STRING:M,EMPTY_ARRAY:qs,noop:pe,buildArray:or,buildObject:Xs,isAssignedObject:Be,isAssignedArray:zt,ensureFunction:ge,hasObjectKeys:Zi,isNonEmptyString:ht,forcedStringSplit:Qs}=p,{WUSENODE_ATTRIBUTE:ts,DEFAULT_TAG:Zs,DEFAULT_KIND:es,TEMPLATES_KIND:Ti,SLOTS_KIND:Ii,TEXTNODE_TAG:lr}=x,tn=J.defaultRoutine,G={onInvalidDefinition:pe,onInexistentTemplate:pe,onUnespecifiedSlot:pe,onInvalidId:pe,onUnknownTag:pe},en=r=>r.indexOf("-")>0&&!Vs(r),X=class{static parse(e){if(ht(e)){let t=e.trimLeft(),s=is();return t.charAt(0)==="%"?t.startsWith(Ti)?h(this,Jt,Ge).call(this,s,t.replace(s.kind=Ti,M)):t.startsWith(Ii)?h(this,Jt,Ge).call(this,s,t.replace(s.kind=Ii,M)):null:h(this,Jt,Ge).call(this,s,t)}return null}};Pe=new WeakSet,ns=function(e,t){let s=t.indexOf("["),n=t.indexOf("]");if(s>-1&&n>-1&&n>s){let a=t.substr(s,n-s+1),c=a.substr(1,a.length-2).split("|");for(let u in c){let O=c[u].split("=");O[0]==="style"?O[1].split(";").forEach(vt=>{let H=vt.split(":"),Dt=H[0].trim();Dt.length&&(e.style[Dt]=H[1].trim())}):e.attributes[O[0]]=O[1]||""}return t.replace(a,M)}return t},ze=new WeakSet,rs=function(e,t){let s=t.indexOf("=");return s>-1?(e.content=t.slice(s+1),!!e.content.length&&e.content.charAt(0)==="&"&&(e.content=e.content.slice(1),e.encode=!!e.content.length&&e.content.charAt(0)!=="&"),t.slice(0,s)):t},Je=new WeakSet,os=function(e,t){let s=t.replaceAll("!"," ").split(" ");return s.slice(1).map(n=>{let[a,...c]=n.toLowerCase().split("+"),u=(c||qs).indexOf("capture")>-1;e.events.push(ss(a,u))}),s[0]},Ye=new WeakSet,as=function(e,t){let s=t.replaceAll("."," ").split(" ");return e.classes=s.slice(1),s[0]},Ve=new WeakSet,ls=function(e,t){if(ht(t)){let s=t.indexOf("#");s===-1?e.tag=t:(s>0&&(e.tag=t.substr(0,s)),e.id=t.substr(s+1))}return e},Jt=new WeakSet,Ge=function(e,t){return h(this,Ve,ls).call(this,e,h(this,Ye,as).call(this,e,h(this,Je,os).call(this,e,h(this,ze,rs).call(this,e,h(this,Pe,ns).call(this,e,t)))))},o(X,Pe),o(X,ze),o(X,Je),o(X,Ye),o(X,Ve),o(X,Jt);var Ee=class{static parse(e){return Xs(t=>(zt(e)?e:Qs(e,`
`).map(s=>s.trim()).join(M).split(";")).forEach(s=>ht(s)&&h(this,qe,ds).call(this,t,s.trim())))}};qe=new WeakSet,ds=function(e,t){if(!!t.length&&t.indexOf(":")>-1){let[s,...n]=t.split(":"),a=s.trim();if(a.length){let c=n.join(":").trim();e[a]=c.endsWith(";")?c.slice(0,-1):c}}},o(Ee,qe);var is=()=>({kind:es,tag:Zs,id:M,classes:new window.Array,attributes:new window.Object,style:new window.Object,events:new window.Array,content:M,encode:!1}),sn=()=>({generation:0,persisted:!1}),ss=(r,e)=>typeof r=="string"&&typeof e=="boolean"?{kind:r,capture:e}:null,nn=(r,e)=>{let t=X.parse(r);return t?(t.custom=t.kind===es&&en(t.tag),t.hash=tn(r),t.rules=zt(e)?e:new window.Array,t.included=!0,t.cache=null,t):G.onInvalidDefinition(r)},rn=r=>{if(r!==null)if(r.kind===Ti){if(!window.document.getElementById(r.id))return G.onInexistentTemplate(r.id)}else if(r.kind===Ii){if(new window.String(r.attributes.slot).replaceAll('"',M).replaceAll("'",M).length===0)return G.onUnespecifiedSlot(r.id)}else{if(typeof r.id!="string")return G.onInvalidId(r.id);r.custom&&!window.customElements.get(r.tag)&&G.onUnknownTag(r.tag)}return r},on=r=>{if(!Be(r))return null;let e=window.document.createElement(r.tag);if(r.id.length&&e.setAttribute("id",r.id),r.classes.length&&e.setAttribute("class",r.classes.join(" ")),Zi(r.style)){var t=new window.String;for(let s in r.style)t+=`${s}: ${r.style[s]}; `;if(t.length){let s=t.trim();e.setAttribute("style",s.endsWith(";")?s.slice(0,-1):s)}}if(Zi(r.attributes))for(let s in r.attributes)e.setAttribute(s,r.attributes[s]);return e.setAttribute(ts,"main"),e},an=(r,e)=>{let t=window.document.createElement("style");return ht(r)&&t.setAttribute("media",r),ht(e)&&t.setAttribute("type",e),t.setAttribute(ts,"style"),t.appendChild(window.document.createTextNode(M)),t},ln=(r,e)=>{let t=zt(r)?r.join(","):ht(r)?r:M;return t.length?{selector:t,properties:Be(e)?e:Ee.parse(e),cache:null}:null},dn=(r,e,t)=>{let s=zt(r)?r.join(","):ht(r)?r:M,n=zt(e)?e.join(","):ht(e)?e:M;return!s.length||!n.length?null:{selector:s,nested:[{selector:n,properties:Be(t)?t:Ee.parse(t)}],cache:null}},hn=(r,e)=>{if(r.selector===e.selector){for(let t in e.properties)r.properties[t]=e.properties[t];return r.cache=null,!0}return!1},cn=(r,e)=>zt(r.nested)&&r.selector===e.selector?(e.nested.forEach(t=>{var s=!1;for(let n in r.nested)if(s=r.nested[n].selector===t.selector){for(let a in t.properties)r.nested[n].properties[a]=t.properties[a];break}s||r.nested.push(t)}),r.cache=null,!0):!1,m=class{static initialize(e){Be(e)&&(G.onInvalidDefinition=ge(e.onInvalidDefinition),G.onInexistentTemplate=ge(e.onInexistentTemplate),G.onUnespecifiedSlot=ge(e.onUnespecifiedSlot),G.onInvalidId=ge(e.onInvalidId),G.onUnknownTag=ge(e.onUnknownTag))}};l(m,"makeStyleNode",an),l(m,"newRule",ln),l(m,"newNestedRule",dn),l(m,"tryToJoinRules",hn),l(m,"tryToJoinNestedRules",cn),l(m,"performValidations",rn),l(m,"makeMainNode",on),l(m,"newChild",nn),l(m,"newDefinition",is),l(m,"newEvent",ss),l(m,"newState",sn);var R=class{static get REGULAR(){return"regular"}static get OPEN(){return"open"}static get CLOSED(){return"closed"}};l(R,"specializeClass",(e,t)=>class extends e{constructor(){super(t)}});var Q,Yt,un=["on_create","on_construct","on_reconstruct","on_connect","on_inject","on_load","on_prerender","on_update","on_postrender","on_refresh","on_unload","on_reload","on_repaint","on_disconnect"],ye=class{constructor(e){o(this,Q,null);o(this,Yt,new window.Object);d(this,Q,e)}detect(){un.forEach(e=>i(this,Yt)[e]=typeof i(this,Q)[e]=="function")}immediateTrigger(e,t){i(this,Yt)[e]&&i(this,Q)[e].call(i(this,Q),t)}committedTrigger(e,t){i(this,Yt)[e]&&window.requestAnimationFrame(()=>i(this,Q)[e].call(i(this,Q),t))}};Q=new WeakMap,Yt=new WeakMap;var $,E,I,k,f,Te,_,Ie,v,P,Qt,It,tt,z,At,et,ct,Ae,ei,ii,T,it,w,St,K,si,fs,ni,ms,ut,Xt,Zt,ti,ri,ws,Se,Si,_e,_i,oi,ps,ve,vi,ai,gs,De,Di,Oe,Oi,Ne,Ni,Ce,Ci,{EMPTY_STRING:be,noop:Vt,ensureFunction:qt,isOf:fn,isAssignedObject:Xe,isAssignedArray:Ai,isNonEmptyArray:hs,isNonEmptyString:Tt,forcedStringSplit:cs,forEachOwnProperty:mn}=p,{removeChildren:wn}=F,{WUSEKEY_ATTRIBUTE:Qe,DEFAULT_STYLE_TYPE:pn,DEFAULT_STYLE_MEDIA:gn,DEFAULT_REPLACEMENT_OPEN:En,DEFAULT_REPLACEMENT_CLOSE:yn,SLOTS_KIND:us}=x,{createReactiveField:bn}=ne,D={onInvalidState:Vt,onInvalidKey:Vt,onInvalidDefinition:Vt,onLockedDefinition:Vt,onTakenId:Vt,onAllowHTML:Vt},Z=(r,e)=>window.Wuse.debug(`#${r.id} (${r.info.instanceNumber}) | ${typeof e=="string"?e:JSON.stringify(e)}`),Ze=(r,e)=>m.performValidations(m.newChild(r,e)),Tn=()=>({mainDefinition:m.newDefinition(),styleMedia:gn,styleType:pn,rawContent:!1,attributeKeys:!1,elementKeys:!0,autokeyChildren:!0}),In=()=>({attachment:new window.Wuse.PerformanceMeasurement.StopWatch,partial:new window.Wuse.PerformanceMeasurement.StopWatch,full:new window.Wuse.PerformanceMeasurement.StopWatch,dettachment:new window.Wuse.PerformanceMeasurement.StopWatch}),An=()=>({main:new jt(window.Wuse.hashRoutine),style:new jt(window.Wuse.hashRoutine)}),Li=class extends window.HTMLElement{constructor(t){super();o(this,si);o(this,ni);o(this,ut);o(this,Zt);o(this,ri);o(this,Se);o(this,_e);o(this,oi);o(this,ve);o(this,ai);o(this,De);o(this,Oe);o(this,Ne);o(this,Ce);o(this,$,new window.String);o(this,E,new class extends bt{constructor(){super(...arguments);l(this,"on_version_change",()=>{this.last!==null&&(this.last.version=this.version,this.last.replacements=L.extractReplacementsFromRule(this.last)),window.Wuse.DEBUG&&i(this.owner,v)&&Z(this.owner,`rules list version change: ${this.version}`)});l(this,"on_forbidden_change",()=>{window.Wuse.DEBUG&&i(this.owner,v)&&Z(this.owner,"rules list is locked and can not be changed"),D.onLockedDefinition(i(this,f).mainDefinition.id)})}getIndexOf(s){for(let n=0;n<this.length;n++)if(this[n].selector===s)return n;return-1}}(this));o(this,I,new class extends bt{constructor(){super(...arguments);l(this,"on_version_change",()=>{var s;this.last!==null&&(this.last.version=this.version,this.last.replacements=L.extractReplacementsFromChild(this.last)),i(this.owner,P)||d(s=this.owner,P,i(s,P)|this.some(n=>n.kind===us)),window.Wuse.DEBUG&&i(this.owner,v)&&Z(this.owner,`children list version change: ${this.version}`)});l(this,"on_forbidden_change",()=>{window.Wuse.DEBUG&&i(this.owner,v)&&Z(this.owner,"children list is locked and can not be changed"),D.onLockedDefinition(i(this,f).mainDefinition.id)});l(this,"on_recall_part",s=>i(this.owner,Ae).tryToRemember(s))}getIndexOf(s){for(let n=0;n<this.length;n++)if(this[n].id===s)return n;return-1}}(this));o(this,k,new class extends bt{constructor(){super(...arguments);l(this,"on_version_change",()=>{window.Wuse.DEBUG&&i(this.owner,v)&&Z(this.owner,`fields list version change: ${this.version}`)});l(this,"on_forbidden_change",()=>{window.Wuse.DEBUG&&i(this.owner,v)&&Z(this.owner,"fields list is locked and can not be changed"),D.onLockedDefinition(i(this,f).mainDefinition.id)});l(this,"on_snapshot_part",s=>s.value=this.owner[s.name]);l(this,"on_recall_part",s=>this.owner[s.name]=s.value)}getIndexOf(s){for(let n=0;n<this.length;n++)if(this[n].name===s)return n;return-1}}(this));o(this,f,Tn());o(this,Te,void 0);o(this,_,new ye(this));o(this,Ie,!1);o(this,v,!1);o(this,P,!1);o(this,Qt,window.Wuse.isShadowElement(this));o(this,It,void 0);o(this,tt,void 0);o(this,z,null);o(this,At,!1);o(this,et,!1);o(this,ct,!0);o(this,Ae,{tryToName:t=>{t.attributes[Qe]||(t.attributes[Qe]=i(this,T).nameFiliatedKey(t.hash))},tryToRemember:t=>{let s=t.attributes[Qe];s&&i(this,T).rememberFiliatedKey(s)}});o(this,ei,t=>{t&&(d(this,f,t.options),d(this,P,t.slotted),d(this,v,t.identified),d(this,$,t.html),i(this,I).restore(this,t.children),i(this,E).restore(this,t.rules),i(this,k).restore(this,t.fields))});o(this,ii,()=>({options:i(this,f),html:i(this,$),children:i(this,I).persist(),rules:i(this,E).persist(),fields:i(this,k).persist(),slotted:i(this,P),identified:i(this,v)}));o(this,T,new class extends fe{on_invalid_state(){D.onInvalidState()}on_invalid_key(){D.onInvalidKey()}}(m.newState,i(this,ei),i(this,ii),window.Wuse.elementsStorage));o(this,it,{binder:t=>Tt(t)&&(this[t]=h(this,Zt,ti).call(this,t)),unbinder:t=>delete this[t],makePerformers:(t,s)=>({event:t,key:()=>(i(this,v)&&s(i(this,f).mainDefinition.id),n=>s(n.id))}),makeHandlers:t=>({key:i(this,f).elementKeys&&t.key(),event:(s,n,a)=>{let c=this[`on_${s}_${n}`];if(c){let u=h(this,Zt,ti).call(this,s);u&&u[t.event](n,c,a)}},slots:()=>this.on_slot_change&&i(this,z).querySelectorAll("slot").forEach(s=>s[t.event]("slotchange",this.on_slot_change))}),getHandlers:t=>i(this,it).makeHandlers(t?i(this,it).makePerformers("addEventListener",i(this,it).binder):i(this,it).makePerformers("removeEventListener",i(this,it).unbinder))});o(this,w,{root:new yt(t=>this.innerHTML=t,t=>!0),style:new yt(t=>i(this,tt).promote(t),t=>!i(this,St).style.compute(t)),main:new yt(t=>i(this,It).promote(t),t=>!i(this,St).main.compute(t)),renderizers:{replacer:(t,s)=>t.replace(s.find,this[s.field]!==void 0?this[s.field]:be),rule:t=>i(this,w).style.append(t.cache?t.cache:t.cache=b.renderRule(i(this,w).renderizers.replacer,t)),children:{mixed:t=>t.kind===us?i(this,w).renderizers.children.slot(t):i(this,w).renderizers.children.normal(t),slot:t=>!t.cache&&i(this,w).root.append(t.cache=b.renderChild(i(this,w).renderizers.replacer,t),i(this,w).root.verify()),normal:t=>{i(this,w).main.append(t.cache?t.cache:t.cache=b.renderChild(i(this,w).renderizers.replacer,t)),t.rules.forEach(i(this,w).renderizers.rule)}}},getDebugInfo:()=>`updated (root: ${i(this,w).root.invalidated}, main: ${i(this,w).main.invalidated}, style: ${i(this,w).style.invalidated})`});o(this,St,An());o(this,K,In());l(this,"info",{instanceNumber:++Li.instancesCount,unmodifiedRounds:0,updatedRounds:0});d(this,z,t===R.REGULAR?this:this.shadowRoot||this.attachShadow({mode:t})),i(this,_).detect(),i(this,_).immediateTrigger("on_create"),i(this,f).attributeKeys&&this.getAttributeNames().forEach(s=>this[s]=this.getAttribute(s)),this.dataset.wusekey&&this.setElementsStoreKey(this.dataset.wusekey),i(this,_).immediateTrigger(i(this,T).initializeState()>1?"on_reconstruct":"on_construct",i(this,T).state),d(this,Ie,!0)}render(){window.Wuse.RENDERING&&i(this,ct)&&i(this,et)&&h(this,oi,ps).call(this)}redraw(){window.Wuse.RENDERING&&i(this,ct)&&i(this,et)&&h(this,ai,gs).call(this)}get parameters(){return i(this,Te)}set parameters(t){Xe(d(this,Te,t))&&mn(t,s=>this[s]=t[s])}connectedCallback(){window.Wuse.MEASURE&&i(this,K).attachment.start(),i(this,_).detect(),i(this,_).immediateTrigger("on_connect"),h(this,ve,vi).call(this,"on_load"),window.Wuse.MEASURE&&i(this,K).attachment.stop(window.Wuse.DEBUG)}disconnectedCallback(){window.Wuse.MEASURE&&i(this,K).dettachment.start(),h(this,ut,Xt).call(this,!1),i(this,_).immediateTrigger("on_disconnect"),i(this,T).writeState(),window.Wuse.MEASURE&&i(this,K).dettachment.stop(window.Wuse.DEBUG)}getElementsStore(){return i(this,T).getStore()}setElementsStore(t){return i(this,T).setStore(t),this}hasElementsStoreKey(){return i(this,T).hasKey()}getElementsStoreKey(t){return i(this,T).key}setElementsStoreKey(t){return(i(this,T).key=t)&&(this.setAttribute(Qe,t),i(this,T).writeState()),this}deriveChildrenStoreKey(t){i(this,f).autokeyChildren=t}persistToElementsStore(){return i(this,T).validateKey()&&i(this,T).writeState()}restoreFromElementsStore(){return i(this,T).validateKey()&&i(this,T).readState()}removeFromElementsStore(){return i(this,T).validateKey()&&i(this,T).eraseState()}selectChildElement(t){return i(this,z).querySelector(t)}getMainAttribute(t){return t==="id"&&i(this,v)?i(this,f).mainDefinition.id:i(this,f).mainDefinition.attributes[t]}setMainAttribute(t,s){return i(this,f).mainDefinition.attributes[t]=s,i(this,At)&&i(this,It).element.setAttribute(t,s),this}setMainElement(t){let s=Ze(t);if(s!==null){if(Tt(s.content)||hs(s.events))return D.onInvalidDefinition(t);d(this,v,Tt(s.id))&&(i(this,f).mainDefinition.id=s.id),Tt(s.tag)&&(i(this,f).mainDefinition.tag=s.tag),hs(s.classes)&&(i(this,f).mainDefinition.classes=s.classes),Xe(s.style)&&(i(this,f).mainDefinition.style=s.style),Xe(s.attributes)&&(i(this,f).mainDefinition.attributes=s.attributes)}return this}setStyleOptions(t,s){return i(this,f).styleMedia=Tt(t)?t:be,i(this,f).styleType=Tt(s)?s:be,this}setElementsAsKeys(t){return i(this,f).elementKeys=!!t,this}setAttributesAsKeys(t){return i(this,f).attributeKeys=!!t,this}allowRawContent(t){return i(this,f).rawContent=!!t,this}setRawContent(t){return i(this,f).rawContent?d(this,$,t):D.onAllowHTML(),this}appendRawContent(t){return i(this,f).rawContent?d(this,$,i(this,$)+t):D.onAllowHTML(),this}prependRawContent(t){return i(this,f).rawContent?d(this,$,t+i(this,$)):D.onAllowHTML(),this}lockCSSRules(){return i(this,E).locked=!0,this}unlockCSSRules(){return i(this,E).locked=!1,this}appendCSSRule(t,s,n){if(n)return this.appendCSSNestedRule(t,s,n);let a=i(this,E).slice(-1),c=m.newRule(t,s);return(!a.length||!m.tryToJoinRules(a[0],c))&&i(this,E).append(c),this}prependCSSRule(t,s,n){if(n)return this.prependCSSNestedRule(t,s,n);let a=i(this,E).slice(0,1),c=m.newRule(t,s);return(!a.length||!m.tryToJoinRules(a[0],c))&&i(this,E).prepend(c),this}appendCSSNestedRule(t,s,n){let a=i(this,E).slice(-1),c=m.newNestedRule(t,s,n);return(!a.length||!m.tryToJoinNestedRules(a[0],c))&&i(this,E).append(c),this}prependCSSNestedRule(t,s,n){let a=i(this,E).slice(0,1),c=m.newNestedRule(t,s,n);return(!a.length||!m.tryToJoinNestedRules(a[0],c))&&i(this,E).prepend(c),this}hasCSSRuleBySelector(t){return i(this,E).getIndexOf(t)>-1}replaceCSSRuleBySelector(t,s){let n=i(this,E).getIndexOf(t);return n>-1&&(i(this,E)[n]=m.newRule(t,s)),this}removeCSSRuleBySelector(t){let s=i(this,E).getIndexOf(t);return s>-1&&i(this,E).splice(s,1),this}removeAllCSSRules(){return i(this,E).clear(),this}lockChildElements(){return i(this,I).locked=!0,this}unlockChildElements(){return i(this,I).locked=!1,this}appendChildElement(t,s){let n=h(this,Ce,Ci).call(this,Ze(t,s));return n!==null&&i(this,I).append(n),this}prependChildElement(t,s){let n=h(this,Ce,Ci).call(this,Ze(t,s));return n!==null&&i(this,I).prepend(n),this}appendChildElements(t){return(Ai(t)?t:cs(t,`
`)).forEach(s=>typeof s=="string"&&!!s.trim().length&&this.appendChildElement(s)),this}prependChildElements(t){return(Ai(window.Array)?t:cs(t,`
`)).forEach(s=>typeof s=="string"&&!!s.trim().length&&this.prependChildElement(s)),this}replaceChildElementById(t,s,n){let a=i(this,I).getIndexOf(t);if(a>-1){let c=Ze(s,n);c!==null&&i(this,I).replace(a,c)}return this}removeChildElementById(t){let s=i(this,I).getIndexOf(t);return s>-1&&i(this,I).remove(s),this}removeAllChildElements(){return i(this,I).clear(),this}checkChildElementIsIncludedById(t,s,n){let a=c=>fn(c,window.Function)?c():void 0;return i(this,I).some(c=>c.id===t&&c.included)?a(s):a(n),this}includeChildElementById(t){return i(this,I).forEach(s=>s.id===t&&b.renderingIncluder(s)),this}excludeChildElementById(t){return i(this,I).forEach(s=>s.id===t&&b.renderingExcluder(s)),this}invalidateChildElementsById(t){return i(this,I).forEach(s=>t.indexOf(s.id)>-1&&b.cacheInvalidator(s)),this}invalidateChildElements(t){return Ai(t)&&t.forEach(b.cacheInvalidator),this}lockInstanceFields(){return i(this,k).locked=!0,this}unlockInstanceFields(){return i(this,k).locked=!1,this}makeField(t,s){return h(this,Ne,Ni).call(this,t,s,!0)}makeReadonlyField(t,s){return h(this,Ne,Ni).call(this,t,s,!1)}makeReactiveField(t,s,n,a=!0){return bn(this,t,s,n,(c,u)=>h(this,De,Di).call(this,c,u||"$auto"),c=>this.dropField(c)),h(this,Oe,Oi).call(this,t,s),a&&h(this,De,Di).call(this,t,"$init"),this}makeExternalReactiveField(t,s,n,a,c=!0){return this.makeReactiveField(s,t[s]||n,u=>{t[s]=this[s],a(u)},c)}hasField(t){return i(this,k).getIndexOf(t)>-1}dropField(t){let s=i(this,k).getIndexOf(t);return s>-1?(this.hasOwnProperty(t)&&delete this[t],i(this,k).splice(s,1),i(this,T).writeState(),!0):!1}suspendRender(){return d(this,ct,!1),this}resumeRender(t=!0){return d(this,ct,!0),t&&this.render(),this}isRenderSuspended(){return!i(this,ct)}static initialize(t){L.initialize(En,yn),Xe(t)&&(b.initialize({onFetchTemplate:t.onFetchTemplate}),m.initialize({onInvalidDefinition:t.onInvalidDefinition,onInexistentTemplate:t.onInexistentTemplate,onUnespecifiedSlot:t.onUnespecifiedSlot,onInvalidId:t.onInvalidId,onUnknownTag:t.onUnknownTag}),D.onAllowHTML=qt(t.onAllowHTML),D.onInvalidKey=qt(t.onInvalidKey),D.onInvalidState=qt(t.onInvalidState),D.onInvalidDefinition=qt(t.onInvalidDefinition),D.onLockedDefinition=qt(t.onLockedDefinition),D.onTakenId=qt(t.onTakenId))}static register(){return Wuse.register(this)}static create(t,s="body"){let n=s instanceof window.HTMLElement?{node:s}:typeof s=="string"?{selector:s}:s;return Wuse.create({element:{type:this},target:n,instance:{parameters:t}})}},j=Li;$=new WeakMap,E=new WeakMap,I=new WeakMap,k=new WeakMap,f=new WeakMap,Te=new WeakMap,_=new WeakMap,Ie=new WeakMap,v=new WeakMap,P=new WeakMap,Qt=new WeakMap,It=new WeakMap,tt=new WeakMap,z=new WeakMap,At=new WeakMap,et=new WeakMap,ct=new WeakMap,Ae=new WeakMap,ei=new WeakMap,ii=new WeakMap,T=new WeakMap,it=new WeakMap,w=new WeakMap,St=new WeakMap,K=new WeakMap,si=new WeakSet,fs=function(){d(this,tt,i(this,E).length?new Gt(i(this,z),m.makeStyleNode(i(this,f).styleMedia,i(this,f).styleType)):null)&&i(this,tt).affiliate(),d(this,It,new Gt(i(this,z),m.makeMainNode(i(this,f).mainDefinition))).affiliate(),d(this,At,!0)},ni=new WeakSet,ms=function(){i(this,At)&&(i(this,It).disaffiliate(),i(this,tt)&&i(this,tt).disaffiliate(),i(this,P)&&i(this,Qt)&&wn(i(this,z))),d(this,At,!1)},ut=new WeakSet,Xt=function(t){if(i(this,et)&&!t||!i(this,et)&&t){let s=i(this,it).getHandlers(t);i(this,I).forEach(n=>{!n.included&&t||(s.key&&s.key(n),n.events.forEach(a=>a&&s.event(n.id,a.kind,a.capture)))}),i(this,P)&&i(this,Qt)&&s.slots(),d(this,et,t)}},Zt=new WeakSet,ti=function(t){return Tt(t)?i(this,z).querySelector(`#${t}`):void 0},ri=new WeakSet,ws=function(){i(this,I).forEach(b.cacheInvalidator),i(this,E).forEach(b.cacheInvalidator)},Se=new WeakSet,Si=function(){i(this,w).root.reset(be),i(this,w).style.reset(be),i(this,w).main.reset(i(this,$));let t=i(this,P)&&i(this,Qt)?i(this,w).renderizers.children.mixed:i(this,w).renderizers.children.normal;i(this,I).forEach(s=>s.included&&t(s)),i(this,E).forEach(i(this,w).renderizers.rule),i(this,w).main.verify(),i(this,w).style.verify()},_e=new WeakSet,_i=function(t,s,n){i(this,w).root.process(t),i(this,w).style.process(s),i(this,w).main.process(n),window.Wuse.DEBUG&&i(this,v)&&Z(this,i(this,w).getDebugInfo())},oi=new WeakSet,ps=function(){window.Wuse.MEASURE&&i(this,K).partial.start(),i(this,_).immediateTrigger("on_prerender"),h(this,Se,Si).call(this),i(this,w).root.invalidated||i(this,w).main.invalidated||i(this,w).style.invalidated?(h(this,ut,Xt).call(this,!1),h(this,_e,_i).call(this,!1,!1,!1),h(this,ut,Xt).call(this,!0),this.info.updatedRounds++,i(this,_).immediateTrigger("on_update"),i(this,T).writeState(),i(this,_).committedTrigger("on_refresh")):this.info.unmodifiedRounds++,window.Wuse.DEBUG&&i(this,v)&&Z(this,`unmodified: ${this.info.unmodifiedRounds} (main: ${i(this,St).main.rounds}, style: ${i(this,St).style.rounds}) | updated: ${this.info.updatedRounds}`),i(this,_).immediateTrigger("on_postrender"),window.Wuse.MEASURE&&i(this,K).partial.stop(window.Wuse.DEBUG)},ve=new WeakSet,vi=function(t){h(this,ri,ws).call(this),h(this,si,fs).call(this),i(this,_).immediateTrigger("on_inject"),h(this,Se,Si).call(this),h(this,_e,_i).call(this,!1,!!i(this,tt),!0),h(this,ut,Xt).call(this,!0),i(this,_).immediateTrigger(t),i(this,T).writeState()},ai=new WeakSet,gs=function(){window.Wuse.MEASURE&&i(this,K).full.start(),h(this,ut,Xt).call(this,!1),h(this,ni,ms).call(this),i(this,_).immediateTrigger("on_unload"),i(this,_).detect(),h(this,ve,vi).call(this,"on_reload"),i(this,_).committedTrigger("on_repaint"),window.Wuse.MEASURE&&i(this,K).full.stop(window.Wuse.DEBUG)},De=new WeakSet,Di=function(t,s="$none"){if(i(this,et)){let n=L.scanRulesForReplacements(i(this,E),t);n.forEach(b.cacheInvalidator);let a=L.scanChildrenForReplacements(i(this,I),t);a.forEach(b.cacheInvalidator),window.Wuse.DEBUG&&i(this,v)&&Z(this,`reactive render (label: ${s}, field: ${t}, children: ${a.length}, rules: ${n.length})`),(!!n.length||!!a.length)&&(a.some(c=>!!c.kind.length)&&i(this,I).forEach(b.slotsInvalidator),this.render())}},Oe=new WeakSet,Oi=function(t,s){let n=i(this,k).getIndexOf(t);n>-1?i(this,k)[n].value=s:i(this,k).append({name:t,value:s})},Ne=new WeakSet,Ni=function(t,s,n){return window.Object.defineProperty(this,t,{value:s,writable:n}),h(this,Oe,Oi).call(this,t,s),this},Ce=new WeakSet,Ci=function(t){if(t!==null){if(i(this,Ie)&&h(this,Zt,ti).call(this,t.id))return D.onTakenId(t.id);t.custom&&i(this,f).autokeyChildren&&i(this,T).hasKey()&&i(this,Ae).tryToName(t)}return t},l(j,"instancesCount",0);var Es=(r,e)=>window.Object.getOwnPropertyNames(e).forEach(t=>Object.defineProperty(r,t,{value:e[t],writable:!1,configurable:!1,enumerable:!1})),_t=class{static detectFeatures(e){let t=(s,n)=>!s&&y.UNSUPPORTED_FEATURE.emit(n);try{t(e.JsHelpers.isOf(window.document,window.HTMLDocument),"HTML Document"),t(e.JsHelpers.isOf(window.customElements,window.CustomElementRegistry),"Custom Elements"),e.WebHelpers.onDOMContentLoaded(()=>t(e.JsHelpers.isOf(window.document.body.attachShadow,window.Function),"Shadow DOM"))}catch(s){y.UNKNOWN_ERROR.emit()}}static initializeModules(e){e.PerformanceMeasurement.initialize((t,s)=>e.debug(JSON.stringify(e.JsHelpers.buildArray(n=>{switch(n.push({instances:e.elementCount}),n.push(t.getDebugInfo()),s){case"stop":n.push(e.PerformanceMeasurement.DOMUpdate.overall.getDebugInfo());break;case"finish":n.push(e.PerformanceMeasurement.BrowserRender.overall.getDebugInfo());break}})))),rt.initialize({onExtinctTemplate:y.EXTINCT_TEMPLATE.emit,onInvalidTemplate:y.INVALID_TEMPLATE.emit}),A.initialize({onBadTarget:y.BAD_TARGET.emit,onMisnamedClass:y.MISNAMED_CLASS.emit,onUnregistrableClass:y.UNREGISTRABLE_CLASS.emit,onUnregisteredClass:y.UNREGISTERED_CLASS.emit,onAlreadyRegistered:y.ALREADY_REGISTERED.emit,onInvalidClass:y.INVALID_CLASS.emit,onDeferredInstantiation:e.WebHelpers.onDOMContentLoaded}),j.initialize({onAllowHTML:y.ALLOW_HTML.emit,onInvalidKey:y.INVALID_KEY.emit,onInvalidDefinition:y.INVALID_DEFINITION.emit,onLockedDefinition:y.LOCKED_DEFINITION.emit,onInexistentTemplate:y.INEXISTENT_TEMPLATE.emit,onUnespecifiedSlot:y.UNESPECIFIED_SLOT.emit,onUnknownTag:y.UNKNOWN_TAG.emit,onInvalidId:y.INVALID_ID.emit,onTakenId:y.TAKEN_ID.emit,onInvalidState:y.INVALID_STATE.emit,onFetchTemplate:rt.fetch})}static declareUnwritableMembers(e,t){Es(e,t.fields),Es(e,t.methods)}};var fi,bs,ys,ci,ui,te,li=r=>r>1e3?(r/1e3).toFixed(2)+"s":r.toFixed(2)+"ms",di=class{constructor(){l(this,"round",0);l(this,"domTime",window.Number.MAX_SAFE_INTEGER);l(this,"renderTime",window.Number.MAX_SAFE_INTEGER)}getDebugInfo(){var e=new window.Object;return e.round=this.round,e.domTime=li(this.domTime),this.renderTime!==window.Number.MAX_SAFE_INTEGER&&(e.renderTime=li(this.renderTime)),e}},hi=class{constructor(e){l(this,"name","");l(this,"rounds",0);l(this,"time",0);l(this,"average",0);this.name=e}compute(e){this.rounds++,this.time+=e,this.average=this.time/this.rounds}getDebugInfo(){let e=li(this.time),t=li(this.average);return{name:this.name,rounds:this.rounds,spent:e,average:t}}},U=class{static initialize(e){typeof e=="function"&&d(U,te,e),U.DOMUpdate.overall=new hi("overall-dom-update"),U.BrowserRender.overall=new hi("overall-browser-render")}},st=U;te=new WeakMap,o(st,te,()=>{}),l(st,"StopWatch",(ys=class{constructor(){o(this,fi);l(this,"_begin",0);l(this,"_end",{dom:0,render:0});l(this,"rounds",0);l(this,"last",new di);l(this,"best",new di);l(this,"averages",{dom:0,render:0})}start(){(U.DOMUpdate.check||U.BrowserRender.check)&&(this.last.round=++this.rounds,this._begin=performance.now())}stop(e){var t;U.DOMUpdate.check&&(this.best.domTime>(this.last.domTime=(this._end.dom=performance.now())-this._begin)&&(this.best.round=this.last.round,this.best.domTime=this.last.domTime),this.averages.dom=(this.averages.dom*(this.rounds-1)+this.last.domTime)/this.rounds,U.DOMUpdate.overall.compute(this.last.domTime)),U.BrowserRender.check?setTimeout(()=>h(this,fi,bs).bind(this)(e)):e&&i(t=U,te).call(t,this,"stop")}getDebugInfo(){return{rounds:this.rounds,last:this.last.getDebugInfo(),best:this.best.getDebugInfo(),averages:this.averages}}},fi=new WeakSet,bs=function(e){var t;this.best.renderTime>(this.last.renderTime=(this._end.render=performance.now())-this._begin)&&(this.best.round=this.last.round,this.best.renderTime=this.last.renderTime),this.averages.render=(this.averages.render*(this.rounds-1)+this.last.renderTime)/this.rounds,U.BrowserRender.overall.compute(this.last.renderTime),e&&i(t=U,te).call(t,this,"finish")},ys)),l(st,"DOMUpdate",(ci=class{},l(ci,"check",!0),l(ci,"overall",null),ci)),l(st,"BrowserRender",(ui=class{},l(ui,"check",!1),l(ui,"overall",null),ui));var nt,Re,Ri,Le=class{constructor(){o(this,Re);o(this,nt,new window.Object)}get length(){return h(this,Re,Ri).call(this).length}key(e){return h(this,Re,Ri).call(this)[e]||null}getItem(e){return i(this,nt)[e]}setItem(e,t){i(this,nt)[e]=t}removeItem(e){delete i(this,nt)[e]}clear(){d(this,nt,new window.Object)}hasItem(e){return i(this,nt).hasOwnProperty(e)}};nt=new WeakMap,Re=new WeakSet,Ri=function(){return window.Object.keys(i(this,nt))};var Ts="0.7.2";var g,{noop:ee,isOf:mi}=p;window.Wuse=window.Wuse||(g=class{static get VERSION(){return Ts}static get elementCount(){return j.instancesCount}},l(g,"DEBUG",!1),l(g,"FATALS",!1),l(g,"MEASURE",!1),l(g,"RENDERING",!0),l(g,"hashRoutine",J.defaultRoutine),l(g,"elementsStorage",new Le),l(g,"tmp",null),l(g,"WebHelpers",null),l(g,"JsHelpers",null),l(g,"PerformanceMeasurement",null),l(g,"NonShadowElement",null),l(g,"OpenShadowElement",null),l(g,"ClosedShadowElement",null),l(g,"debug",ee),l(g,"blockUpdate",ee),l(g,"register",ee),l(g,"instantiate",ee),l(g,"create",ee),l(g,"isShadowElement",ee),(()=>{_t.declareUnwritableMembers(g,{fields:{tmp:new window.Object,WebHelpers:F,JsHelpers:p,PerformanceMeasurement:st,NonShadowElement:R.specializeClass(j,R.REGULAR),OpenShadowElement:R.specializeClass(j,R.OPEN),ClosedShadowElement:R.specializeClass(j,R.CLOSED)},methods:{debug:e=>window.console.log("[WUSE:DEBUG]",e),blockUpdate:(e,t)=>{if(mi(e,Function)){window.Wuse.DEBUG&&window.Wuse.debug("blocking"),window.Wuse.RENDERING=!1;try{e(t)}catch(s){throw s}finally{window.Wuse.RENDERING=!0,window.Wuse.DEBUG&&window.Wuse.debug("unblocking")}}},isShadowElement:e=>{let t=window.Object.getPrototypeOf(e.constructor);return t===window.Wuse.OpenShadowElement||t===window.Wuse.ClosedShadowElement},register:e=>A.registerClasses(mi(e,window.Array)?e:new window.Array(e)),instantiate:(e,t,s)=>A.instantiateClasses(mi(e,window.Array)?e:new window.Array(e),t,s),create:(e,t)=>mi(e,window.Object)?A.createInstance(e.element,e.target,e.instance):void 0}}),_t.detectFeatures(g),_t.initializeModules(g)})(),g);})();
