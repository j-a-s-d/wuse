var _e=Object.defineProperty;var ts=(m,s,n)=>s in m?_e(m,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):m[s]=n;var c=(m,s,n)=>(ts(m,typeof s!="symbol"?s+"":s,n),n),Ee=(m,s,n)=>{if(!s.has(m))throw TypeError("Cannot "+n)};var e=(m,s,n)=>(Ee(m,s,"read from private field"),n?n.call(m):s.get(m)),a=(m,s,n)=>{if(s.has(m))throw TypeError("Cannot add the same private member more than once");s instanceof WeakSet?s.add(m):s.set(m,n)},f=(m,s,n,t)=>(Ee(m,s,"write to private field"),t?t.call(m,n):s.set(m,n),n);var h=(m,s,n)=>(Ee(m,s,"access private method"),n);var Ht,Y,Fe,zt,xe,Vt,Pe,Yt,je,Xt,ke,ct,$t,qt,pe,Ke,xt,Jt,Wt,k,gt,Se,Le,Pt,jt,kt,me,N,ge,A,lt,Gt,Ce,D,Kt,E,dt,Qt,Zt,_,yt,St,mt,tt,F,X,_t,$e,Me,et,st,Ue,q,M,I,y,x,w,ft,K,$,J,P,G,bt,it,nt,W,T,B,H,u,At,j,te,ee,ut,rt,U,z,Z,se,Ge,ie,Be,ne,He,re,ze,Q,ht,Ot,be,Tt,Ae,Rt,Oe,ae,Ve,Nt,Te,oe,Ye,vt,Re,he,Xe,It,Ne,O,v,Dt,ve,wt,ce,qe,Et,Bt,Lt,Ie,le,ot,Je,de,We,fe,Qe,ue,Ze,Ct,ye,b,we,at,Mt,Ut,g,S,Ft,pt,R,V;const r=class{static get VERSION(){return"0.3.0"}static blockUpdate(s,n){if(r.isOf(s,Function)){r.DEBUG&&r.debug("blocking"),r.RENDERING=!1;try{s(n)}catch(t){throw t}finally{r.RENDERING=!0,r.DEBUG&&r.debug("unblocking")}}}static debug(s){window.console.log(e(r,g).DEBUG_TAG,s)}static isOf(s,n){return!!(s&&s.constructor===n)}static isNonEmptyString(s){return typeof s=="string"&&!!s.length}static forcedStringSplit(s,n){return typeof s=="string"?s.split(n):new window.Array}static hasObjectKeys(s){return!!window.Object.keys(s).length}static buildArray(s){var n;return h(n=r,Ct,ye).call(n,new window.Array,s)}static buildObject(s){var n;return h(n=r,Ct,ye).call(n,new window.Object,s)}static register(s){return e(r,V).registerClasses(r.isOf(s,window.Array)?s:new window.Array(s))}static instantiate(s,n){return e(r,V).instantiateClasses(r.isOf(s,window.Array)?s:new window.Array(s),n)}static isShadowElement(s){const n=window.Object.getPrototypeOf(s.constructor);return n===r.OpenShadowElement||n===r.ClosedShadowElement}};let Wuse=r;Ct=new WeakSet,ye=function(s,n){return r.isOf(n,window.Function)&&n(s),s},b=new WeakMap,we=new WeakMap,at=new WeakMap,Mt=new WeakMap,Ut=new WeakMap,g=new WeakMap,S=new WeakMap,Ft=new WeakMap,pt=new WeakMap,R=new WeakMap,V=new WeakMap,a(Wuse,Ct),c(Wuse,"tmp",new window.Object),c(Wuse,"DEBUG",!1),c(Wuse,"FATALS",!1),c(Wuse,"MEASURE",!1),c(Wuse,"RENDERING",!0),c(Wuse,"EMPTY_ARRAY",new window.Array),c(Wuse,"DOMHelpers",class{static onDOMContentLoaded(s){if(r.isOf(s,window.Function)){const n=()=>{s(),setTimeout(()=>window.removeEventListener("DOMContentLoaded",n),100)};window.addEventListener("DOMContentLoaded",n)}}static getUniqueId(s="WUSE"){for(var n,t="_"+(s||"")+"_";window.document.getElementById(n=t+(""+window.Math.random()).substring(2))!==null;);return n}}),a(Wuse,b,(xt=class{static makeMainNode(s){var n=window.document.createElement(s.tag);if(s.id.length&&n.setAttribute("id",s.id),s.classes.length&&n.setAttribute("class",s.classes.join(" ")),r.hasObjectKeys(s.style)){var t="";for(const i in s.style)t+=i+": "+s.style[i]+"; ";if(t.length){const i=t.trim();n.setAttribute("style",i.endsWith(";")?i.slice(0,-1):i)}}if(r.hasObjectKeys(s.attributes))for(const i in s.attributes)n.setAttribute(i,s.attributes[i]);return n}static makeStyleNode(s,n){var t=window.document.createElement("style");return r.isNonEmptyString(s)&&t.setAttribute("media",s),r.isNonEmptyString(n)&&t.setAttribute("type",n),t.appendChild(window.document.createTextNode("")),t}static newRule(s,n){const t=r.isOf(s,window.Array)?s.join(","):""+s,i=r.isOf(n,window.Object)?n:e(this,Wt).parse(n);return t.length===0?null:{selector:t,properties:i,cache:null}}static newEvent(s,n){return typeof s=="string"&&typeof n=="boolean"?{kind:s,capture:n}:null}static performValidations(s){if(s.kind===e(r,g).TEMPLATES_KIND){if(!window.document.getElementById(s.id))return e(r,S).INEXISTENT_TEMPLATE.emit(s.id)}else if(s.kind===e(r,g).SLOTS_KIND){if(new String(s.attributes.slot).replaceAll('"',"").replaceAll("'","").length===0)return e(r,S).UNESPECIFIED_SLOT.emit(s.id)}else if(typeof s.id!="string"||s.id!==""&&window.document.getElementById(s.id)!==null)return e(r,S).INVALID_ID.emit(s.id);return s}static newChild(s,n){var t=e(this,Jt).parse(s.trimLeft());return t?(t.rules=r.isOf(n,window.Array)?n:new window.Array,t.rendering=!0,t.cache=null,t):e(r,S).INVALID_DEFINITION.emit(s)}static newDefinition(){return{kind:e(r,g).DEFAULT_KIND,tag:e(r,g).DEFAULT_TAG,id:"",classes:new window.Array,attributes:new window.Object,style:new window.Object,events:new window.Array,content:""}}},Jt=new WeakMap,Wt=new WeakMap,a(xt,Jt,(Y=class{static parse(s){if(r.isNonEmptyString(s)){var n=e(r,b).newDefinition();return s.charAt(0)==="%"?s.startsWith(e(r,g).TEMPLATES_KIND)?h(this,ct,$t).call(this,n,s.replace(n.kind=e(r,g).TEMPLATES_KIND,"")):s.startsWith(e(r,g).SLOTS_KIND)?h(this,ct,$t).call(this,n,s.replace(n.kind=e(r,g).SLOTS_KIND,"")):null:h(this,ct,$t).call(this,n,s)}return null}},Ht=new WeakSet,Fe=function(s,n){const t=n.indexOf("["),i=n.indexOf("]");if(t>-1&&i>-1&&i>t){const d=n.substr(t,i-t+1),l=d.substr(1,d.length-2).split("|");for(var o in l){const p=l[o].split("=");p[0]==="style"?p[1].split(";").forEach(L=>{const C=L.split(":"),De=C[0].trim();De.length&&(s.style[De]=C[1].trim())}):s.attributes[p[0]]=p[1]}return n.replace(d,"")}return n},zt=new WeakSet,xe=function(s,n){const t=n.indexOf("=");return t>-1?(s.content=n.slice(t+1),n.slice(0,t)):n},Vt=new WeakSet,Pe=function(s,n){const t=n.replaceAll("!"," ").split(" ");return t.slice(1).map(i=>{const[o,...d]=i.toLowerCase().split("+"),l=(d||r.EMPTY_ARRAY).indexOf("capture")>-1;s.events.push(e(r,b).newEvent(o,l))}),t[0]},Yt=new WeakSet,je=function(s,n){const t=n.replaceAll("."," ").split(" ");return s.classes=t.slice(1),t[0]},Xt=new WeakSet,ke=function(s,n){if(n!==""){const t=n.indexOf("#");t===-1?s.tag=n:(t>0&&(s.tag=n.substr(0,t)),s.id=n.substr(t+1))}return s},ct=new WeakSet,$t=function(s,n){return h(this,Xt,ke).call(this,s,h(this,Yt,je).call(this,s,h(this,Vt,Pe).call(this,s,h(this,zt,xe).call(this,s,h(this,Ht,Fe).call(this,s,n)))))},a(Y,Ht),a(Y,zt),a(Y,Vt),a(Y,Yt),a(Y,Xt),a(Y,ct),Y)),a(xt,Wt,(pe=class{static parse(s){let n=new window.Object;return(r.isOf(s,window.Array)?s:r.forcedStringSplit(s,`
`)).forEach(t=>r.isNonEmptyString(t)&&h(this,qt,Ke).call(this,n,t.trim())),n}},qt=new WeakSet,Ke=function(s,n){if(!!n.length&&n.indexOf(":")>-1){const[t,...i]=n.split(":"),o=t.trim();if(o.length){const d=i.join(":").trim();s[o]=d.endsWith(";")?d.slice(0,-1):d}}},a(pe,qt),pe)),xt)),c(Wuse,"SimpleStorage",(Le=class{constructor(){a(this,gt);a(this,k,new window.Object)}get length(){return h(this,gt,Se).call(this).length}key(s){return h(this,gt,Se).call(this)[s]||null}getItem(s){return e(this,k)[s]}setItem(s,n){e(this,k)[s]=n}removeItem(s){delete e(this,k)[s]}clear(){f(this,k,new window.Object)}has(s){return e(this,k).hasOwnProperty(s)}},k=new WeakMap,gt=new WeakSet,Se=function(){return window.Object.keys(e(this,k))},Le)),a(Wuse,we,new r.SimpleStorage),a(Wuse,at,s=>s>1e3?(s/1e3).toFixed(2)+"s":s.toFixed(2)+"ms"),a(Wuse,Mt,class{constructor(){c(this,"round",0);c(this,"domTime",window.Number.MAX_SAFE_INTEGER);c(this,"renderTime",window.Number.MAX_SAFE_INTEGER)}getDebugInfo(){var n,t;var s=new window.Object;return s.round=this.round,s.domTime=e(n=r,at).call(n,this.domTime),this.renderTime!==window.Number.MAX_SAFE_INTEGER&&(s.renderTime=e(t=r,at).call(t,this.renderTime)),s}}),a(Wuse,Ut,class{constructor(s){c(this,"name","");c(this,"rounds",0);c(this,"time",0);c(this,"average",0);this.name=s}compute(s){this.rounds++,this.time+=s,this.average=this.time/this.rounds}getDebugInfo(){var t,i;const s=e(t=r,at).call(t,this.time),n=e(i=r,at).call(i,this.average);return{name:this.name,rounds:this.rounds,spent:s,average:n}}}),c(Wuse,"StopWatch",(kt=class{constructor(){c(this,"_begin",0);c(this,"_end",{dom:0,render:0});c(this,"rounds",0);c(this,"last",new(e(r,Mt)));c(this,"best",new(e(r,Mt)));c(this,"averages",{dom:0,render:0})}start(){(r.StopWatch.DOMUpdate.check||r.StopWatch.BrowserRender.check)&&(this.last.round=++this.rounds,this._begin=performance.now())}stop(){r.StopWatch.DOMUpdate.check&&(this.best.domTime>(this.last.domTime=(this._end.dom=performance.now())-this._begin)&&(this.best.round=this.last.round,this.best.domTime=this.last.domTime),this.averages.dom=(this.averages.dom*(this.rounds-1)+this.last.domTime)/this.rounds,r.StopWatch.DOMUpdate.overall.compute(this.last.domTime)),r.StopWatch.BrowserRender.check?setTimeout(this.finish.bind(this)):r.DEBUG&&r.debug(JSON.stringify(this.getDebugInfo()),JSON.stringify(r.StopWatch.DOMUpdate.overall.getDebugInfo()))}finish(){this.best.renderTime>(this.last.renderTime=(this._end.render=performance.now())-this._begin)&&(this.best.round=this.last.round,this.best.renderTime=this.last.renderTime),this.averages.render=(this.averages.render*(this.rounds-1)+this.last.renderTime)/this.rounds,r.StopWatch.BrowserRender.overall.compute(this.last.renderTime),r.DEBUG&&r.debug(JSON.stringify(this.getDebugInfo()),JSON.stringify(r.StopWatch.BrowserRender.overall.getDebugInfo()))}getDebugInfo(){return{rounds:this.rounds,last:this.last.getDebugInfo(),best:this.best.getDebugInfo(),averages:this.averages,instances:e(r,R).instancesCount}}},c(kt,"DOMUpdate",(Pt=class{},c(Pt,"check",!0),c(Pt,"overall",new(e(r,Ut))("overall-dom-update")),Pt)),c(kt,"BrowserRender",(jt=class{},c(jt,"check",!1),c(jt,"overall",new(e(r,Ut))("overall-browser-render")),jt)),kt)),c(Wuse,"WasteAnalyzer",(me=class{constructor(){c(this,"rounds",0);c(this,"last",0);c(this,"hash",0);c(this,"wasted",!1)}compute(s){return this.rounds+=+(this.wasted=this.last===(this.hash=r.WasteAnalyzer.hashRoutine(s))),this.last=this.hash,this.wasted}},c(me,"hashRoutine",s=>{var n=0;for(let t=0;t<s.length;t++)n=(n=(n<<5)-n+s.charCodeAt(t))&n;return n}),me)),a(Wuse,g,(N=class{},c(N,"ERROR_TAG","[WUSE:ERROR]"),c(N,"DEBUG_TAG","[WUSE:DEBUG]"),c(N,"TEMPLATES_KIND","%templates%"),c(N,"SLOTS_KIND","%slots%"),c(N,"DEFAULT_KIND",""),c(N,"DEFAULT_TAG","div"),c(N,"DEFAULT_STYLE_MEDIA","screen"),c(N,"DEFAULT_STYLE_TYPE","text/css"),c(N,"DEFAULT_REPLACEMENT_OPEN","~{"),c(N,"DEFAULT_REPLACEMENT_CLOSE","}~"),N)),a(Wuse,S,(ge=class{static get UNKNOWN_ERROR(){return e(this,A).call(this,0,s=>"Unknown error.")}static get UNSUPPORTED_FEATURE(){return e(this,A).call(this,1,s=>`Unsupported feature: ${s}.`)}static get UNREGISTERED_CLASS(){return e(this,A).call(this,2,s=>`Unregistered class: ${s}.`)}static get INVALID_CLASS(){return e(this,A).call(this,3,s=>`Invalid class: ${s}.`)}static get MISNAMED_CLASS(){return e(this,A).call(this,4,s=>`Misnamed class: ${s}.`)}static get INVALID_DEFINITION(){return e(this,A).call(this,10,s=>`Invalid definition: ${s}.`)}static get INVALID_ID(){return e(this,A).call(this,11,s=>`Invalid id: ${s}.`)}static get INVALID_KEY(){return e(this,A).call(this,12,s=>"Call first: this.setElementsStoreKey(<your-valid-key>).")}static get ALLOW_HTML(){return e(this,A).call(this,13,s=>"Call first: this.allowRawContent(true).")}static get INEXISTENT_TEMPLATE(){return e(this,A).call(this,20,s=>`Inexistent template: #${s}.`)}static get EXTINCT_TEMPLATE(){return e(this,A).call(this,21,s=>`Extinct template: #${s}.`)}static get UNESPECIFIED_SLOT(){return e(this,A).call(this,22,s=>`Unespecified slot: #${s}.`)}},A=new WeakMap,a(ge,A,(s,n)=>({code:s,emit:t=>{const i=`${e(r,g).ERROR_TAG} ${s} | ${n(t)}`;if(r.FATALS||s<10)throw new window.Error(i);return window.console.error(i),null}})),ge)),c(Wuse,"ObjectsArray",(Ce=class extends window.Array{constructor(n){super();a(this,lt);c(this,"owner",null);c(this,"last",null);c(this,"version",0);this.owner=n}append(n){r.isOf(n,window.Object)&&(this.push(n),h(this,lt,Gt).call(this,n))}prepend(n){r.isOf(n,window.Object)&&(this.unshift(n),h(this,lt,Gt).call(this,n))}replace(n,t){n>-1&&r.isOf(t,window.Object)&&h(this,lt,Gt).call(this,this[n]=t)}on_version_change(){}persist(){let n=new window.Array;return window.Object.getOwnPropertyNames(this).forEach(t=>{switch(t){case"owner":case"last":case"length":break;case"version":n[t]=this[t];break;default:if(window.Number.isInteger(Number(t))){const i=window.Object.assign(new window.Object,this[t]);i.cache&&(i.cache=null),n.push(i)}break}}),n}restore(n){window.Object.getOwnPropertyNames(n).forEach(t=>{switch(t){case"length":break;case"version":this[t]=n[t];break;default:if(window.Number.isInteger(Number(t))){const i=window.Object.assign(new window.Object,n[t]);i.cache&&(i.cache=null),this.push(i)}break}})}},lt=new WeakSet,Gt=function(n){this.last=n,this.version++,this.on_version_change()},Ce)),c(Wuse,"ReactiveFields",(mt=class{static make(s,n,t,i,o){const d=(L,C)=>window.Object.defineProperty(s,n,{get:L,set:C,enumerable:!0,configurable:!0}),l=()=>delete s[n],p=(L,C)=>this.make(s,n,L,C,o);d(()=>t,L=>{p(L,i),r.isOf(i,window.Function)?i({renderize:C=>o(n,C),automate:()=>p(L,null),freeze:()=>d(()=>L,C=>{}),defreeze:()=>p(L,i),dereact:()=>d(()=>L,C=>{l(),s[n]=C}),remove:()=>l()}):o(n)})}},c(mt,"ReplacementMarkers",(D=class{},c(D,"begin",e(r,g).DEFAULT_REPLACEMENT_OPEN),c(D,"end",e(r,g).DEFAULT_REPLACEMENT_CLOSE),c(D,"enclose",n=>D.begin+n+D.end),c(D,"makeRegExp",()=>new RegExp("(?<="+D.begin+").*?(?="+D.end+")","gs")),D)),c(mt,"ReplacementsScanners",(Kt=class{},c(Kt,"rules",(s,n)=>r.buildArray(t=>s.forEach(i=>i.replacements.forEach(o=>o.field===n&&t.push(i))))),c(Kt,"children",(s,n)=>r.buildArray(t=>{const i=o=>{const d=l=>l.forEach(p=>p.field===n&&t.push(o));["contents","classes","styles","attributes"].forEach(l=>d(o.replacements[l])),o.rules.forEach(l=>l.replacements.forEach(p=>p.field===n&&t.push(o)))};s.forEach(o=>o.rendering&&i(o))})),Kt)),c(mt,"ReplacementsExtractors",(E=class{},dt=new WeakMap,Qt=new WeakMap,Zt=new WeakMap,_=new WeakMap,yt=new WeakMap,St=new WeakMap,a(E,dt,null),a(E,Qt,n=>n.match(e(E,dt)?e(E,dt):f(E,dt,r.ReactiveFields.ReplacementMarkers.makeRegExp()))),a(E,Zt,(n,t,i)=>n.push({at:t,find:r.ReactiveFields.ReplacementMarkers.enclose(i),field:i.trim()})),a(E,_,(n,t,i)=>{var o;return r.isNonEmptyString(i)&&(e(o=E,Qt).call(o,i)||r.EMPTY_ARRAY).forEach(d=>{var l;return e(l=E,Zt).call(l,n,t,d)})}),a(E,yt,(n,t,i)=>{var o;n[t]=new window.Array,e(o=E,_).call(o,n[t],t,i)}),a(E,St,(n,t,i)=>{n[t]=new window.Array,window.Object.keys(i).forEach(o=>{var d,l;e(d=r.ReactiveFields.ReplacementsExtractors,_).call(d,n[t],t,o),e(l=r.ReactiveFields.ReplacementsExtractors,_).call(l,n[t],t,i[o])})}),c(E,"child",n=>r.buildObject(t=>{var i,o,d,l;e(i=E,yt).call(i,t,"contents",n.content),e(o=E,yt).call(o,t,"classes",n.classes.join(" ")),e(d=E,St).call(d,t,"styles",n.style),e(l=E,St).call(l,t,"attributes",n.attributes),n.rules.forEach(p=>p.replacements=r.ReactiveFields.ReplacementsExtractors.rule(p))})),c(E,"rule",n=>r.buildArray(t=>{var o;var i="";for(const d in n.properties)i+=d+":"+n.properties[d]+";";e(o=E,_).call(o,t,"rules",i)})),E)),mt)),a(Wuse,Ft,(Me=class{constructor(s,n){a(this,_t);a(this,tt,null);a(this,F,null);a(this,X,null);f(this,tt,s),f(this,F,n),f(this,X,n.cloneNode(!1))}get element(){return e(this,F)}affiliate(){e(this,tt).appendChild(e(this,F))}disaffiliate(s){e(this,tt).removeChild(e(this,F))}promote(s){e(this,X).innerHTML=s,e(this,tt).replaceChild(e(this,X),e(this,F)),h(this,_t,$e).call(this)}},tt=new WeakMap,F=new WeakMap,X=new WeakMap,_t=new WeakSet,$e=function(){const s=e(this,X);f(this,X,e(this,F).cloneNode(!1)),f(this,F,s)},Me)),a(Wuse,pt,(Ue=class{constructor(s){c(this,"owner",null);a(this,et,!1);a(this,st,"");this.owner=s}reset(s){f(this,et,!1),f(this,st,s)}append(s){f(this,st,e(this,st)+s)}verify(s){r.isOf(s,window.Function)&&f(this,et,s(e(this,st)))}process(){e(this,et)&&this.on_content_invalidation(e(this,st))}get invalidated(){return e(this,et)}on_content_invalidation(s){}},et=new WeakMap,st=new WeakMap,Ue)),a(Wuse,R,(q=class extends window.HTMLElement{constructor(t){super();a(this,z);a(this,se);a(this,ie);a(this,ne);a(this,re);a(this,Q);a(this,Ot);a(this,Tt);a(this,Rt);a(this,ae);a(this,Nt);a(this,oe);a(this,vt);a(this,he);a(this,It);a(this,O);a(this,Dt);a(this,ce);a(this,Et);a(this,Lt);a(this,M,"");a(this,I,new class extends r.ObjectsArray{on_version_change(){var t;this.last.version=this.version,this.last.replacements=r.ReactiveFields.ReplacementsExtractors.rule(this.last),r.DEBUG&&h(t=this.owner,z,Z).call(t,`rules list version change: ${this.version}`)}}(this));a(this,y,new class extends r.ObjectsArray{on_version_change(){var t,i;this.last.version=this.version,this.last.replacements=r.ReactiveFields.ReplacementsExtractors.child(this.last),f(t=this.owner,$,e(t,$)|this.last.kind===e(r,g).SLOTS_KIND),r.DEBUG&&h(i=this.owner,z,Z).call(i,`children list version change: ${this.version}`)}}(this));a(this,x,new class extends r.ObjectsArray{on_version_change(){var t;r.DEBUG&&h(t=this.owner,z,Z).call(t,`fields list version change: ${this.version}`)}snapshot(){this.forEach(t=>t.value=this.owner[t.name])}recall(){this.forEach(t=>this.owner[t.name]=t.value)}}(this));a(this,w,{mainDefinition:e(r,b).newDefinition(),styleMedia:e(r,g).DEFAULT_STYLE_MEDIA,styleType:e(r,g).DEFAULT_STYLE_TYPE,rawContent:!1,attributeKeys:!1,elementKeys:!0});a(this,ft,new window.Object);a(this,K,!1);a(this,$,!1);a(this,J,void 0);a(this,P,void 0);a(this,G,null);a(this,bt,r.isShadowElement(this));a(this,it,!1);a(this,nt,!1);a(this,W,e(r,we));a(this,T,null);a(this,B,"");a(this,H,!1);a(this,u,{root:new class extends e(r,pt){on_content_invalidation(t){this.owner.innerHTML=t}}(this),style:new class extends e(r,pt){on_content_invalidation(t){e(this.owner,P).promote(t)}}(this),main:new class extends e(r,pt){on_content_invalidation(t){e(this.owner,J).promote(t)}}(this),renderizers:{rule:t=>e(this,u).style.append(t.cache?t.cache:t.cache=e(this,ut).rule(t)),children:{mixed:t=>e(this,bt)&&t.kind===e(r,g).SLOTS_KIND?e(this,u).renderizers.children.slot(t):e(this,u).renderizers.children.normal(t),slot:t=>{t.cache||(e(this,u).root.verify(i=>!0),e(this,u).root.append(t.cache=e(this,ut).child(t)))},normal:t=>{e(this,u).main.append(t.cache?t.cache:t.cache=e(this,ut).child(t)),t.rules.forEach(e(this,u).renderizers.rule)}}},gotModified:()=>e(this,u).root.invalidated||e(this,u).main.invalidated||e(this,u).style.invalidated,getDebugInfo:()=>`updated (root: ${e(this,u).root.invalidated}, main: ${e(this,u).main.invalidated}, style: ${e(this,u).style.invalidated})`});a(this,At,{bind:{key:()=>{const t=i=>{r.isNonEmptyString(i)&&(this[i]=h(this,Ot,be).call(this,i))};return e(this,K)&&t(e(this,w).mainDefinition.id),i=>t(i.id)},event:"addEventListener"},unbind:{key:()=>{const t=i=>delete this[i];return e(this,K)&&t(e(this,w).mainDefinition.id),i=>t(i.id)},event:"removeEventListener"}});a(this,j,t=>t.cache=null);a(this,te,t=>t.rendering=!0);a(this,ee,t=>t.rendering=!1);a(this,ut,{rule:t=>{if(t.selector!==""){var i="";for(const o in t.properties)i+=o+":"+t.properties[o]+";";return t.replacements.forEach(o=>i=i.replace(o.find,this[o.field]!==void 0?this[o.field]:"")),t.selector+"{"+i+"}"}return null},child:t=>{if(t.kind===e(r,g).TEMPLATES_KIND){const d=window.document.getElementById(t.id);return d!==null?d.innerHTML:e(r,S).EXTINCT_TEMPLATE.emit(t.id)}var i="<"+t.tag;if(r.isNonEmptyString(t.id)&&(i+=" id='"+t.id+"'"),t.classes.length){var o=t.classes.join(" ");t.replacements.classes.forEach(d=>o=o.replace(d.find,this[d.field]!==void 0?this[d.field]:"")),i+=" class='"+o+"'"}if(r.hasObjectKeys(t.style)){var o=" style='";for(const l in t.style)o+=l+": "+t.style[l]+"; ";o+="'",t.replacements.styles.forEach(l=>o=o.replace(l.find,this[l.field]!==void 0?this[l.field]:"")),i+=o}if(r.hasObjectKeys(t.attributes)){var o="";for(const l in t.attributes)o+=" "+l+"="+t.attributes[l];t.replacements.attributes.forEach(l=>o=o.replace(l.find,this[l.field]!==void 0?this[l.field]:"")),i+=o}if(typeof t.content=="string"){var o=t.content;t.replacements.contents.forEach(l=>o=o.replace(l.find,this[l.field]!==void 0?this[l.field]:"")),i+=">"+o+"</"+t.tag+">"}else i+="/>";return i}});a(this,rt,{main:new r.WasteAnalyzer,style:new r.WasteAnalyzer});a(this,U,{attachment:new r.StopWatch,partial:new r.StopWatch,full:new r.StopWatch,dettachment:new r.StopWatch});a(this,wt,()=>e(r,R).EVENT_NAMES.forEach(t=>e(this,ft)[t]=typeof this[t]=="function"));c(this,"info",{instanceNumber:++e(r,R).instancesCount,unmodifiedRounds:0,updatedRounds:0});f(this,G,t!==e(r,R).RootMode.REGULAR?this.attachShadow({mode:t}):this),e(this,wt).call(this),h(this,O,v).call(this,"on_create"),e(this,w).attributeKeys&&this.getAttributeNames().forEach(i=>this[i]=this.getAttribute(i)),h(this,ce,qe).call(this)&&e(this,T).generation>1?h(this,O,v).call(this,"on_reconstruct",e(this,T)):h(this,O,v).call(this,"on_construct")}static get EVENT_NAMES(){return["on_create","on_construct","on_reconstruct","on_connect","on_inject","on_load","on_prerender","on_update","on_postrender","on_refresh","on_unload","on_reload","on_repaint","on_disconnect"]}render(){}redraw(){}connectedCallback(){r.MEASURE&&e(this,U).attachment.start(),e(this,wt).call(this),h(this,O,v).call(this,"on_connect"),h(this,It,Ne).call(this,"render",h(this,ae,Ve)),h(this,It,Ne).call(this,"redraw",h(this,oe,Ye)),h(this,Nt,Te).call(this,"on_load"),e(this,H)&&this.persistToElementsStore(),r.MEASURE&&e(this,U).attachment.stop()}disconnectedCallback(){r.MEASURE&&e(this,U).dettachment.start(),h(this,Q,ht).call(this,!1),h(this,O,v).call(this,"on_disconnect"),r.MEASURE&&e(this,U).dettachment.stop()}getElementsStore(){return e(this,W)}setElementsStore(t){f(this,W,t)}hasElementsStoreKey(t){return e(this,H)}getElementsStoreKey(t){return e(this,B)}setElementsStoreKey(t){return f(this,H,r.isNonEmptyString(f(this,B,t))),this}persistToElementsStore(){if(h(this,Lt,Ie).call(this)){const t=e(this,T);if(t)return e(this,x).snapshot(),t.data=new window.Object({options:e(this,w),html:e(this,M),children:e(this,y).persist(),rules:e(this,I).persist(),fields:e(this,x).persist(),slotted:e(this,$),identified:e(this,K)}),h(this,Et,Bt).call(this),!0}return!1}restoreFromElementsStore(t){if(h(this,Lt,Ie).call(this)){const i=e(this,T);if(i&&i.persisted&&i.data)return f(this,w,i.data.options),f(this,$,i.data.slotted),f(this,K,i.data.identified),f(this,M,i.data.html),e(this,y).restore(i.data.children),e(this,y).owner=this,e(this,I).restore(i.data.rules),e(this,I).owner=this,e(this,x).restore(i.data.fields),e(this,x).owner=this,e(this,x).recall(),t||(delete i.data,h(this,Et,Bt).call(this)),!0}return!1}selectChildElement(t){return e(this,G).querySelector(t)}setMainAttribute(t,i){e(this,it)&&e(this,J).element.setAttribute(t,i)}setMainElement(t){const i=e(r,b).newChild(t);if(e(r,b).performValidations(i)){if(i.content!==""||!!i.events.length)return e(r,S).INVALID_DEFINITION.emit(t);f(this,K,!!i.id.length)&&(e(this,w).mainDefinition.id=i.id),i.tag.length&&(e(this,w).mainDefinition.tag=i.tag),i.classes.length&&(e(this,w).mainDefinition.classes=i.classes),i.style&&(e(this,w).mainDefinition.style=i.style),i.attributes&&(e(this,w).mainDefinition.attributes=i.attributes)}return this}setStyleOptions(t,i){return r.isNonEmptyString(t)&&(e(this,w).styleMedia=t),r.isNonEmptyString(i)&&(e(this,w).styleType=i),this}setElementsAsKeys(t){return e(this,w).elementKeys=!!t,this}setAttributesAsKeys(t){return e(this,w).attributeKeys=!!t,this}allowRawContent(t){return e(this,w).rawContent=!!t,this}setRawContent(t){return e(this,w).rawContent?f(this,M,t):e(r,S).ALLOW_HTML.emit(),this}appendRawContent(t){return e(this,w).rawContent?f(this,M,e(this,M)+t):e(r,S).ALLOW_HTML.emit(),this}prependRawContent(t){return e(this,w).rawContent?f(this,M,t+e(this,M)):e(r,S).ALLOW_HTML.emit(),this}appendCSSRule(t,i){return e(this,I).append(e(r,b).newRule(t,i)),this}prependCSSRule(t,i){return e(this,I).prepend(e(r,b).newRule(t,i)),this}appendChildElement(t,i){return e(this,y).append(e(r,b).performValidations(e(r,b).newChild(t,i))),this}prependChildElement(t,i){return e(this,y).prepend(e(r,b).performValidations(e(r,b).newChild(t,i))),this}replaceChildElement(t,i){return e(this,y).replace(e(this,y).findIndex(o=>o.id===t),e(r,b).newChild(i)),this}appendChildElements(t){return(r.isOf(t,window.Array)?t:r.forcedStringSplit(t,`
`)).forEach(i=>typeof i=="string"&&!!i.trim().length&&this.appendChildElement(i)),this}prependChildElements(t){return(r.isOf(t,window.Array)?t:r.forcedStringSplit(t,`
`)).forEach(i=>typeof i=="string"&&!!i.trim().length&&this.prependChildElement(i)),this}checkChildElementIsIncludedById(t,i,o){const d=l=>r.isOf(l,window.Function)?l():void 0;return e(this,y).some(l=>l.id===t&&l.rendering)?d(i):d(o),this}includeChildElementById(t){return e(this,y).forEach(i=>i.id===t&&e(this,te).call(this,i)),this}excludeChildElementById(t){return e(this,y).forEach(i=>i.id===t&&e(this,ee).call(this,i)),this}invalidateChildElementsById(t){return e(this,y).forEach(i=>t.indexOf(i.id)>-1&&e(this,j).call(this,i)),this}invalidateChildElements(t){return r.isOf(t,window.Array)&&t.forEach(e(this,j)),this}makeField(t,i){return this[t]=i,e(this,x).append({name:t,value:i}),this}makeReactiveField(t,i,o,d=!0){return h(this,he,Xe).call(this,t,i,o,d),e(this,x).append({name:t,value:i}),this}makeExternalReactiveField(t,i,o,d,l=!0){return this.makeReactiveField(i,t[i]||o,p=>{t[i]=this[i],d(p)},l),this}},M=new WeakMap,I=new WeakMap,y=new WeakMap,x=new WeakMap,w=new WeakMap,ft=new WeakMap,K=new WeakMap,$=new WeakMap,J=new WeakMap,P=new WeakMap,G=new WeakMap,bt=new WeakMap,it=new WeakMap,nt=new WeakMap,W=new WeakMap,T=new WeakMap,B=new WeakMap,H=new WeakMap,u=new WeakMap,At=new WeakMap,j=new WeakMap,te=new WeakMap,ee=new WeakMap,ut=new WeakMap,rt=new WeakMap,U=new WeakMap,z=new WeakSet,Z=function(t){e(this,K)&&r.debug(`#${e(this,w).mainDefinition.id} (${this.info.instanceNumber}) | ${typeof t=="string"?t:JSON.stringify(t)}`)},se=new WeakSet,Ge=function(){e(this,P)&&e(this,P).affiliate(),e(this,J).affiliate(),f(this,it,!0)},ie=new WeakSet,Be=function(){f(this,P,e(this,I).length?new(e(r,Ft))(e(this,G),e(r,b).makeStyleNode(e(this,w).styleMedia,e(this,w).styleType)):null),f(this,J,new(e(r,Ft))(e(this,G),e(r,b).makeMainNode(e(this,w).mainDefinition))),e(this,y).forEach(e(this,j)),e(this,I).forEach(e(this,j))},ne=new WeakSet,He=function(){e(this,it)&&(e(this,J).disaffiliate(),e(this,P)&&e(this,P).disaffiliate(),e(this,$)&&e(this,bt)&&(this.innerHTML="")),f(this,it,!1)},re=new WeakSet,ze=function(t){return{key:e(this,w).elementKeys&&t.key(),event:(i,o,d)=>{const l=this[`on_${i}_${o}`];if(l){const p=h(this,Ot,be).call(this,i);p&&p[t.event](o,l,d)}},slots:()=>this.on_slot_change&&e(this,G).querySelectorAll("slot").forEach(i=>i[t.event]("slotchange",this.on_slot_change))}},Q=new WeakSet,ht=function(t){if(e(this,nt)&&!t||!e(this,nt)&&t){const i=h(this,re,ze).call(this,t?e(this,At).bind:e(this,At).unbind);e(this,y).forEach(o=>{!o.rendering&&t||(i.key&&i.key(o),o.events.forEach(d=>d&&i.event(o.id,d.kind,d.capture)))}),e(this,$)&&i.slots(),f(this,nt,t)}},Ot=new WeakSet,be=function(t){return r.isNonEmptyString(t)?e(this,G).querySelector(`#${t}`):void 0},Tt=new WeakSet,Ae=function(){e(this,u).root.reset(""),e(this,u).style.reset(""),e(this,u).main.reset(e(this,M));const t=e(this,$)?e(this,u).renderizers.children.mixed:e(this,u).renderizers.children.normal;e(this,y).forEach(i=>i.rendering&&t(i)),e(this,I).forEach(e(this,u).renderizers.rule),e(this,u).main.verify(i=>!e(this,rt).main.compute(i)),e(this,u).style.verify(i=>!e(this,rt).style.compute(i))},Rt=new WeakSet,Oe=function(){e(this,u).root.process(),e(this,u).style.process(),e(this,u).main.process(),r.DEBUG&&h(this,z,Z).call(this,e(this,u).getDebugInfo())},ae=new WeakSet,Ve=function(){!r.RENDERING||(r.MEASURE&&e(this,U).partial.start(),h(this,O,v).call(this,"on_prerender"),h(this,Tt,Ae).call(this),e(this,u).gotModified()?(h(this,Q,ht).call(this,!1),h(this,Rt,Oe).call(this),h(this,Q,ht).call(this,!0),this.info.updatedRounds++,h(this,O,v).call(this,"on_update"),h(this,Dt,ve).call(this,"on_refresh")):this.info.unmodifiedRounds++,r.DEBUG&&h(this,z,Z).call(this,`unmodified: ${this.info.unmodifiedRounds} (main: ${e(this,rt).main.rounds}, style: ${e(this,rt).style.rounds}) | updated: ${this.info.updatedRounds}`),h(this,O,v).call(this,"on_postrender"),r.MEASURE&&e(this,U).partial.stop())},Nt=new WeakSet,Te=function(t){h(this,ie,Be).call(this),h(this,se,Ge).call(this),h(this,O,v).call(this,"on_inject"),h(this,Tt,Ae).call(this),e(this,u).style.verify(i=>!!e(this,P)),h(this,Rt,Oe).call(this),h(this,Q,ht).call(this,!0),h(this,O,v).call(this,t)},oe=new WeakSet,Ye=function(t){r.MEASURE&&e(this,U).full.start(),h(this,Q,ht).call(this,!1),h(this,ne,He).call(this),h(this,O,v).call(this,"on_unload"),e(this,wt).call(this),h(this,Nt,Te).call(this,"on_reload"),h(this,Dt,ve).call(this,"on_repaint"),r.MEASURE&&e(this,U).full.stop()},vt=new WeakSet,Re=function(t,i="$none"){if(e(this,nt)){const o=r.ReactiveFields.ReplacementsScanners.rules(e(this,I),t);o.forEach(e(this,j));const d=r.ReactiveFields.ReplacementsScanners.children(e(this,y),t);d.forEach(e(this,j)),r.DEBUG&&h(this,z,Z).call(this,`reactive render (label: ${i}, field: ${t}, children: ${d.length}, rules: ${o.length})`),(!!o.length||!!d.length)&&(d.some(l=>!!l.kind.length)&&e(this,y).forEach(l=>l.kind===e(r,g).SLOTS_KIND?e(this,j).call(this,l):void 0),this.render())}},he=new WeakSet,Xe=function(t,i,o,d=!0){r.ReactiveFields.make(this,t,i,o,(l,p)=>h(this,vt,Re).call(this,l,p||"$auto")),d&&h(this,vt,Re).call(this,t,"$init")},It=new WeakSet,Ne=function(t,i){delete this[t],window.Object.defineProperty(this,t,{value:i})},O=new WeakSet,v=function(t,i){e(this,ft)[t]&&this[t].call(this,i)},Dt=new WeakSet,ve=function(t,i){e(this,H)&&this.persistToElementsStore(),e(this,ft)[t]&&window.requestAnimationFrame(()=>this[t].call(this,i))},wt=new WeakMap,ce=new WeakSet,qe=function(){return e(this,H)?(f(this,T,e(this,W).has(e(this,B))?e(this,W).getItem(e(this,B)):{generation:0,persisted:!1}),e(this,T).generation++,h(this,Et,Bt).call(this),!0):!1},Et=new WeakSet,Bt=function(){r.DEBUG&&(e(this,T).key=e(this,B)),e(this,T).persisted=!!e(this,T).data,e(this,W).setItem(e(this,B),e(this,T))},Lt=new WeakSet,Ie=function(){return e(this,H)?!0:(e(r,S).INVALID_KEY.emit(),!1)},c(q,"RootMode",class{static get REGULAR(){return"regular"}static get OPEN(){return"open"}static get CLOSED(){return"closed"}}),c(q,"specializeClass",t=>class extends q{constructor(){super(t)}}),c(q,"instancesCount",0),q)),a(Wuse,V,(ot=class{static registerClasses(s){window.Array.prototype.forEach.call(s,h(e(r,V),de,We))}static instantiateClasses(s,n){window.Array.prototype.forEach.call(s,t=>{var i;return window.customElements.get(t.tag)?h(i=e(r,V),ue,Ze).call(i,t,n):e(r,S).UNREGISTERED_CLASS.emit(t.name)})}},le=new WeakSet,Je=function(s){return s.toLowerCase().replaceAll("_","-")},de=new WeakSet,We=function(s){var n;r.isNonEmptyString(s.name)&&s.name.indexOf("_")>0?s.tag=h(n=e(r,V),le,Je).call(n,s.name):e(r,S).MISNAMED_CLASS.emit(s.name),window.HTMLElement.isPrototypeOf(s)?window.customElements.define(s.tag,s):e(r,S).INVALID_CLASS.emit(s.name)},fe=new WeakSet,Qe=function(s,n){const t=r.isNonEmptyString(n)?window.document.querySelector(n):window.document.body;t&&t.appendChild(window.document.createElement(s.tag))},ue=new WeakSet,Ze=function(s,n){const t=()=>{var i;return h(i=e(r,V),fe,Qe).call(i,s,n)};window.document.body?t():r.DOMHelpers.onDOMContentLoaded(t)},a(ot,le),a(ot,de),a(ot,fe),a(ot,ue),ot)),c(Wuse,"NonShadowElement",e(r,R).specializeClass(e(r,R).RootMode.REGULAR)),c(Wuse,"OpenShadowElement",e(r,R).specializeClass(e(r,R).RootMode.OPEN)),c(Wuse,"ClosedShadowElement",e(r,R).specializeClass(e(r,R).RootMode.CLOSED)),(()=>{const s=(n,t)=>!n&&e(r,S).UNSUPPORTED_FEATURE.emit(t);try{s(r.isOf(window.document,window.HTMLDocument),"HTML Document"),s(r.isOf(window.customElements,window.CustomElementRegistry),"Custom Elements"),r.DOMHelpers.onDOMContentLoaded(()=>s(r.isOf(window.document.body.attachShadow,window.Function),"Shadow DOM"))}catch(n){e(r,S).UNKNOWN_ERROR.emit()}})();
