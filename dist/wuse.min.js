(()=>{var pn=Object.defineProperty;var gn=(s,e,t)=>e in s?pn(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var a=(s,e,t)=>(gn(s,typeof e!="symbol"?e+"":e,t),t),di=(s,e,t)=>{if(!e.has(s))throw TypeError("Cannot "+t)};var n=(s,e,t)=>(di(s,e,"read from private field"),t?t.call(s):e.get(s)),o=(s,e,t)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,t)},h=(s,e,t,i)=>(di(s,e,"write to private field"),i?i.call(s,t):e.set(s,t),t);var d=(s,e,t)=>(di(s,e,"access private method"),t);var S=(s,e)=>({code:s,emit:t=>{let i=s<80?"error":"warn",r=`[WUSE:${i.toUpperCase()}] ${s} | ${e(t)}`;if(window.Wuse&&window.Wuse.FATALS||s<10)throw new window.Error(r);return window.console[i](r),null}}),T=class{static get UNKNOWN_ERROR(){return S(0,e=>"Unknown error.")}static get UNSUPPORTED_FEATURE(){return S(1,e=>`Unsupported feature: ${e}.`)}static get UNREGISTERED_CLASS(){return S(2,e=>`Unregistered class: ${e}.`)}static get UNREGISTRABLE_CLASS(){return S(3,e=>`Unregistrable class: ${e}.`)}static get INVALID_CLASS(){return S(4,e=>`Invalid class: ${e}.`)}static get MISNAMED_CLASS(){return S(5,e=>`Misnamed class: ${e}.`)}static get INVALID_DEFINITION(){return S(10,e=>`Invalid definition: ${e}.`)}static get INVALID_ID(){return S(11,e=>`Invalid id: ${e}.`)}static get INVALID_KEY(){return S(12,e=>"Call first: this.setElementsStoreKey(<your-valid-key>).")}static get ALLOW_HTML(){return S(13,e=>"Call first: this.allowRawContent(true).")}static get INVALID_STATE(){return S(14,e=>"Invalid state.")}static get TAKEN_ID(){return S(15,e=>`Taken id: ${e}.`)}static get INEXISTENT_TEMPLATE(){return S(20,e=>`Inexistent template: #${e}.`)}static get EXTINCT_TEMPLATE(){return S(21,e=>`Extinct template: #${e}.`)}static get INVALID_TEMPLATE(){return S(22,e=>`Invalid template: #${e}.`)}static get UNESPECIFIED_SLOT(){return S(30,e=>`Unespecified slot: #${e}.`)}static get LOCKED_DEFINITION(){return S(40,e=>`Locked definition: #${e}.`)}static get UNKNOWN_TAG(){return S(80,e=>`Unknown tag: ${e}.`)}static get BAD_TARGET(){return S(81,e=>`Bad target: ${e}.`)}static get ALREADY_REGISTERED(){return S(90,e=>`Already registered: ${e}.`)}};var De,Ne,_i=(s,e)=>(typeof e=="function"&&e(s),s),p=class{static get EMPTY_STRING(){return n(this,De)}static get EMPTY_ARRAY(){return n(this,Ne)}static noop(){}static isNonEmptyString(e){return typeof e=="string"&&!!e.length}static forcedStringSplit(e,t){return typeof e=="string"?e.split(t):new window.Array}static buildArray(e){return _i(new window.Array,e)}static buildObject(e){return _i(new window.Object,e)}static ensureFunction(e,t=()=>{}){return typeof e=="function"?e:t}static isOf(e,t){return e!=null&&(e.constructor===t||t!=null&&e.constructor.name===t.name)}static hasObjectKeys(e){return!!(e&&!!window.Object.keys(e).length)}static cloneObject(e){return window.Object.assign(new window.Object,e)}static forEachOwnProperty(e,t){e&&window.Object.getOwnPropertyNames(e).forEach(t)}static isAssignedObject(e){return typeof e=="object"&&e!==null}static isAssignedArray(e){return typeof e=="object"&&e!==null&&e.constructor.name==="Array"}static isNonEmptyArray(e){return typeof e=="object"&&e!==null&&e.constructor.name==="Array"&&!!e.length}static isIntegerNumber(e){return(typeof e=="number"||typeof e=="string"&&!!e.length)&&window.Number.isInteger(window.Number(e))}};De=new WeakMap,Ne=new WeakMap,o(p,De,new window.String().valueOf()),o(p,Ne,window.Object.freeze(new window.Array));var Ct,Ot,{noop:vi,ensureFunction:Di,isAssignedObject:En}=p,dt=class{static fetch(e){let t=window.document.getElementById(e);return t===null?n(this,Ct).call(this,e):t.tagName!=="TEMPLATE"?n(this,Ot).call(this,e):t.innerHTML}static initialize(e){En(e)&&(h(this,Ct,Di(e.onExtinctTemplate,n(this,Ct))),h(this,Ot,Di(e.onInvalidTemplate,n(this,Ot))))}};Ct=new WeakMap,Ot=new WeakMap,o(dt,Ct,vi),o(dt,Ot,vi);var Lt,Ut,Rt,kt,Wt,Ft,Mt,Ce,Oi,Oe,Li,Le,Ui,Ue,Ri,Re,ki,{noop:pt,ensureFunction:ht,isAssignedObject:Ni,isAssignedArray:ys,isNonEmptyArray:Ci,isOf:yn}=p,Tn=s=>s.toLowerCase().replaceAll("_","-"),A=class{static registerClasses(e){Ci(e)&&window.Array.prototype.forEach.call(e,t=>typeof t=="function"?d(this,Le,Ui).call(this,t):n(this,kt).call(this,t))}static instantiateClasses(e,t,i){Ci(e)&&window.Array.prototype.forEach.call(e,r=>window.customElements.get(r.tag)?d(this,Re,ki).call(this,r,t,Ni(i)?i:new window.Object):n(this,Ft).call(this,r.name))}static initialize(e){Ni(e)&&(h(this,Lt,ht(e.onBadTarget,n(this,Lt))),h(this,Ut,ht(e.onDeferredInstantiation,n(this,Ut))),h(this,kt,ht(e.onInvalidClass,n(this,kt))),h(this,Rt,ht(e.onMisnamedClass,n(this,Rt))),h(this,Wt,ht(e.onUnregistrableClass,n(this,Wt))),h(this,Ft,ht(e.onUnregisteredClass,n(this,Ft))),h(this,Mt,ht(e.onAlreadyRegistered,n(this,Mt))))}};Lt=new WeakMap,Ut=new WeakMap,Rt=new WeakMap,kt=new WeakMap,Wt=new WeakMap,Ft=new WeakMap,Mt=new WeakMap,Ce=new WeakSet,Oi=function(e){window.HTMLElement.isPrototypeOf(e)?window.customElements.define(e.tag,e):n(this,Wt).call(this,e.name)},Oe=new WeakSet,Li=function(e){window.customElements.get(e.tag=Tn(e.name))?n(this,Mt).call(this,e.name):d(this,Ce,Oi).call(this,e)},Le=new WeakSet,Ui=function(e){e.name.indexOf("_")>0?d(this,Oe,Li).call(this,e):n(this,Rt).call(this,e.name)},Ue=new WeakSet,Ri=function(e,t,i){let r=null;try{r=window.document.querySelector(t)}catch(c){if(yn(i.on_bad_target,window.Function)){if(i.on_bad_target(t)===!1)return}else{n(this,Lt).call(this,t);return}}finally{r=r||window.document.body}let l=window.document.createElement(e.tag);ht(i.on_element_instantiated)(l,t),r.appendChild(l)},Re=new WeakSet,ki=function(e,t,i){let r=()=>d(this,Ue,Ri).call(this,e,t,i);window.document.body?r():n(this,Ut).call(this,r)},o(A,Ce),o(A,Oe),o(A,Le),o(A,Ue),o(A,Re),o(A,Lt,pt),o(A,Ut,pt),o(A,Rt,pt),o(A,kt,pt),o(A,Wt,pt),o(A,Ft,pt),o(A,Mt,pt);var X=class{static defaultRoutine(e=""){var t=0;for(let i=0;i<e.length;i++)t=(t=(t<<5)-t+e.charCodeAt(i))&t;return t}};var Wi=X.defaultRoutine,bn=["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","bgsound","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","content","col","colgroup","datalist","dd","del","details","dfn","dialog","dir","div","dl","dt","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","i","iframe","img","input","ins","isindex","kbd","keygen","label","legend","li","link","listing","main","map","marquee","mark","menu","menuitem","meta","meter","multicol","nav","nextid","nobr","noembed","noframes","noscript","object","ol","optgroup","option","output","p","param","plaintext","pre","progress","q","rb","rp","rt","rtc","ruby","s","samp","script","section","shadow","select","slot","small","source","spacer","span","strike","strong","style","sub","sup","summary","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","xmp","wbr"].map(Wi),K=class{static onDOMContentLoaded(e){if(e&&e.constructor===window.Function){let t=()=>{e(),setTimeout(()=>window.removeEventListener("DOMContentLoaded",t),100)};window.addEventListener("DOMContentLoaded",t)}}static getUniqueId(e="WUSE"){let t="_"+(e||"")+"_";for(var i;window.document.getElementById(i=t+(""+window.Math.random()).substring(2))!==null;);return i}static removeChildren(e){if(e)for(;e.firstChild;)e.removeChild(e.firstChild)}static isHTMLTag(e){return bn.indexOf(Wi(e))>-1}static htmlEncode(e=""){return typeof e!="string"?null:e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}static getCSSVendorPrefix(){let e=window.getComputedStyle(window.document.body,""),i=window.Array.prototype.slice.call(e).filter(r=>r.charAt(0)==="-");return i.length?"-"+i[0].split("-")[1]+"-":""}};var B=class{static get TEMPLATES_KIND(){return"%templates%"}static get SLOTS_KIND(){return"%slots%"}static get TEXTNODE_TAG(){return"^text^"}static get DEFAULT_KIND(){return""}static get DEFAULT_TAG(){return"div"}static get DEFAULT_STYLE_MEDIA(){return"screen"}static get DEFAULT_STYLE_TYPE(){return"text/css"}static get DEFAULT_REPLACEMENT_OPEN(){return"~{"}static get DEFAULT_REPLACEMENT_CLOSE(){return"}~"}static get WUSEKEY_ATTRIBUTE(){return"data-wusekey"}static get WUSENODE_ATTRIBUTE(){return"data-wusenode"}};var{noop:In,isOf:hi,isNonEmptyString:Sn}=p;function Fi(s,e,t,i,r,l,c){let u=(_,j)=>Fi(s,e,t,_,j,l,c);s(()=>i,_=>{u(_,r),hi(r,window.Function)?r({renderize:j=>l(t,j),automate:()=>u(_,null),freeze:()=>s(()=>_,In),defreeze:()=>u(_,r),dereact:()=>s(()=>_,j=>{c(t),e[t]=j}),remove:()=>c(t)}):l(t)})}var Xt=class{static createReactiveField(e,t,i,r,l,c){if(e&&Sn(t)&&hi(l,window.Function)){let u=(j,ve)=>window.Object.defineProperty(e,t,{get:j,set:ve,enumerable:!0,configurable:!0}),_=hi(c,window.Function)?c:j=>delete e[j];return Fi(u,e,t,i,r,l,_)}return null}};var Qt,ke,gt,Zt,te,{EMPTY_ARRAY:An,buildArray:ci,buildObject:_n,isNonEmptyString:vn,isOf:Dn}=p,$t=class{static initialize(e,t){this.begin=e,this.end=t}},Q=$t;a(Q,"begin",null),a(Q,"end",null),a(Q,"enclose",e=>$t.begin+e+$t.end),a(Q,"makeRegExp",()=>new window.RegExp(`(?<=${$t.begin}).*?(?=${$t.end})`,"gs"));var Nn=["contents","classes","styles","attributes"],xt=class{};a(xt,"rules",(e,t)=>ci(i=>e.forEach(r=>r.replacements.forEach(l=>l.field===t&&i.push(r))))),a(xt,"children",(e,t)=>ci(i=>{let r=l=>{let c=u=>u.forEach(_=>_.field===t&&i.push(l));Nn.forEach(u=>c(l.replacements[u])),l.rules.forEach(u=>u.replacements.forEach(_=>_.field===t&&i.push(l)))};e.forEach(l=>l.included&&r(l))}));var L=class{static initialize(e){h(this,Qt,e)}},M=L;Qt=new WeakMap,ke=new WeakMap,gt=new WeakMap,Zt=new WeakMap,te=new WeakMap,o(M,Qt,null),o(M,ke,(e,t,i)=>e.push({at:t,field:i.trim(),find:Q.enclose(i)})),o(M,gt,(e,t,i)=>vn(i)&&(i.match(n(L,Qt))||An).forEach(r=>{var l;return n(l=L,ke).call(l,e,t,r)})),o(M,Zt,(e,t,i)=>{var r;e[t]=new window.Array,n(r=L,gt).call(r,e[t],t,i)}),o(M,te,(e,t,i)=>{e[t]=new window.Array,window.Object.keys(i).forEach(r=>{var l,c;n(l=L,gt).call(l,e[t],t,r),n(c=L,gt).call(c,e[t],t,i[r])})}),a(M,"child",e=>_n(t=>{var i,r,l,c;n(i=L,Zt).call(i,t,"contents",e.content),n(r=L,Zt).call(r,t,"classes",e.classes.join(" ")),n(l=L,te).call(l,t,"styles",e.style),n(c=L,te).call(c,t,"attributes",e.attributes),e.rules.forEach(u=>u.replacements=L.rule(u))})),a(M,"rule",e=>ci(t=>{var r;if(Dn(e.nested,window.Array))return e.nested.map(l=>L.rule(l));var i="";for(let l in e.properties)i+=`${l}:${e.properties[l]};`;n(r=L,gt).call(r,t,"rules",i)}));var R=class{static initialize(e,t){Q.initialize(e,t),M.initialize(Q.makeRegExp())}};a(R,"extractReplacementsFromRule",M.rule),a(R,"extractReplacementsFromChild",M.child),a(R,"scanRulesForReplacements",xt.rules),a(R,"scanChildrenForReplacements",xt.children);var jt,{noop:Cn,isOf:On,hasObjectKeys:Mi,isNonEmptyString:xi,isNonEmptyArray:Ln,isAssignedObject:Un,ensureFunction:Rn}=p,{htmlEncode:$i}=K,{SLOTS_KIND:kn,TEMPLATES_KIND:Wn,TEXTNODE_TAG:Fn}=B,ee=class{static initialize(e){Un(e)&&h(this,jt,Rn(e.onFetchTemplate,n(this,jt)))}},b=ee;jt=new WeakMap,o(b,jt,Cn),a(b,"cacheInvalidator",e=>e.cache=null),a(b,"slotsInvalidator",e=>e.kind===kn?ee.cacheInvalidator(e):void 0),a(b,"renderingIncluder",e=>e.included=!0),a(b,"renderingExcluder",e=>e.included=!1),a(b,"renderRule",(e,t)=>{if(On(t.nested,window.Array))return`${t.selector}{${t.nested.map(r=>ee.renderRule(e,r)).join(`
`)}}`;if(xi(t.selector)&&!t.nested){var i=new window.String;for(let r in t.properties)i+=`${r}:${t.properties[r]};`;return Ln(t.replacements)&&t.replacements.forEach(r=>i=e(i,r)),`${t.selector}{${i}}`}return null}),a(b,"renderChild",(e,t)=>{var l;if(t.kind===Wn)return n(l=ee,jt).call(l,t.id);if(t.tag===Fn){var i=t.content;return t.replacements.contents.forEach(c=>i=e(i,c)),t.encode?$i(i):i}var r=xi(t.id)?`<${t.tag} id='${t.id}'`:`<${t.tag}`;if(t.classes.length){var i=t.classes.join(" ");t.replacements.classes.forEach(u=>i=e(i,u)),r+=` class='${i}'`}if(Mi(t.style)){var i=" style='";for(let u in t.style)i+=`${u}: ${t.style[u]}; `;i+="'",t.replacements.styles.forEach(u=>i=e(i,u)),r+=i}if(Mi(t.attributes)){var i=new window.String;for(let u in t.attributes)i+=` ${u}=${t.attributes[u]}`;t.replacements.attributes.forEach(u=>i=e(i,u)),r+=i}if(typeof t.content=="string"){var i=t.content;t.replacements.contents.forEach(u=>i=e(i,u)),r+=`>${t.encode?$i(i):i}</${t.tag}>`}else r+="/>";return r});var ie,ne,se,re,{ensureFunction:Mn}=p,Kt=class{constructor(e){a(this,"rounds",0);o(this,ie,0);o(this,ne,null);o(this,se,!1);o(this,re,null);h(this,re,Mn(e))}compute(e){return this.rounds+=+h(this,se,n(this,ie)==h(this,ne,n(this,re).call(this,e))),h(this,ie,n(this,ne)),n(this,se)}};ie=new WeakMap,ne=new WeakMap,se=new WeakMap,re=new WeakMap;var Et,ct,Bt,ae,le,C,Z,yt,Gt,Fe,{ensureFunction:ui,isNonEmptyString:xn,isOf:We}=p,oe=class{constructor(e,t,i,r={}){o(this,Gt);o(this,Et,new window.String);o(this,ct,!1);o(this,Bt,null);o(this,ae,null);o(this,le,null);o(this,C,null);o(this,Z,null);o(this,yt,new class extends window.Set{name(e,t){let i=`${e}_${t}`;for(var r=0;this.has(i);)i=`${e}_${t}_${++r}`;return this.add(i),i}});h(this,Bt,ui(e)),h(this,ae,ui(t)),h(this,le,ui(i)),h(this,Z,r)}getStore(){return n(this,Z)}setStore(e){h(this,Z,e)}get state(){return n(this,C)}get key(){return n(this,Et)}set key(e){return h(this,ct,xn(h(this,Et,e)))}hasKey(){return n(this,ct)}validateKey(){return n(this,ct)?!0:(this.on_invalid_key(),!1)}nameFiliatedKey(e){return n(this,yt).name(n(this,Et),e)}rememberFiliatedKey(e){n(this,yt).add(e)}hasFiliatedKey(e){return n(this,yt).has(e)}initializeState(){if(n(this,yt).clear(),n(this,ct)){let e=n(this,Z).hasItem(this.key)?n(this,Z).getItem(this.key):n(this,Bt).call(this);if(We(e,window.Object))h(this,C,e),n(this,C).generation++,d(this,Gt,Fe).call(this);else return this.on_invalid_state(),-1}else h(this,C,n(this,Bt).call(this)),n(this,C).generation++;return n(this,C).generation}writeState(){let e=n(this,C);return We(e,window.Object)?(e.data=n(this,le).call(this),d(this,Gt,Fe).call(this),!0):!1}readState(){let e=n(this,C);return We(e,window.Object)&&e.persisted?(n(this,ae).call(this,e.data),!0):!1}eraseState(){let e=n(this,C);return We(e,window.Object)&&e.persisted&&e.data?(delete e.data,d(this,Gt,Fe).call(this),!0):!1}on_invalid_state(){}on_invalid_key(){}};Et=new WeakMap,ct=new WeakMap,Bt=new WeakMap,ae=new WeakMap,le=new WeakMap,C=new WeakMap,Z=new WeakMap,yt=new WeakMap,Gt=new WeakSet,Fe=function(){n(this,ct)&&(n(this,C).persisted=!!n(this,C).data,n(this,Z).setItem(n(this,Et),n(this,C)))};var tt,P,ut,Me,Ki,xe,Bi,{WUSENODE_ATTRIBUTE:ji}=B,Ht=class{constructor(e,t){o(this,Me);o(this,xe);o(this,tt,null);o(this,P,null);o(this,ut,null);if(e instanceof Node&&t instanceof Node)h(this,tt,e),d(this,Me,Ki).call(this,t.getAttribute(ji)),h(this,P,t),h(this,ut,t.cloneNode(!1));else throw new Error("[WUSE:ERROR] Wrong arguments supplied.")}get element(){return n(this,P)}affiliate(){n(this,tt).appendChild(n(this,P))}disaffiliate(){n(this,tt).removeChild(n(this,P))}promote(e){n(this,ut).innerHTML=e,n(this,tt).replaceChild(n(this,ut),n(this,P)),d(this,xe,Bi).call(this)}};tt=new WeakMap,P=new WeakMap,ut=new WeakMap,Me=new WeakSet,Ki=function(e){let t=n(this,tt).querySelector(`[${ji}='${e}']`);t&&n(this,tt).removeChild(t)},xe=new WeakSet,Bi=function(){let e=n(this,ut);h(this,ut,n(this,P).cloneNode(!1)),h(this,P,e)};var Tt,bt,It=class{constructor(e){a(this,"owner",null);o(this,Tt,!1);o(this,bt,"");this.owner=e}get invalidated(){return n(this,Tt)}reset(e){h(this,Tt,!1),h(this,bt,e)}append(e){h(this,bt,n(this,bt)+e)}verify(e){h(this,Tt,e(n(this,bt)))}process(e){(e||n(this,Tt))&&this.on_content_invalidation(n(this,bt))}on_content_invalidation(e){}};Tt=new WeakMap,bt=new WeakMap;var St,de,{isIntegerNumber:$n,isOf:fi,cloneObject:jn,forEachOwnProperty:Kn,buildArray:Bn}=p,Gi=(s,e,t)=>Kn(s,i=>{switch(i){case"owner":case"last":case"length":break;case"version":case"locked":t(i);break;default:$n(i)&&e(i)}}),Hi=(s,e,t)=>{t(e);let i=jn(e);i.cache=null,s.push(i)},At=class extends window.Array{constructor(t){super();o(this,St);a(this,"owner",null);a(this,"last",null);a(this,"version",0);a(this,"locked",!1);this.owner=t}append(t){this.locked?this.on_forbidden_change():fi(t,window.Object)&&(this.push(t),d(this,St,de).call(this,t))}prepend(t){this.locked?this.on_forbidden_change():fi(t,window.Object)&&(this.unshift(t),d(this,St,de).call(this,t))}replace(t,i){this.locked?this.on_forbidden_change():t>-1&&fi(i,window.Object)&&d(this,St,de).call(this,this[t]=i)}remove(t){if(this.locked)this.on_forbidden_change();else if(t>-1){let i=this.splice(t,1);d(this,St,de).call(this,i.length?i[0]:null)}}persist(){return Bn(t=>Gi(this,i=>Hi(t,this[i],this.on_snapshot_part),i=>t[i]=this[i]))}restore(t,i){this.owner=t,Gi(i,r=>Hi(this,i[r],this.on_recall_part),r=>this[r]=i[r])}on_snapshot_part(){}on_recall_part(){}on_version_change(){}on_forbidden_change(){}};St=new WeakSet,de=function(t){this.last=t,this.version++,this.on_version_change()};var je,qi,Ke,Xi,Be,Qi,Ge,Zi,He,tn,zt,$e,ze,en,{isHTMLTag:Gn}=K,{EMPTY_STRING:x,EMPTY_ARRAY:Hn,noop:he,buildArray:zs,buildObject:zn,isOf:O,hasObjectKeys:zi,isNonEmptyString:ft,forcedStringSplit:Pn}=p,{WUSENODE_ATTRIBUTE:Pi,DEFAULT_TAG:Jn,DEFAULT_KIND:Ji,TEMPLATES_KIND:wi,SLOTS_KIND:mi,TEXTNODE_TAG:Js}=B,Yn=X.defaultRoutine,J={onInvalidDefinition:he,onInexistentTemplate:he,onUnespecifiedSlot:he,onInvalidId:he,onUnknownTag:he},Vn=s=>s.indexOf("-")>0&&!Gn(s),et=class{static parse(e){if(ft(e)){let t=e.trimLeft(),i=Yi();return t.charAt(0)==="%"?t.startsWith(wi)?d(this,zt,$e).call(this,i,t.replace(i.kind=wi,x)):t.startsWith(mi)?d(this,zt,$e).call(this,i,t.replace(i.kind=mi,x)):null:d(this,zt,$e).call(this,i,t)}return null}};je=new WeakSet,qi=function(e,t){let i=t.indexOf("["),r=t.indexOf("]");if(i>-1&&r>-1&&r>i){let l=t.substr(i,r-i+1),c=l.substr(1,l.length-2).split("|");for(let u in c){let _=c[u].split("=");_[0]==="style"?_[1].split(";").forEach(j=>{let ve=j.split(":"),Ai=ve[0].trim();Ai.length&&(e.style[Ai]=ve[1].trim())}):e.attributes[_[0]]=_[1]}return t.replace(l,x)}return t},Ke=new WeakSet,Xi=function(e,t){let i=t.indexOf("=");return i>-1?(e.content=t.slice(i+1),!!e.content.length&&e.content.charAt(0)==="&"&&(e.content=e.content.slice(1),e.encode=!!e.content.length&&e.content.charAt(0)!=="&"),t.slice(0,i)):t},Be=new WeakSet,Qi=function(e,t){let i=t.replaceAll("!"," ").split(" ");return i.slice(1).map(r=>{let[l,...c]=r.toLowerCase().split("+"),u=(c||Hn).indexOf("capture")>-1;e.events.push(Vi(l,u))}),i[0]},Ge=new WeakSet,Zi=function(e,t){let i=t.replaceAll("."," ").split(" ");return e.classes=i.slice(1),i[0]},He=new WeakSet,tn=function(e,t){if(ft(t)){let i=t.indexOf("#");i===-1?e.tag=t:(i>0&&(e.tag=t.substr(0,i)),e.id=t.substr(i+1))}return e},zt=new WeakSet,$e=function(e,t){return d(this,He,tn).call(this,e,d(this,Ge,Zi).call(this,e,d(this,Be,Qi).call(this,e,d(this,Ke,Xi).call(this,e,d(this,je,qi).call(this,e,t)))))},o(et,je),o(et,Ke),o(et,Be),o(et,Ge),o(et,He),o(et,zt);var ce=class{static parse(e){return zn(t=>(O(e,window.Array)?e:Pn(e,`
`).map(i=>i.trim()).join(x).split(";")).forEach(i=>ft(i)&&d(this,ze,en).call(this,t,i.trim())))}};ze=new WeakSet,en=function(e,t){if(!!t.length&&t.indexOf(":")>-1){let[i,...r]=t.split(":"),l=i.trim();if(l.length){let c=r.join(":").trim();e[l]=c.endsWith(";")?c.slice(0,-1):c}}},o(ce,ze);var Yi=()=>({kind:Ji,tag:Jn,id:x,classes:new window.Array,attributes:new window.Object,style:new window.Object,events:new window.Array,content:x,encode:!1}),qn=()=>({generation:0,persisted:!1}),Vi=(s,e)=>typeof s=="string"&&typeof e=="boolean"?{kind:s,capture:e}:null,Xn=(s,e)=>{let t=et.parse(s);return t?(t.custom=t.kind===Ji&&Vn(t.tag),t.hash=Yn(s),t.rules=O(e,window.Array)?e:new window.Array,t.included=!0,t.cache=null,t):J.onInvalidDefinition(s)},Qn=s=>{if(s!==null)if(s.kind===wi){if(!window.document.getElementById(s.id))return J.onInexistentTemplate(s.id)}else if(s.kind===mi){if(new window.String(s.attributes.slot).replaceAll('"',x).replaceAll("'",x).length===0)return J.onUnespecifiedSlot(s.id)}else{if(typeof s.id!="string")return J.onInvalidId(s.id);s.custom&&!window.customElements.get(s.tag)&&J.onUnknownTag(s.tag)}return s},Zn=s=>{if(!O(s,window.Object))return null;let e=window.document.createElement(s.tag);if(s.id.length&&e.setAttribute("id",s.id),s.classes.length&&e.setAttribute("class",s.classes.join(" ")),zi(s.style)){var t=new window.String;for(let i in s.style)t+=`${i}: ${s.style[i]}; `;if(t.length){let i=t.trim();e.setAttribute("style",i.endsWith(";")?i.slice(0,-1):i)}}if(zi(s.attributes))for(let i in s.attributes)e.setAttribute(i,s.attributes[i]);return e.setAttribute(Pi,"main"),e},ts=(s,e)=>{let t=window.document.createElement("style");return ft(s)&&t.setAttribute("media",s),ft(e)&&t.setAttribute("type",e),t.setAttribute(Pi,"style"),t.appendChild(window.document.createTextNode(x)),t},es=(s,e)=>{let t=O(s,window.Array)?s.join(","):ft(s)?s:x;return t.length?{selector:t,properties:O(e,window.Object)?e:ce.parse(e),cache:null}:null},is=(s,e,t)=>{let i=O(s,window.Array)?s.join(","):ft(s)?s:x,r=O(e,window.Array)?e.join(","):ft(e)?e:x;return!i.length||!r.length?null:{selector:i,nested:[{selector:r,properties:O(t,window.Object)?t:ce.parse(t)}],cache:null}},ns=(s,e)=>{if(s.selector===e.selector){for(let t in e.properties)s.properties[t]=e.properties[t];return s.cache=null,!0}return!1},ss=(s,e)=>O(s.nested,window.Array)&&s.selector===e.selector?(e.nested.forEach(t=>{var i=!1;for(let r in s.nested)if(i=s.nested[r].selector===t.selector){for(let l in t.properties)s.nested[r].properties[l]=t.properties[l];break}i||s.nested.push(t)}),s.cache=null,!0):!1,f=class{static initialize(e){O(e,window.Object)&&(O(e.onInvalidDefinition,window.Function)&&(J.onInvalidDefinition=e.onInvalidDefinition),O(e.onInexistentTemplate,window.Function)&&(J.onInexistentTemplate=e.onInexistentTemplate),O(e.onUnespecifiedSlot,window.Function)&&(J.onUnespecifiedSlot=e.onUnespecifiedSlot),O(e.onInvalidId,window.Function)&&(J.onInvalidId=e.onInvalidId),O(e.onUnknownTag,window.Function)&&(J.onUnknownTag=e.onUnknownTag))}};a(f,"makeStyleNode",ts),a(f,"newRule",es),a(f,"newNestedRule",is),a(f,"tryToJoinRules",ns),a(f,"tryToJoinNestedRules",ss),a(f,"performValidations",Qn),a(f,"makeMainNode",Zn),a(f,"newChild",Xn),a(f,"newDefinition",Yi),a(f,"newEvent",Vi),a(f,"newState",qn);var k=class{static get REGULAR(){return"regular"}static get OPEN(){return"open"}static get CLOSED(){return"closed"}};a(k,"specializeClass",(e,t)=>class extends e{constructor(){super(t)}});var it,Pt,rs=["on_create","on_construct","on_reconstruct","on_connect","on_inject","on_load","on_prerender","on_update","on_postrender","on_refresh","on_unload","on_reload","on_repaint","on_disconnect"],ue=class{constructor(e){o(this,it,null);o(this,Pt,new window.Object);h(this,it,e)}detect(){rs.forEach(e=>n(this,Pt)[e]=typeof n(this,it)[e]=="function")}immediateTrigger(e,t){n(this,Pt)[e]&&n(this,it)[e].call(n(this,it),t)}committedTrigger(e,t){n(this,Pt)[e]&&window.requestAnimationFrame(()=>n(this,it)[e].call(n(this,it),t))}};it=new WeakMap,Pt=new WeakMap;var G,g,I,U,w,D,we,nt,V,me,st,q,rt,wt,ot,vt,pe,Ve,qe,E,m,Yt,ge,Dt,H,$,Y,Xe,on,Qe,an,Ze,ln,ti,dn,mt,Jt,Vt,Ye,Ee,pi,ye,gi,ei,hn,Te,Ei,ii,cn,be,yi,Ie,Ti,{EMPTY_STRING:fe,noop:W,isOf:v,isNonEmptyArray:nn,isNonEmptyString:_t,forcedStringSplit:sn}=p,{removeChildren:os}=K,{WUSEKEY_ATTRIBUTE:Pe,DEFAULT_STYLE_TYPE:as,DEFAULT_STYLE_MEDIA:ls,DEFAULT_REPLACEMENT_OPEN:ds,DEFAULT_REPLACEMENT_CLOSE:hs,SLOTS_KIND:rn}=B,{createReactiveField:cs}=Xt,N={onInvalidState:W,onInvalidKey:W,onInvalidDefinition:W,onLockedDefinition:W,onTakenId:W,onAllowHTML:W},Je=(s,e)=>f.performValidations(f.newChild(s,e)),bi=class extends window.HTMLElement{constructor(t){super();o(this,$);o(this,Xe);o(this,Qe);o(this,Ze);o(this,ti);o(this,mt);o(this,Vt);o(this,Ee);o(this,ye);o(this,ei);o(this,Te);o(this,ii);o(this,be);o(this,Ie);o(this,G,new window.String);o(this,g,new class extends At{constructor(){super(...arguments);a(this,"on_version_change",()=>{var i;this.last!==null&&(this.last.version=this.version,this.last.replacements=R.extractReplacementsFromRule(this.last)),window.Wuse.DEBUG&&d(i=this.owner,$,Y).call(i,`rules list version change: ${this.version}`)});a(this,"on_forbidden_change",()=>{var i;window.Wuse.DEBUG&&d(i=this.owner,$,Y).call(i,"rules list is locked and can not be changed"),N.onLockedDefinition(n(this,w).mainDefinition.id)})}}(this));o(this,I,new class extends At{constructor(){super(...arguments);a(this,"on_version_change",()=>{var i,r;this.last!==null&&(this.last.version=this.version,this.last.replacements=R.extractReplacementsFromChild(this.last)),n(this.owner,V)||h(i=this.owner,V,n(i,V)|this.some(l=>l.kind===rn)),window.Wuse.DEBUG&&d(r=this.owner,$,Y).call(r,`children list version change: ${this.version}`)});a(this,"on_forbidden_change",()=>{var i;window.Wuse.DEBUG&&d(i=this.owner,$,Y).call(i,"children list is locked and can not be changed"),N.onLockedDefinition(n(this,w).mainDefinition.id)});a(this,"on_recall_part",i=>n(this.owner,pe).tryToRemember(i))}}(this));o(this,U,new class extends At{constructor(){super(...arguments);a(this,"on_version_change",()=>{var i;window.Wuse.DEBUG&&d(i=this.owner,$,Y).call(i,`fields list version change: ${this.version}`)});a(this,"on_forbidden_change",()=>{var i;window.Wuse.DEBUG&&d(i=this.owner,$,Y).call(i,"fields list is locked and can not be changed"),N.onLockedDefinition(n(this,w).mainDefinition.id)});a(this,"on_snapshot_part",i=>i.value=this.owner[i.name]);a(this,"on_recall_part",i=>this.owner[i.name]=i.value)}}(this));o(this,w,{mainDefinition:f.newDefinition(),styleMedia:ls,styleType:as,rawContent:!1,attributeKeys:!1,elementKeys:!0,autokeyChildren:!0});o(this,D,new ue(this));o(this,we,!1);o(this,nt,!1);o(this,V,!1);o(this,me,window.Wuse.isShadowElement(this));o(this,st,void 0);o(this,q,void 0);o(this,rt,null);o(this,wt,!1);o(this,ot,!1);o(this,vt,!0);o(this,pe,{tryToName:t=>{t.attributes[Pe]||(t.attributes[Pe]=n(this,E).nameFiliatedKey(t.hash))},tryToRemember:t=>{let i=t.attributes[Pe];i&&n(this,E).rememberFiliatedKey(i)}});o(this,Ve,t=>{t&&(h(this,w,t.options),h(this,V,t.slotted),h(this,nt,t.identified),h(this,G,t.html),n(this,I).restore(this,t.children),n(this,g).restore(this,t.rules),n(this,U).restore(this,t.fields))});o(this,qe,()=>({options:n(this,w),html:n(this,G),children:n(this,I).persist(),rules:n(this,g).persist(),fields:n(this,U).persist(),slotted:n(this,V),identified:n(this,nt)}));o(this,E,new class extends oe{on_invalid_state(){N.onInvalidState()}on_invalid_key(){N.onInvalidKey()}}(f.newState,n(this,Ve),n(this,qe),window.Wuse.elementsStorage));o(this,m,{root:new class extends It{on_content_invalidation(t){this.owner.innerHTML=t}}(this),style:new class extends It{on_content_invalidation(t){n(this.owner,q).promote(t)}}(this),main:new class extends It{on_content_invalidation(t){n(this.owner,st).promote(t)}}(this),verifiers:{main:t=>!n(this,Dt).main.compute(t),style:t=>!n(this,Dt).style.compute(t)},renderizers:{rule:t=>n(this,m).style.append(t.cache?t.cache:t.cache=b.renderRule(n(this,Yt),t)),children:{mixed:t=>n(this,me)&&t.kind===rn?n(this,m).renderizers.children.slot(t):n(this,m).renderizers.children.normal(t),slot:t=>{t.cache||(n(this,m).root.verify(i=>!0),n(this,m).root.append(t.cache=b.renderChild(n(this,Yt),t)))},normal:t=>{n(this,m).main.append(t.cache?t.cache:t.cache=b.renderChild(n(this,Yt),t)),t.rules.forEach(n(this,m).renderizers.rule)}}},gotModified:()=>n(this,m).root.invalidated||n(this,m).main.invalidated||n(this,m).style.invalidated,getDebugInfo:()=>`updated (root: ${n(this,m).root.invalidated}, main: ${n(this,m).main.invalidated}, style: ${n(this,m).style.invalidated})`});o(this,Yt,(t,i)=>t.replace(i.find,this[i.field]!==void 0?this[i.field]:fe));o(this,ge,{bind:{key:()=>{let t=i=>_t(i)?this[i]=d(this,Vt,Ye).call(this,i):void 0;return n(this,nt)&&t(n(this,w).mainDefinition.id),i=>t(i.id)},event:"addEventListener"},unbind:{key:()=>{let t=i=>delete this[i];return n(this,nt)&&t(n(this,w).mainDefinition.id),i=>t(i.id)},event:"removeEventListener"}});o(this,Dt,{main:new Kt(window.Wuse.hashRoutine),style:new Kt(window.Wuse.hashRoutine)});o(this,H,{attachment:new window.Wuse.PerformanceMeasurement.StopWatch,partial:new window.Wuse.PerformanceMeasurement.StopWatch,full:new window.Wuse.PerformanceMeasurement.StopWatch,dettachment:new window.Wuse.PerformanceMeasurement.StopWatch});a(this,"info",{instanceNumber:++bi.instancesCount,unmodifiedRounds:0,updatedRounds:0});h(this,rt,t!==k.REGULAR?this.attachShadow({mode:t}):this),n(this,D).detect(),n(this,D).immediateTrigger("on_create"),n(this,w).attributeKeys&&this.getAttributeNames().forEach(i=>this[i]=this.getAttribute(i)),this.dataset.wusekey&&this.setElementsStoreKey(this.dataset.wusekey),n(this,D).immediateTrigger(n(this,E).initializeState()>1?"on_reconstruct":"on_construct",n(this,E).state),h(this,we,!0)}get render(){return n(this,ot)?d(this,ei,hn):W}get redraw(){return n(this,ot)?d(this,ii,cn):W}connectedCallback(){window.Wuse.MEASURE&&n(this,H).attachment.start(),n(this,D).detect(),n(this,D).immediateTrigger("on_connect"),d(this,Te,Ei).call(this,"on_load"),n(this,E).writeState(),window.Wuse.MEASURE&&n(this,H).attachment.stop(window.Wuse.DEBUG)}disconnectedCallback(){window.Wuse.MEASURE&&n(this,H).dettachment.start(),d(this,mt,Jt).call(this,!1),n(this,D).immediateTrigger("on_disconnect"),n(this,E).writeState(),window.Wuse.MEASURE&&n(this,H).dettachment.stop(window.Wuse.DEBUG)}getElementsStore(){return n(this,E).getStore()}setElementsStore(t){return n(this,E).setStore(t),this}hasElementsStoreKey(){return n(this,E).hasKey()}getElementsStoreKey(t){return n(this,E).key}setElementsStoreKey(t){return(n(this,E).key=t)&&(this.setAttribute(Pe,t),n(this,E).writeState()),this}deriveChildrenStoreKey(t){n(this,w).autokeyChildren=t}persistToElementsStore(){return n(this,E).validateKey()&&n(this,E).writeState()}restoreFromElementsStore(){return n(this,E).validateKey()&&n(this,E).readState()}removeFromElementsStore(){return n(this,E).validateKey()&&n(this,E).eraseState()}selectChildElement(t){return n(this,rt).querySelector(t)}getMainAttribute(t){return n(this,wt)?n(this,st).element.setAttribute(t):void 0}setMainAttribute(t,i){return n(this,wt)&&n(this,st).element.setAttribute(t,i),this}setMainElement(t){let i=Je(t);if(i!==null){if(_t(i.content)||nn(i.events))return N.onInvalidDefinition(t);h(this,nt,_t(i.id))&&(n(this,w).mainDefinition.id=i.id),_t(i.tag)&&(n(this,w).mainDefinition.tag=i.tag),nn(i.classes)&&(n(this,w).mainDefinition.classes=i.classes),v(i.style,window.Object)&&(n(this,w).mainDefinition.style=i.style),v(i.attributes,window.Array)&&(n(this,w).mainDefinition.attributes=i.attributes)}return this}setStyleOptions(t,i){return n(this,w).styleMedia=_t(t)?t:fe,n(this,w).styleType=_t(i)?i:fe,this}setElementsAsKeys(t){return n(this,w).elementKeys=!!t,this}setAttributesAsKeys(t){return n(this,w).attributeKeys=!!t,this}allowRawContent(t){return n(this,w).rawContent=!!t,this}setRawContent(t){return n(this,w).rawContent?h(this,G,t):N.onAllowHTML(),this}appendRawContent(t){return n(this,w).rawContent?h(this,G,n(this,G)+t):N.onAllowHTML(),this}prependRawContent(t){return n(this,w).rawContent?h(this,G,t+n(this,G)):N.onAllowHTML(),this}lockCSSRules(){return n(this,g).locked=!0,this}unlockCSSRules(){return n(this,g).locked=!1,this}appendCSSRule(t,i,r){if(r)return this.appendCSSNestedRule(t,i,r);let l=n(this,g).slice(-1),c=f.newRule(t,i);return(!l.length||!f.tryToJoinRules(l[0],c))&&n(this,g).append(c),this}prependCSSRule(t,i,r){if(r)return this.prependCSSNestedRule(t,i,r);let l=n(this,g).slice(0,1),c=f.newRule(t,i);return(!l.length||!f.tryToJoinRules(l[0],c))&&n(this,g).prepend(c),this}appendCSSNestedRule(t,i,r){let l=n(this,g).slice(-1),c=f.newNestedRule(t,i,r);return(!l.length||!f.tryToJoinNestedRules(l[0],c))&&n(this,g).append(c),this}prependCSSNestedRule(t,i,r){let l=n(this,g).slice(0,1),c=f.newNestedRule(t,i,r);return(!l.length||!f.tryToJoinNestedRules(l[0],c))&&n(this,g).prepend(c),this}hasCSSRuleBySelector(t){for(let i=0;i<n(this,g).length;i++)if(n(this,g)[i].selector===t)return!0;return!1}replaceCSSRuleBySelector(t,i){for(let r=0;r<n(this,g).length;r++)if(n(this,g)[r].selector===t){n(this,g)[r]=f.newRule(t,i);break}return this}removeCSSRuleBySelector(t){for(let i=0;i<n(this,g).length;i++)if(n(this,g)[i].selector===t){n(this,g).splice(i,1);break}return this}lockChildElements(){return n(this,I).locked=!0,this}unlockChildElements(){return n(this,I).locked=!1,this}appendChildElement(t,i){let r=d(this,Ie,Ti).call(this,Je(t,i));return r!==null&&n(this,I).append(r),this}prependChildElement(t,i){let r=d(this,Ie,Ti).call(this,Je(t,i));return r!==null&&n(this,I).prepend(r),this}appendChildElements(t){return(v(t,window.Array)?t:sn(t,`
`)).forEach(i=>typeof i=="string"&&!!i.trim().length&&this.appendChildElement(i)),this}prependChildElements(t){return(v(t,window.Array)?t:sn(t,`
`)).forEach(i=>typeof i=="string"&&!!i.trim().length&&this.prependChildElement(i)),this}replaceChildElementById(t,i,r){let l=Je(i,r);return l!==null&&n(this,I).replace(n(this,I).findIndex(c=>c.id===t),l),this}removeChildElementById(t){return n(this,I).remove(n(this,I).findIndex(i=>i.id===t)),this}checkChildElementIsIncludedById(t,i,r){let l=c=>v(c,window.Function)?c():void 0;return n(this,I).some(c=>c.id===t&&c.included)?l(i):l(r),this}includeChildElementById(t){return n(this,I).forEach(i=>i.id===t&&b.renderingIncluder(i)),this}excludeChildElementById(t){return n(this,I).forEach(i=>i.id===t&&b.renderingExcluder(i)),this}invalidateChildElementsById(t){return n(this,I).forEach(i=>t.indexOf(i.id)>-1&&b.cacheInvalidator(i)),this}invalidateChildElements(t){return v(t,window.Array)&&t.forEach(b.cacheInvalidator),this}lockInstanceFields(){return n(this,U).locked=!0,this}unlockInstanceFields(){return n(this,U).locked=!1,this}makeField(t,i){return this[t]=i,n(this,U).append({name:t,value:i}),this}makeReactiveField(t,i,r,l=!0){return cs(this,t,i,r,(c,u)=>d(this,be,yi).call(this,c,u||"$auto"),c=>this.dropField(c)),n(this,U).append({name:t,value:i}),l&&d(this,be,yi).call(this,t,"$init"),this}makeExternalReactiveField(t,i,r,l,c=!0){return this.makeReactiveField(i,t[i]||r,u=>{t[i]=this[i],l(u)},c)}hasField(t){for(let i=0;i<n(this,U).length;i++)if(n(this,U)[i].name===t)return!0;return!1}dropField(t){for(let i=0;i<n(this,U).length;i++)if(n(this,U)[i].name===t)return this.hasOwnProperty(t)&&delete this[t],n(this,U).splice(i,1),n(this,E).writeState(),!0;return!1}suspendRender(){return h(this,vt,!1),this}resumeRender(t=!0){return h(this,vt,!0),t&&this.render(),this}isRenderSuspended(){return!n(this,vt)}static initialize(t){if(R.initialize(ds,hs),v(t,window.Object)){v(t.onFetchTemplate,window.Function)&&b.initialize({onFetchTemplate:t.onFetchTemplate}),v(t.onAllowHTML,window.Function)&&(N.onAllowHTML=t.onAllowHTML),v(t.onInvalidKey,window.Function)&&(N.onInvalidKey=t.onInvalidKey),v(t.onInvalidState,window.Function)&&(N.onInvalidState=t.onInvalidState),v(t.onLockedDefinition,window.Function)&&(N.onLockedDefinition=t.onLockedDefinition),v(t.onTakenId,window.Function)&&(N.onTakenId=t.onTakenId);let i={onInvalidDefinition:W,onInexistentTemplate:W,onUnespecifiedSlot:W,onInvalidId:W,onUnknownTag:W};v(t.onInvalidDefinition,window.Function)&&(N.onInvalidDefinition=t.onInvalidDefinition,i.onInvalidDefinition=t.onInvalidDefinition),v(t.onInexistentTemplate,window.Function)&&(i.onInexistentTemplate=t.onInexistentTemplate),v(t.onUnespecifiedSlot,window.Function)&&(i.onUnespecifiedSlot=t.onUnespecifiedSlot),v(t.onInvalidId,window.Function)&&(i.onInvalidId=t.onInvalidId),v(t.onUnknownTag,window.Function)&&(i.onUnknownTag=t.onUnknownTag),f.initialize(i)}}},z=bi;G=new WeakMap,g=new WeakMap,I=new WeakMap,U=new WeakMap,w=new WeakMap,D=new WeakMap,we=new WeakMap,nt=new WeakMap,V=new WeakMap,me=new WeakMap,st=new WeakMap,q=new WeakMap,rt=new WeakMap,wt=new WeakMap,ot=new WeakMap,vt=new WeakMap,pe=new WeakMap,Ve=new WeakMap,qe=new WeakMap,E=new WeakMap,m=new WeakMap,Yt=new WeakMap,ge=new WeakMap,Dt=new WeakMap,H=new WeakMap,$=new WeakSet,Y=function(t){n(this,nt)&&window.Wuse.debug(`#${n(this,w).mainDefinition.id} (${this.info.instanceNumber}) | ${typeof t=="string"?t:JSON.stringify(t)}`)},Xe=new WeakSet,on=function(){n(this,q)&&n(this,q).affiliate(),n(this,st).affiliate(),h(this,wt,!0)},Qe=new WeakSet,an=function(){h(this,q,n(this,g).length?new Ht(n(this,rt),f.makeStyleNode(n(this,w).styleMedia,n(this,w).styleType)):null),h(this,st,new Ht(n(this,rt),f.makeMainNode(n(this,w).mainDefinition))),n(this,I).forEach(b.cacheInvalidator),n(this,g).forEach(b.cacheInvalidator)},Ze=new WeakSet,ln=function(){n(this,wt)&&(n(this,st).disaffiliate(),n(this,q)&&n(this,q).disaffiliate(),n(this,V)&&n(this,me)&&os(this)),h(this,wt,!1)},ti=new WeakSet,dn=function(t){return{key:n(this,w).elementKeys&&t.key(),event:(i,r,l)=>{let c=this[`on_${i}_${r}`];if(c){let u=d(this,Vt,Ye).call(this,i);u&&u[t.event](r,c,l)}},slots:()=>this.on_slot_change&&n(this,rt).querySelectorAll("slot").forEach(i=>i[t.event]("slotchange",this.on_slot_change))}},mt=new WeakSet,Jt=function(t){if(n(this,ot)&&!t||!n(this,ot)&&t){let i=d(this,ti,dn).call(this,t?n(this,ge).bind:n(this,ge).unbind);n(this,I).forEach(r=>{!r.included&&t||(i.key&&i.key(r),r.events.forEach(l=>l&&i.event(r.id,l.kind,l.capture)))}),n(this,V)&&i.slots(),h(this,ot,t)}},Vt=new WeakSet,Ye=function(t){return _t(t)?n(this,rt).querySelector(`#${t}`):void 0},Ee=new WeakSet,pi=function(){n(this,m).root.reset(fe),n(this,m).style.reset(fe),n(this,m).main.reset(n(this,G));let t=n(this,V)?n(this,m).renderizers.children.mixed:n(this,m).renderizers.children.normal;n(this,I).forEach(i=>i.included&&t(i)),n(this,g).forEach(n(this,m).renderizers.rule),n(this,m).main.verify(n(this,m).verifiers.main),n(this,m).style.verify(n(this,m).verifiers.style)},ye=new WeakSet,gi=function(t,i,r){n(this,m).root.process(t),n(this,m).style.process(i),n(this,m).main.process(r),window.Wuse.DEBUG&&d(this,$,Y).call(this,n(this,m).getDebugInfo())},ei=new WeakSet,hn=function(){!window.Wuse.RENDERING||!n(this,vt)||(window.Wuse.MEASURE&&n(this,H).partial.start(),n(this,D).immediateTrigger("on_prerender"),d(this,Ee,pi).call(this),n(this,m).gotModified()?(d(this,mt,Jt).call(this,!1),d(this,ye,gi).call(this,!1,!1,!1),d(this,mt,Jt).call(this,!0),this.info.updatedRounds++,n(this,D).immediateTrigger("on_update"),n(this,E).writeState(),n(this,D).committedTrigger("on_refresh")):this.info.unmodifiedRounds++,window.Wuse.DEBUG&&d(this,$,Y).call(this,`unmodified: ${this.info.unmodifiedRounds} (main: ${n(this,Dt).main.rounds}, style: ${n(this,Dt).style.rounds}) | updated: ${this.info.updatedRounds}`),n(this,D).immediateTrigger("on_postrender"),window.Wuse.MEASURE&&n(this,H).partial.stop(window.Wuse.DEBUG))},Te=new WeakSet,Ei=function(t){d(this,Qe,an).call(this),d(this,Xe,on).call(this),n(this,D).immediateTrigger("on_inject"),d(this,Ee,pi).call(this),d(this,ye,gi).call(this,!1,!!n(this,q),!0),d(this,mt,Jt).call(this,!0),n(this,D).immediateTrigger(t)},ii=new WeakSet,cn=function(){window.Wuse.MEASURE&&n(this,H).full.start(),d(this,mt,Jt).call(this,!1),d(this,Ze,ln).call(this),n(this,D).immediateTrigger("on_unload"),n(this,D).detect(),d(this,Te,Ei).call(this,"on_reload"),n(this,E).writeState(),n(this,D).committedTrigger("on_repaint"),window.Wuse.MEASURE&&n(this,H).full.stop(window.Wuse.DEBUG)},be=new WeakSet,yi=function(t,i="$none"){if(n(this,ot)){let r=R.scanRulesForReplacements(n(this,g),t);r.forEach(b.cacheInvalidator);let l=R.scanChildrenForReplacements(n(this,I),t);l.forEach(b.cacheInvalidator),window.Wuse.DEBUG&&d(this,$,Y).call(this,`reactive render (label: ${i}, field: ${t}, children: ${l.length}, rules: ${r.length})`),(!!r.length||!!l.length)&&(l.some(c=>!!c.kind.length)&&n(this,I).forEach(b.slotsInvalidator),this.render())}},Ie=new WeakSet,Ti=function(t){if(t!==null){if(n(this,we)&&d(this,Vt,Ye).call(this,t.id))return N.onTakenId(t.id);t.custom&&n(this,w).autokeyChildren&&n(this,E).hasKey()&&n(this,pe).tryToName(t)}return t},a(z,"instancesCount",0);var un=(s,e)=>window.Object.getOwnPropertyNames(e).forEach(t=>Object.defineProperty(s,t,{value:e[t],writable:!1,configurable:!1,enumerable:!1})),Nt=class{static detectFeatures(e){let t=(i,r)=>!i&&T.UNSUPPORTED_FEATURE.emit(r);try{t(e.JsHelpers.isOf(window.document,window.HTMLDocument),"HTML Document"),t(e.JsHelpers.isOf(window.customElements,window.CustomElementRegistry),"Custom Elements"),e.WebHelpers.onDOMContentLoaded(()=>t(e.JsHelpers.isOf(window.document.body.attachShadow,window.Function),"Shadow DOM"))}catch(i){T.UNKNOWN_ERROR.emit()}}static initializeModules(e){e.PerformanceMeasurement.initialize((t,i)=>e.debug(JSON.stringify(e.JsHelpers.buildArray(r=>{switch(r.push({instances:e.elementCount}),r.push(t.getDebugInfo()),i){case"stop":r.push(e.PerformanceMeasurement.DOMUpdate.overall.getDebugInfo());break;case"finish":r.push(e.PerformanceMeasurement.BrowserRender.overall.getDebugInfo());break}})))),dt.initialize({onExtinctTemplate:T.EXTINCT_TEMPLATE.emit,onInvalidTemplate:T.INVALID_TEMPLATE.emit}),A.initialize({onBadTarget:T.BAD_TARGET.emit,onMisnamedClass:T.MISNAMED_CLASS.emit,onUnregistrableClass:T.UNREGISTRABLE_CLASS.emit,onUnregisteredClass:T.UNREGISTERED_CLASS.emit,onAlreadyRegistered:T.ALREADY_REGISTERED.emit,onInvalidClass:T.INVALID_CLASS.emit,onDeferredInstantiation:e.WebHelpers.onDOMContentLoaded}),z.initialize({onAllowHTML:T.ALLOW_HTML.emit,onInvalidKey:T.INVALID_KEY.emit,onInvalidDefinition:T.INVALID_DEFINITION.emit,onLockedDefinition:T.LOCKED_DEFINITION.emit,onInexistentTemplate:T.INEXISTENT_TEMPLATE.emit,onUnespecifiedSlot:T.UNESPECIFIED_SLOT.emit,onUnknownTag:T.UNKNOWN_TAG.emit,onInvalidId:T.INVALID_ID.emit,onTakenId:T.TAKEN_ID.emit,onInvalidState:T.INVALID_STATE.emit,onFetchTemplate:dt.fetch})}static declareUnwritableMembers(e,t){un(e,t.fields),un(e,t.methods)}};var li,wn,fn,oi,ai,qt,ni=s=>s>1e3?(s/1e3).toFixed(2)+"s":s.toFixed(2)+"ms",si=class{constructor(){a(this,"round",0);a(this,"domTime",window.Number.MAX_SAFE_INTEGER);a(this,"renderTime",window.Number.MAX_SAFE_INTEGER)}getDebugInfo(){var e=new window.Object;return e.round=this.round,e.domTime=ni(this.domTime),this.renderTime!==window.Number.MAX_SAFE_INTEGER&&(e.renderTime=ni(this.renderTime)),e}},ri=class{constructor(e){a(this,"name","");a(this,"rounds",0);a(this,"time",0);a(this,"average",0);this.name=e}compute(e){this.rounds++,this.time+=e,this.average=this.time/this.rounds}getDebugInfo(){let e=ni(this.time),t=ni(this.average);return{name:this.name,rounds:this.rounds,spent:e,average:t}}},F=class{static initialize(e){typeof e=="function"&&h(F,qt,e),F.DOMUpdate.overall=new ri("overall-dom-update"),F.BrowserRender.overall=new ri("overall-browser-render")}},at=F;qt=new WeakMap,o(at,qt,()=>{}),a(at,"StopWatch",(fn=class{constructor(){o(this,li);a(this,"_begin",0);a(this,"_end",{dom:0,render:0});a(this,"rounds",0);a(this,"last",new si);a(this,"best",new si);a(this,"averages",{dom:0,render:0})}start(){(F.DOMUpdate.check||F.BrowserRender.check)&&(this.last.round=++this.rounds,this._begin=performance.now())}stop(e){var t;F.DOMUpdate.check&&(this.best.domTime>(this.last.domTime=(this._end.dom=performance.now())-this._begin)&&(this.best.round=this.last.round,this.best.domTime=this.last.domTime),this.averages.dom=(this.averages.dom*(this.rounds-1)+this.last.domTime)/this.rounds,F.DOMUpdate.overall.compute(this.last.domTime)),F.BrowserRender.check?setTimeout(()=>d(this,li,wn).bind(this)(e)):e&&n(t=F,qt).call(t,this,"stop")}getDebugInfo(){return{rounds:this.rounds,last:this.last.getDebugInfo(),best:this.best.getDebugInfo(),averages:this.averages}}},li=new WeakSet,wn=function(e){var t;this.best.renderTime>(this.last.renderTime=(this._end.render=performance.now())-this._begin)&&(this.best.round=this.last.round,this.best.renderTime=this.last.renderTime),this.averages.render=(this.averages.render*(this.rounds-1)+this.last.renderTime)/this.rounds,F.BrowserRender.overall.compute(this.last.renderTime),e&&n(t=F,qt).call(t,this,"finish")},fn)),a(at,"DOMUpdate",(oi=class{},a(oi,"check",!0),a(oi,"overall",null),oi)),a(at,"BrowserRender",(ai=class{},a(ai,"check",!1),a(ai,"overall",null),ai));var lt,Ae,Ii,Se=class{constructor(){o(this,Ae);o(this,lt,new window.Object)}get length(){return d(this,Ae,Ii).call(this).length}key(e){return d(this,Ae,Ii).call(this)[e]||null}getItem(e){return n(this,lt)[e]}setItem(e,t){n(this,lt)[e]=t}removeItem(e){delete n(this,lt)[e]}clear(){h(this,lt,new window.Object)}hasItem(e){return n(this,lt).hasOwnProperty(e)}};lt=new WeakMap,Ae=new WeakSet,Ii=function(){return window.Object.keys(n(this,lt))};var mn="0.6.8";var y,{noop:_e,isOf:Si}=p;window.Wuse=window.Wuse||(y=class{static get VERSION(){return mn}static get elementCount(){return z.instancesCount}},a(y,"DEBUG",!1),a(y,"FATALS",!1),a(y,"MEASURE",!1),a(y,"RENDERING",!0),a(y,"hashRoutine",X.defaultRoutine),a(y,"elementsStorage",new Se),a(y,"tmp",null),a(y,"WebHelpers",null),a(y,"JsHelpers",null),a(y,"PerformanceMeasurement",null),a(y,"NonShadowElement",null),a(y,"OpenShadowElement",null),a(y,"ClosedShadowElement",null),a(y,"debug",_e),a(y,"blockUpdate",_e),a(y,"register",_e),a(y,"instantiate",_e),a(y,"isShadowElement",_e),(()=>{Nt.declareUnwritableMembers(y,{fields:{tmp:new window.Object,WebHelpers:K,JsHelpers:p,PerformanceMeasurement:at,NonShadowElement:k.specializeClass(z,k.REGULAR),OpenShadowElement:k.specializeClass(z,k.OPEN),ClosedShadowElement:k.specializeClass(z,k.CLOSED)},methods:{debug:e=>window.console.log("[WUSE:DEBUG]",e),blockUpdate:(e,t)=>{if(Si(e,Function)){window.Wuse.DEBUG&&window.Wuse.debug("blocking"),window.Wuse.RENDERING=!1;try{e(t)}catch(i){throw i}finally{window.Wuse.RENDERING=!0,window.Wuse.DEBUG&&window.Wuse.debug("unblocking")}}},register:e=>A.registerClasses(Si(e,window.Array)?e:new window.Array(e)),instantiate:(e,t,i)=>A.instantiateClasses(Si(e,window.Array)?e:new window.Array(e),t,i),isShadowElement:e=>{let t=window.Object.getPrototypeOf(e.constructor);return t===window.Wuse.OpenShadowElement||t===window.Wuse.ClosedShadowElement}}}),Nt.detectFeatures(y),Nt.initializeModules(y)})(),y);})();
