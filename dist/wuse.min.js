(()=>{var Ri=Object.defineProperty;var Ui=(r,e,t)=>e in r?Ri(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var a=(r,e,t)=>(Ui(r,typeof e!="symbol"?e+"":e,t),t),Fe=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)};var s=(r,e,t)=>(Fe(r,e,"read from private field"),t?t.call(r):e.get(r)),o=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},c=(r,e,t,i)=>(Fe(r,e,"write to private field"),i?i.call(r,t):e.set(r,t),t);var d=(r,e,t)=>(Fe(r,e,"access private method"),t);var se,Qe=(r,e)=>(typeof e=="function"&&e(r),r),u=class{static get EMPTY_ARRAY(){return s(this,se)}static noop(){}static isNonEmptyString(e){return typeof e=="string"&&!!e.length}static forcedStringSplit(e,t){return typeof e=="string"?e.split(t):new window.Array}static buildArray(e){return Qe(new window.Array,e)}static buildObject(e){return Qe(new window.Object,e)}static ensureFunction(e,t=()=>{}){return typeof e=="function"?e:t}static isOf(e,t){return e!=null&&(e.constructor===t||t!=null&&e.constructor.name===t.name)}static hasObjectKeys(e){return!!(e&&!!window.Object.keys(e).length)}static cloneObject(e){return window.Object.assign(new window.Object,e)}static forEachOwnProperty(e,t){e&&window.Object.getOwnPropertyNames(e).forEach(t)}static isAssignedObject(e){return typeof e=="object"&&e!==null}static isAssignedArray(e){return typeof e=="object"&&e!==null&&e.constructor.name==="Array"}static isNonEmptyArray(e){return typeof e=="object"&&e!==null&&e.constructor.name==="Array"&&!!e.length}};se=new WeakMap,o(u,se,new window.Array);var B=class{static onDOMContentLoaded(e){if(e&&e.constructor===window.Function){let t=()=>{e(),setTimeout(()=>window.removeEventListener("DOMContentLoaded",t),100)};window.addEventListener("DOMContentLoaded",t)}}static getUniqueId(e="WUSE"){let t="_"+(e||"")+"_";for(var i;window.document.getElementById(i=t+(""+window.Math.random()).substring(2))!==null;);return i}static removeChildren(e){if(e)for(;e.firstChild;)e.removeChild(e.firstChild)}static htmlEncode(e=""){return typeof e!="string"?null:e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}static getCSSVendorPrefix(){let e=window.getComputedStyle(window.document.body,""),i=window.Array.prototype.slice.call(e).filter(n=>n.charAt(0)==="-");return i.length?"-"+i[0].split("-")[1]+"-":""}};var ne,b,$e=class{static get UNKNOWN_ERROR(){return s(this,b).call(this,0,e=>"Unknown error.")}static get UNSUPPORTED_FEATURE(){return s(this,b).call(this,1,e=>`Unsupported feature: ${e}.`)}static get UNREGISTERED_CLASS(){return s(this,b).call(this,2,e=>`Unregistered class: ${e}.`)}static get UNREGISTRABLE_CLASS(){return s(this,b).call(this,3,e=>`Unregistrable class: ${e}.`)}static get INVALID_CLASS(){return s(this,b).call(this,4,e=>`Invalid class: ${e}.`)}static get MISNAMED_CLASS(){return s(this,b).call(this,5,e=>`Misnamed class: ${e}.`)}static get INVALID_DEFINITION(){return s(this,b).call(this,10,e=>`Invalid definition: ${e}.`)}static get INVALID_ID(){return s(this,b).call(this,11,e=>`Invalid id: ${e}.`)}static get INVALID_KEY(){return s(this,b).call(this,12,e=>"Call first: this.setElementsStoreKey(<your-valid-key>).")}static get ALLOW_HTML(){return s(this,b).call(this,13,e=>"Call first: this.allowRawContent(true).")}static get INEXISTENT_TEMPLATE(){return s(this,b).call(this,20,e=>`Inexistent template: #${e}.`)}static get EXTINCT_TEMPLATE(){return s(this,b).call(this,21,e=>`Extinct template: #${e}.`)}static get INVALID_TEMPLATE(){return s(this,b).call(this,22,e=>`Invalid template: #${e}.`)}static get UNESPECIFIED_SLOT(){return s(this,b).call(this,30,e=>`Unespecified slot: #${e}.`)}},g=$e;ne=new WeakMap,b=new WeakMap,o(g,ne,"[WUSE:ERROR]"),o(g,b,(e,t)=>({code:e,emit:i=>{let n=`${s($e,ne)} ${e} | ${t(i)}`;if(window.Wuse&&window.Wuse.FATALS||e<10)throw new window.Error(n);return window.console.error(n),null}}));var Et,gt,yt,At,bt,re,ei,oe,ii,ae,si,he,ni,{noop:$t,ensureFunction:ot,isAssignedObject:Ze,isAssignedArray:ws,isNonEmptyArray:ti}=u,Mi=r=>r.toLowerCase().replaceAll("_","-"),T=class{static registerClasses(e){ti(e)&&window.Array.prototype.forEach.call(e,t=>typeof t=="function"?d(this,oe,ii).call(this,t):s(this,yt).call(this,t))}static instantiateClasses(e,t,i){ti(e)&&window.Array.prototype.forEach.call(e,n=>window.customElements.get(n.tag)?d(this,he,ni).call(this,n,t,Ze(i)?i:new window.Object):s(this,bt).call(this,n.name))}static initialize(e){Ze(e)&&(c(this,Et,ot(e.onDeferredInstantiation,s(this,Et))),c(this,yt,ot(e.onInvalidClass,s(this,yt))),c(this,gt,ot(e.onMisnamedClass,s(this,gt))),c(this,At,ot(e.onUnregistrableClass,s(this,At))),c(this,bt,ot(e.onUnregisteredClass,s(this,bt))))}};Et=new WeakMap,gt=new WeakMap,yt=new WeakMap,At=new WeakMap,bt=new WeakMap,re=new WeakSet,ei=function(e){window.HTMLElement.isPrototypeOf(e)?window.customElements.define(e.tag,e):s(this,At).call(this,e.name)},oe=new WeakSet,ii=function(e){e.name.indexOf("_")>0?(e.tag=Mi(e.name),d(this,re,ei).call(this,e)):s(this,gt).call(this,e.name)},ae=new WeakSet,si=function(e,t,i){let n=null;try{n=window.document.querySelector(t)}catch(l){if(ot(i.onBadTarget)(t)===!1)return}finally{n=n||window.document.body}let h=window.document.createElement(e.tag);ot(i.onElementInstantiated)(h,t),n.appendChild(h)},he=new WeakSet,ni=function(e,t,i){let n=()=>d(this,ae,si).call(this,e,t,i);window.document.body?n():s(this,Et).call(this,n)},o(T,re),o(T,oe),o(T,ae),o(T,he),o(T,Et,$t),o(T,gt,$t),o(T,yt,$t),o(T,At,$t),o(T,bt,$t);var z,xt,je,jt=class{constructor(){o(this,xt);o(this,z,new window.Object)}get length(){return d(this,xt,je).call(this).length}key(e){return d(this,xt,je).call(this)[e]||null}getItem(e){return s(this,z)[e]}setItem(e,t){s(this,z)[e]=t}removeItem(e){delete s(this,z)[e]}clear(){c(this,z,new window.Object)}hasItem(e){return s(this,z).hasOwnProperty(e)}};z=new WeakMap,xt=new WeakSet,je=function(){return window.Object.keys(s(this,z))};var Tt,St,{noop:ri,ensureFunction:oi,isAssignedObject:Wi}=u,et=class{static fetch(e){let t=window.document.getElementById(e);return t===null?s(this,Tt).call(this,e):t.tagName!=="TEMPLATE"?s(this,St).call(this,e):t.innerHTML}static initialize(e){Wi(e)&&(c(this,Tt,oi(e.onExtinctTemplate,s(this,Tt))),c(this,St,oi(e.onInvalidTemplate,s(this,St))))}};Tt=new WeakMap,St=new WeakMap,o(et,Tt,ri),o(et,St,ri);var we,hi,ai,ue,fe,It,de=r=>r>1e3?(r/1e3).toFixed(2)+"s":r.toFixed(2)+"ms",le=class{constructor(){a(this,"round",0);a(this,"domTime",window.Number.MAX_SAFE_INTEGER);a(this,"renderTime",window.Number.MAX_SAFE_INTEGER)}getDebugInfo(){var e=new window.Object;return e.round=this.round,e.domTime=de(this.domTime),this.renderTime!==window.Number.MAX_SAFE_INTEGER&&(e.renderTime=de(this.renderTime)),e}},ce=class{constructor(e){a(this,"name","");a(this,"rounds",0);a(this,"time",0);a(this,"average",0);this.name=e}compute(e){this.rounds++,this.time+=e,this.average=this.time/this.rounds}getDebugInfo(){let e=de(this.time),t=de(this.average);return{name:this.name,rounds:this.rounds,spent:e,average:t}}},v=class{static initialize(e){typeof e=="function"&&c(v,It,e),v.DOMUpdate.overall=new ce("overall-dom-update"),v.BrowserRender.overall=new ce("overall-browser-render")}},U=v;It=new WeakMap,o(U,It,()=>{}),a(U,"StopWatch",(ai=class{constructor(){o(this,we);a(this,"_begin",0);a(this,"_end",{dom:0,render:0});a(this,"rounds",0);a(this,"last",new le);a(this,"best",new le);a(this,"averages",{dom:0,render:0})}start(){(v.DOMUpdate.check||v.BrowserRender.check)&&(this.last.round=++this.rounds,this._begin=performance.now())}stop(e){var t;v.DOMUpdate.check&&(this.best.domTime>(this.last.domTime=(this._end.dom=performance.now())-this._begin)&&(this.best.round=this.last.round,this.best.domTime=this.last.domTime),this.averages.dom=(this.averages.dom*(this.rounds-1)+this.last.domTime)/this.rounds,v.DOMUpdate.overall.compute(this.last.domTime)),v.BrowserRender.check?setTimeout(()=>d(this,we,hi).bind(this)(e)):e&&s(t=v,It).call(t,this,"stop")}getDebugInfo(){return{rounds:this.rounds,last:this.last.getDebugInfo(),best:this.best.getDebugInfo(),averages:this.averages}}},we=new WeakSet,hi=function(e){var t;this.best.renderTime>(this.last.renderTime=(this._end.render=performance.now())-this._begin)&&(this.best.round=this.last.round,this.best.renderTime=this.last.renderTime),this.averages.render=(this.averages.render*(this.rounds-1)+this.last.renderTime)/this.rounds,v.BrowserRender.overall.compute(this.last.renderTime),e&&s(t=v,It).call(t,this,"finish")},ai)),a(U,"DOMUpdate",(ue=class{},a(ue,"check",!0),a(ue,"overall",null),ue)),a(U,"BrowserRender",(fe=class{},a(fe,"check",!1),a(fe,"overall",null),fe));var I=class{static get TEMPLATES_KIND(){return"%templates%"}static get SLOTS_KIND(){return"%slots%"}static get TEXTNODE_TAG(){return"^text^"}static get DEFAULT_KIND(){return""}static get DEFAULT_TAG(){return"div"}static get DEFAULT_STYLE_MEDIA(){return"screen"}static get DEFAULT_STYLE_TYPE(){return"text/css"}static get DEFAULT_REPLACEMENT_OPEN(){return"~{"}static get DEFAULT_REPLACEMENT_CLOSE(){return"}~"}};var kt,pe,at,Gt,Kt,{EMPTY_ARRAY:Fi,buildArray:xe,buildObject:$i,isNonEmptyString:ji,isOf:xi}=u,Ct=class{static initialize(e,t){this.begin=e,this.end=t}},H=Ct;a(H,"begin",null),a(H,"end",null),a(H,"enclose",e=>Ct.begin+e+Ct.end),a(H,"makeRegExp",()=>new window.RegExp("(?<="+Ct.begin+").*?(?="+Ct.end+")","gs"));var ki=["contents","classes","styles","attributes"],Ot=class{};a(Ot,"rules",(e,t)=>xe(i=>e.forEach(n=>n.replacements.forEach(h=>h.field===t&&i.push(n))))),a(Ot,"children",(e,t)=>xe(i=>{let n=h=>{let l=f=>f.forEach(R=>R.field===t&&i.push(h));ki.forEach(f=>l(h.replacements[f])),h.rules.forEach(f=>f.replacements.forEach(R=>R.field===t&&i.push(h)))};e.forEach(h=>h.rendering&&n(h))}));var C=class{static initialize(e){c(this,kt,e)}},M=C;kt=new WeakMap,pe=new WeakMap,at=new WeakMap,Gt=new WeakMap,Kt=new WeakMap,o(M,kt,null),o(M,pe,(e,t,i)=>e.push({at:t,field:i.trim(),find:H.enclose(i)})),o(M,at,(e,t,i)=>ji(i)&&(i.match(s(C,kt))||Fi).forEach(n=>{var h;return s(h=C,pe).call(h,e,t,n)})),o(M,Gt,(e,t,i)=>{var n;e[t]=new window.Array,s(n=C,at).call(n,e[t],t,i)}),o(M,Kt,(e,t,i)=>{e[t]=new window.Array,window.Object.keys(i).forEach(n=>{var h,l;s(h=C,at).call(h,e[t],t,n),s(l=C,at).call(l,e[t],t,i[n])})}),a(M,"child",e=>$i(t=>{var i,n,h,l;s(i=C,Gt).call(i,t,"contents",e.content),s(n=C,Gt).call(n,t,"classes",e.classes.join(" ")),s(h=C,Kt).call(h,t,"styles",e.style),s(l=C,Kt).call(l,t,"attributes",e.attributes),e.rules.forEach(f=>f.replacements=C.rule(f))})),a(M,"rule",e=>xe(t=>{var n;if(xi(e.nested,window.Array))return e.nested.map(h=>C.rule(h));var i="";for(let h in e.properties)i+=`${h}:${e.properties[h]};`;s(n=C,at).call(n,t,"rules",i)}));var D=class{static initialize(e,t){H.initialize(e,t),M.initialize(H.makeRegExp())}};a(D,"extractReplacementsFromRule",M.rule),a(D,"extractReplacementsFromChild",M.child),a(D,"scanRulesForReplacements",Ot.rules),a(D,"scanChildrenForReplacements",Ot.children);var Nt,{noop:Gi,isOf:Ki,hasObjectKeys:di,isNonEmptyString:li,isNonEmptyArray:Bi,isAssignedObject:zi,ensureFunction:Hi}=u,{htmlEncode:ci}=B,{TEMPLATES_KIND:Pi,TEXTNODE_TAG:Vi}=I,me=class{static initialize(e){zi(e)&&c(this,Nt,Hi(e.onFetchTemplate,s(this,Nt)))}},E=me;Nt=new WeakMap,o(E,Nt,Gi),a(E,"cacheInvalidator",e=>e.cache=null),a(E,"renderingIncluder",e=>e.rendering=!0),a(E,"renderingExcluder",e=>e.rendering=!1),a(E,"renderRule",(e,t)=>{if(Ki(t.nested,window.Array))return`${t.selector}{${t.nested.map(n=>me.renderRule(e,n)).join(`
`)}}`;if(li(t.selector)&&!t.nested){var i="";for(let n in t.properties)i+=`${n}:${t.properties[n]};`;return Bi(t.replacements)&&t.replacements.forEach(n=>i=e(i,n)),`${t.selector}{${i}}`}return null}),a(E,"renderChild",(e,t)=>{var h;if(t.kind===Pi)return s(h=me,Nt).call(h,t.id);if(t.tag===Vi){var i=t.content;return t.replacements.contents.forEach(l=>i=e(i,l)),t.encode?ci(i):i}var n=li(t.id)?`<${t.tag} id='${t.id}'`:`<${t.tag}`;if(t.classes.length){var i=t.classes.join(" ");t.replacements.classes.forEach(f=>i=e(i,f)),n+=` class='${i}'`}if(di(t.style)){var i=" style='";for(let f in t.style)i+=f+": "+t.style[f]+"; ";i+="'",t.replacements.styles.forEach(f=>i=e(i,f)),n+=i}if(di(t.attributes)){var i="";for(let f in t.attributes)i+=` ${f}=${t.attributes[f]}`;t.replacements.attributes.forEach(f=>i=e(i,f)),n+=i}if(typeof t.content=="string"){var i=t.content;t.replacements.contents.forEach(f=>i=e(i,f)),n+=`>${t.encode?ci(i):i}</${t.tag}>`}else n+="/>";return n});var Bt,zt,Ht,Pt,vt=class{constructor(e){a(this,"rounds",0);o(this,Bt,0);o(this,zt,null);o(this,Ht,!1);o(this,Pt,null);c(this,Pt,typeof e=="function"?e:()=>{})}compute(e){return this.rounds+=+c(this,Ht,s(this,Bt)==c(this,zt,s(this,Pt).call(this,e))),c(this,Bt,s(this,zt)),s(this,Ht)}};Bt=new WeakMap,zt=new WeakMap,Ht=new WeakMap,Pt=new WeakMap;var ht,k,it,Ee,ui,Dt=class{constructor(e,t){o(this,Ee);o(this,ht,null);o(this,k,null);o(this,it,null);if(e instanceof Node&&t instanceof Node)c(this,ht,e),c(this,k,t),c(this,it,t.cloneNode(!1));else throw new Error("[WUSE:ERROR] Wrong arguments supplied.")}get element(){return s(this,k)}affiliate(){s(this,ht).appendChild(s(this,k))}disaffiliate(){s(this,ht).removeChild(s(this,k))}promote(e){s(this,it).innerHTML=e,s(this,ht).replaceChild(s(this,it),s(this,k)),d(this,Ee,ui).call(this)}};ht=new WeakMap,k=new WeakMap,it=new WeakMap,Ee=new WeakSet,ui=function(){let e=s(this,it);c(this,it,s(this,k).cloneNode(!1)),c(this,k,e)};var dt,lt,ct=class{constructor(e){a(this,"owner",null);o(this,dt,!1);o(this,lt,"");this.owner=e}get invalidated(){return s(this,dt)}reset(e){c(this,dt,!1),c(this,lt,e)}append(e){c(this,lt,s(this,lt)+e)}verify(e){c(this,dt,e(s(this,lt)))}process(){s(this,dt)&&this.on_content_invalidation(s(this,lt))}on_content_invalidation(e){}};dt=new WeakMap,lt=new WeakMap;var Lt,ge,{isOf:ke,cloneObject:fi,forEachOwnProperty:wi,buildArray:Ji}=u,ut=class extends window.Array{constructor(t){super();o(this,Lt);a(this,"owner",null);a(this,"last",null);a(this,"version",0);this.owner=t}append(t){ke(t,window.Object)&&(this.push(t),d(this,Lt,ge).call(this,t))}prepend(t){ke(t,window.Object)&&(this.unshift(t),d(this,Lt,ge).call(this,t))}replace(t,i){t>-1&&ke(i,window.Object)&&d(this,Lt,ge).call(this,this[t]=i)}on_version_change(){}persist(){return Ji(t=>wi(this,i=>{switch(i){case"owner":case"last":case"length":break;case"version":t[i]=this[i];break;default:if(window.Number.isInteger(window.Number(i))){let n=fi(this[i]);n.cache&&(n.cache=null),t.push(n)}break}}))}restore(t){wi(t,i=>{switch(i){case"length":break;case"version":this[i]=t[i];break;default:if(window.Number.isInteger(window.Number(i))){let n=fi(t[i]);n.cache&&(n.cache=null),this.push(n)}break}})}};Lt=new WeakSet,ge=function(t){this.last=t,this.version++,this.on_version_change()};var Ae,gi,be,yi,Te,Ai,Se,bi,Ie,Ti,_t,ye,Oe,Si,{EMPTY_ARRAY:Yi,buildArray:Fs,buildObject:Xi,isOf:P,hasObjectKeys:pi,isNonEmptyString:ft,forcedStringSplit:qi}=u,{DEFAULT_TAG:Qi,DEFAULT_KIND:Zi,TEMPLATES_KIND:Ge,SLOTS_KIND:Ke}=I,V=class{static parse(e){if(ft(e)){let t=e.trimLeft(),i=mi();return t.charAt(0)==="%"?t.startsWith(Ge)?d(this,_t,ye).call(this,i,t.replace(i.kind=Ge,"")):t.startsWith(Ke)?d(this,_t,ye).call(this,i,t.replace(i.kind=Ke,"")):null:d(this,_t,ye).call(this,i,t)}return null}};Ae=new WeakSet,gi=function(e,t){let i=t.indexOf("["),n=t.indexOf("]");if(i>-1&&n>-1&&n>i){let h=t.substr(i,n-i+1),l=h.substr(1,h.length-2).split("|");for(let f in l){let R=l[f].split("=");R[0]==="style"?R[1].split(";").forEach(F=>{let $=F.split(":"),qe=$[0].trim();qe.length&&(e.style[qe]=$[1].trim())}):e.attributes[R[0]]=R[1]}return t.replace(h,"")}return t},be=new WeakSet,yi=function(e,t){let i=t.indexOf("=");return i>-1?(e.content=t.slice(i+1),!!e.content.length&&e.content.charAt(0)==="&"&&(e.content=e.content.slice(1),e.encode=!!e.content.length&&e.content.charAt(0)!=="&"),t.slice(0,i)):t},Te=new WeakSet,Ai=function(e,t){let i=t.replaceAll("!"," ").split(" ");return i.slice(1).map(n=>{let[h,...l]=n.toLowerCase().split("+"),f=(l||Yi).indexOf("capture")>-1;e.events.push(Ei(h,f))}),i[0]},Se=new WeakSet,bi=function(e,t){let i=t.replaceAll("."," ").split(" ");return e.classes=i.slice(1),i[0]},Ie=new WeakSet,Ti=function(e,t){if(t!==""){let i=t.indexOf("#");i===-1?e.tag=t:(i>0&&(e.tag=t.substr(0,i)),e.id=t.substr(i+1))}return e},_t=new WeakSet,ye=function(e,t){return d(this,Ie,Ti).call(this,e,d(this,Se,bi).call(this,e,d(this,Te,Ai).call(this,e,d(this,be,yi).call(this,e,d(this,Ae,gi).call(this,e,t)))))},o(V,Ae),o(V,be),o(V,Te),o(V,Se),o(V,Ie),o(V,_t);var Vt=class{static parse(e){return Xi(t=>(P(e,window.Array)?e:qi(e,`
`).map(i=>i.trim()).join("").split(";")).forEach(i=>ft(i)&&d(this,Oe,Si).call(this,t,i.trim())))}};Oe=new WeakSet,Si=function(e,t){if(!!t.length&&t.indexOf(":")>-1){let[i,...n]=t.split(":"),h=i.trim();if(h.length){let l=n.join(":").trim();e[h]=l.endsWith(";")?l.slice(0,-1):l}}},o(Vt,Oe);var mi=()=>({kind:Zi,tag:Qi,id:"",classes:new window.Array,attributes:new window.Object,style:new window.Object,events:new window.Array,content:"",encode:!1}),Ei=(r,e)=>typeof r=="string"&&typeof e=="boolean"?{kind:r,capture:e}:null,ts=(r,e)=>{let t=V.parse(r);return t?(t.rules=P(e,window.Array)?e:new window.Array,t.rendering=!0,t.cache=null,t):g.INVALID_DEFINITION.emit(r)},es=r=>{if(r.kind===Ge){if(!window.document.getElementById(r.id))return g.INEXISTENT_TEMPLATE.emit(r.id)}else if(r.kind===Ke){if(new window.String(r.attributes.slot).replaceAll('"',"").replaceAll("'","").length===0)return g.UNESPECIFIED_SLOT.emit(r.id)}else if(typeof r.id!="string"||r.id!==""&&window.document.getElementById(r.id)!==null)return g.INVALID_ID.emit(r.id);return r},is=r=>{if(!P(r,window.Object))return null;let e=window.document.createElement(r.tag);if(r.id.length&&e.setAttribute("id",r.id),r.classes.length&&e.setAttribute("class",r.classes.join(" ")),pi(r.style)){var t="";for(let i in r.style)t+=i+": "+r.style[i]+"; ";if(t.length){let i=t.trim();e.setAttribute("style",i.endsWith(";")?i.slice(0,-1):i)}}if(pi(r.attributes))for(let i in r.attributes)e.setAttribute(i,r.attributes[i]);return e},ss=(r,e)=>{let t=window.document.createElement("style");return ft(r)&&t.setAttribute("media",r),ft(e)&&t.setAttribute("type",e),t.appendChild(window.document.createTextNode("")),t},ns=(r,e)=>{let t=P(r,window.Array)?r.join(","):ft(r)?r:"";return t.length?{selector:t,properties:P(e,window.Object)?e:Vt.parse(e),cache:null}:null},rs=(r,e,t)=>{let i=P(r,window.Array)?r.join(","):ft(r)?r:"",n=P(e,window.Array)?e.join(","):ft(e)?e:"";return!i.length||!n.length?null:{selector:i,nested:[{selector:n,properties:P(t,window.Object)?t:Vt.parse(t)}],cache:null}},os=(r,e)=>{if(r.selector===e.selector){for(let t in e.properties)r.properties[t]=e.properties[t];return r.cache=null,!0}return!1},as=(r,e)=>P(r.nested,window.Array)&&r.selector===e.selector?(e.nested.forEach(t=>{var i=!1;for(let n in r.nested)if(i=r.nested[n].selector===t.selector){for(let h in t.properties)r.nested[n].properties[h]=t.properties[h];break}i||r.nested.push(t)}),r.cache=null,!0):!1,w=class{};a(w,"makeStyleNode",ss),a(w,"newRule",ns),a(w,"newNestedRule",rs),a(w,"tryToJoinRules",os),a(w,"tryToJoinNestedRules",as),a(w,"performValidations",es),a(w,"makeMainNode",is),a(w,"newChild",ts),a(w,"newDefinition",mi),a(w,"newEvent",Ei);var j,A,y,G,m,Ut,J,Y,st,K,X,Jt,pt,q,nt,L,Q,Z,p,Mt,Yt,mt,x,tt,wt,Ne,Ii,ve,Oi,De,Ci,Le,Ni,rt,Rt,Xt,ze,qt,He,Qt,Pe,_e,vi,Zt,Ve,Re,Di,te,Je,Ue,Li,N,W,ee,Ye,Wt,Me,_i,Ft,Ce,ie,Xe,hs=["on_create","on_construct","on_reconstruct","on_connect","on_inject","on_load","on_prerender","on_update","on_postrender","on_refresh","on_unload","on_reload","on_repaint","on_disconnect"],Be=class{static get REGULAR(){return"regular"}static get OPEN(){return"open"}static get CLOSED(){return"closed"}},We=class extends window.HTMLElement{constructor(t){super();o(this,tt);o(this,Ne);o(this,ve);o(this,De);o(this,Le);o(this,rt);o(this,Xt);o(this,qt);o(this,Qt);o(this,_e);o(this,Zt);o(this,Re);o(this,te);o(this,Ue);o(this,N);o(this,ee);o(this,Me);o(this,Ft);o(this,ie);o(this,j,"");o(this,A,new class extends ut{on_version_change(){var t;this.last.version=this.version,this.last.replacements=D.extractReplacementsFromRule(this.last),window.Wuse.DEBUG&&d(t=this.owner,tt,wt).call(t,`rules list version change: ${this.version}`)}}(this));o(this,y,new class extends ut{on_version_change(){var t,i;this.last.version=this.version,this.last.replacements=D.extractReplacementsFromChild(this.last),c(t=this.owner,Y,s(t,Y)|this.last.kind===I.SLOTS_KIND),window.Wuse.DEBUG&&d(i=this.owner,tt,wt).call(i,`children list version change: ${this.version}`)}}(this));o(this,G,new class extends ut{on_version_change(){var t;window.Wuse.DEBUG&&d(t=this.owner,tt,wt).call(t,`fields list version change: ${this.version}`)}snapshot(){this.forEach(t=>t.value=this.owner[t.name])}recall(){this.forEach(t=>this.owner[t.name]=t.value)}}(this));o(this,m,{mainDefinition:w.newDefinition(),styleMedia:I.DEFAULT_STYLE_MEDIA,styleType:I.DEFAULT_STYLE_TYPE,rawContent:!1,attributeKeys:!1,elementKeys:!0});o(this,Ut,new window.Object);o(this,J,!1);o(this,Y,!1);o(this,st,void 0);o(this,K,void 0);o(this,X,null);o(this,Jt,window.Wuse.isShadowElement(this));o(this,pt,!1);o(this,q,!1);o(this,nt,window.Wuse.elementsStorage);o(this,L,null);o(this,Q,"");o(this,Z,!1);o(this,p,{root:new class extends ct{on_content_invalidation(t){this.owner.innerHTML=t}}(this),style:new class extends ct{on_content_invalidation(t){s(this.owner,K).promote(t)}}(this),main:new class extends ct{on_content_invalidation(t){s(this.owner,st).promote(t)}}(this),renderizers:{rule:t=>s(this,p).style.append(t.cache?t.cache:t.cache=E.renderRule(s(this,Mt),t)),children:{mixed:t=>s(this,Jt)&&t.kind===I.SLOTS_KIND?s(this,p).renderizers.children.slot(t):s(this,p).renderizers.children.normal(t),slot:t=>{t.cache||(s(this,p).root.verify(i=>!0),s(this,p).root.append(t.cache=E.renderChild(s(this,Mt),t)))},normal:t=>{s(this,p).main.append(t.cache?t.cache:t.cache=E.renderChild(s(this,Mt),t)),t.rules.forEach(s(this,p).renderizers.rule)}}},gotModified:()=>s(this,p).root.invalidated||s(this,p).main.invalidated||s(this,p).style.invalidated,getDebugInfo:()=>`updated (root: ${s(this,p).root.invalidated}, main: ${s(this,p).main.invalidated}, style: ${s(this,p).style.invalidated})`});o(this,Mt,(t,i)=>t.replace(i.find,this[i.field]!==void 0?this[i.field]:""));o(this,Yt,{bind:{key:()=>{let t=i=>{u.isNonEmptyString(i)&&(this[i]=d(this,Xt,ze).call(this,i))};return s(this,J)&&t(s(this,m).mainDefinition.id),i=>t(i.id)},event:"addEventListener"},unbind:{key:()=>{let t=i=>delete this[i];return s(this,J)&&t(s(this,m).mainDefinition.id),i=>t(i.id)},event:"removeEventListener"}});o(this,mt,{main:new vt(window.Wuse.hashRoutine),style:new vt(window.Wuse.hashRoutine)});o(this,x,{attachment:new window.Wuse.PerformanceMeasurement.StopWatch,partial:new window.Wuse.PerformanceMeasurement.StopWatch,full:new window.Wuse.PerformanceMeasurement.StopWatch,dettachment:new window.Wuse.PerformanceMeasurement.StopWatch});o(this,Wt,()=>hs.forEach(t=>s(this,Ut)[t]=typeof this[t]=="function"));a(this,"info",{instanceNumber:++this.instancesCount,unmodifiedRounds:0,updatedRounds:0});c(this,X,t!==We.RootMode.REGULAR?this.attachShadow({mode:t}):this),s(this,Wt).call(this),d(this,N,W).call(this,"on_create"),s(this,m).attributeKeys&&this.getAttributeNames().forEach(i=>this[i]=this.getAttribute(i)),d(this,Me,_i).call(this)&&s(this,L).generation>1?d(this,N,W).call(this,"on_reconstruct",s(this,L)):d(this,N,W).call(this,"on_construct")}get render(){return s(this,q)?d(this,_e,vi):u.noop}get redraw(){return s(this,q)?d(this,Re,Di):u.noop}connectedCallback(){window.Wuse.MEASURE&&s(this,x).attachment.start(),s(this,Wt).call(this),d(this,N,W).call(this,"on_connect"),d(this,Zt,Ve).call(this,"on_load"),s(this,Z)&&this.persistToElementsStore(),window.Wuse.MEASURE&&s(this,x).attachment.stop(window.Wuse.DEBUG)}disconnectedCallback(){window.Wuse.MEASURE&&s(this,x).dettachment.start(),d(this,rt,Rt).call(this,!1),d(this,N,W).call(this,"on_disconnect"),window.Wuse.MEASURE&&s(this,x).dettachment.stop(window.Wuse.DEBUG)}getElementsStore(){return s(this,nt)}setElementsStore(t){c(this,nt,t)}hasElementsStoreKey(t){return s(this,Z)}getElementsStoreKey(t){return s(this,Q)}setElementsStoreKey(t){return c(this,Z,u.isNonEmptyString(c(this,Q,t))),this}persistToElementsStore(){if(d(this,ie,Xe).call(this)){let t=s(this,L);if(t)return s(this,G).snapshot(),t.data=new window.Object({options:s(this,m),html:s(this,j),children:s(this,y).persist(),rules:s(this,A).persist(),fields:s(this,G).persist(),slotted:s(this,Y),identified:s(this,J)}),d(this,Ft,Ce).call(this),!0}return!1}restoreFromElementsStore(t){if(d(this,ie,Xe).call(this)){let i=s(this,L);if(i&&i.persisted&&i.data)return c(this,m,i.data.options),c(this,Y,i.data.slotted),c(this,J,i.data.identified),c(this,j,i.data.html),s(this,y).restore(i.data.children),s(this,y).owner=this,s(this,A).restore(i.data.rules),s(this,A).owner=this,s(this,G).restore(i.data.fields),s(this,G).owner=this,s(this,G).recall(),t||(delete i.data,d(this,Ft,Ce).call(this)),!0}return!1}selectChildElement(t){return s(this,X).querySelector(t)}setMainAttribute(t,i){s(this,pt)&&s(this,st).element.setAttribute(t,i)}setMainElement(t){let i=w.newChild(t);if(w.performValidations(i)){if(i.content!==""||!!i.events.length)return WuseRuntimeErrors.INVALID_DEFINITION.emit(t);c(this,J,!!i.id.length)&&(s(this,m).mainDefinition.id=i.id),i.tag.length&&(s(this,m).mainDefinition.tag=i.tag),i.classes.length&&(s(this,m).mainDefinition.classes=i.classes),i.style&&(s(this,m).mainDefinition.style=i.style),i.attributes&&(s(this,m).mainDefinition.attributes=i.attributes)}return this}setStyleOptions(t,i){return s(this,m).styleMedia=t||"",s(this,m).styleType=i||"",this}setElementsAsKeys(t){return s(this,m).elementKeys=!!t,this}setAttributesAsKeys(t){return s(this,m).attributeKeys=!!t,this}allowRawContent(t){return s(this,m).rawContent=!!t,this}setRawContent(t){return s(this,m).rawContent?c(this,j,t):WuseRuntimeErrors.ALLOW_HTML.emit(),this}appendRawContent(t){return s(this,m).rawContent?c(this,j,s(this,j)+t):WuseRuntimeErrors.ALLOW_HTML.emit(),this}prependRawContent(t){return s(this,m).rawContent?c(this,j,t+s(this,j)):WuseRuntimeErrors.ALLOW_HTML.emit(),this}appendCSSRule(t,i,n){if(n)return this.appendCSSNestedRule(t,i,n);let h=s(this,A).slice(-1),l=w.newRule(t,i);return(!h.length||!w.tryToJoinRules(h[0],l))&&s(this,A).append(l),this}prependCSSRule(t,i,n){if(n)return this.prependCSSNestedRule(t,i,n);let h=s(this,A).slice(0,1),l=w.newRule(t,i);return(!h.length||!w.tryToJoinRules(h[0],l))&&s(this,A).prepend(l),this}appendCSSNestedRule(t,i,n){let h=s(this,A).slice(-1),l=w.newNestedRule(t,i,n);return(!h.length||!w.tryToJoinNestedRules(h[0],l))&&s(this,A).append(l),this}prependCSSNestedRule(t,i,n){let h=s(this,A).slice(0,1),l=w.newNestedRule(t,i,n);return(!h.length||!w.tryToJoinNestedRules(h[0],l))&&s(this,A).prepend(l),this}appendChildElement(t,i){return s(this,y).append(w.performValidations(w.newChild(t,i))),this}prependChildElement(t,i){return s(this,y).prepend(w.performValidations(w.newChild(t,i))),this}replaceChildElement(t,i){return s(this,y).replace(s(this,y).findIndex(n=>n.id===t),w.newChild(i)),this}appendChildElements(t){return(u.isOf(t,window.Array)?t:u.forcedStringSplit(t,`
`)).forEach(i=>typeof i=="string"&&!!i.trim().length&&this.appendChildElement(i)),this}prependChildElements(t){return(u.isOf(t,window.Array)?t:u.forcedStringSplit(t,`
`)).forEach(i=>typeof i=="string"&&!!i.trim().length&&this.prependChildElement(i)),this}checkChildElementIsIncludedById(t,i,n){let h=l=>u.isOf(l,window.Function)?l():void 0;return s(this,y).some(l=>l.id===t&&l.rendering)?h(i):h(n),this}includeChildElementById(t){return s(this,y).forEach(i=>i.id===t&&E.renderingIncluder(i)),this}excludeChildElementById(t){return s(this,y).forEach(i=>i.id===t&&E.renderingExcluder(i)),this}invalidateChildElementsById(t){return s(this,y).forEach(i=>t.indexOf(i.id)>-1&&E.cacheInvalidator(i)),this}invalidateChildElements(t){return u.isOf(t,window.Array)&&t.forEach(E.cacheInvalidator),this}makeField(t,i){return this[t]=i,s(this,G).append({name:t,value:i}),this}makeReactiveField(t,i,n,h=!0){return d(this,Ue,Li).call(this,t,i,n,h)}makeExternalReactiveField(t,i,n,h,l=!0){return this.makeReactiveField(i,t[i]||n,f=>{t[i]=this[i],h(f)},l)}static initialize(t){D.initialize(I.DEFAULT_REPLACEMENT_OPEN,I.DEFAULT_REPLACEMENT_CLOSE),u.isOf(t,window.Object)&&u.isOf(t.onFetchTemplate,window.Function)&&E.initialize({onFetchTemplate:t.onFetchTemplate})}},O=We;j=new WeakMap,A=new WeakMap,y=new WeakMap,G=new WeakMap,m=new WeakMap,Ut=new WeakMap,J=new WeakMap,Y=new WeakMap,st=new WeakMap,K=new WeakMap,X=new WeakMap,Jt=new WeakMap,pt=new WeakMap,q=new WeakMap,nt=new WeakMap,L=new WeakMap,Q=new WeakMap,Z=new WeakMap,p=new WeakMap,Mt=new WeakMap,Yt=new WeakMap,mt=new WeakMap,x=new WeakMap,tt=new WeakSet,wt=function(t){s(this,J)&&window.Wuse.debug(`#${s(this,m).mainDefinition.id} (${this.info.instanceNumber}) | ${typeof t=="string"?t:JSON.stringify(t)}`)},Ne=new WeakSet,Ii=function(){s(this,K)&&s(this,K).affiliate(),s(this,st).affiliate(),c(this,pt,!0)},ve=new WeakSet,Oi=function(){c(this,K,s(this,A).length?new Dt(s(this,X),w.makeStyleNode(s(this,m).styleMedia,s(this,m).styleType)):null),c(this,st,new Dt(s(this,X),w.makeMainNode(s(this,m).mainDefinition))),s(this,y).forEach(E.cacheInvalidator),s(this,A).forEach(E.cacheInvalidator)},De=new WeakSet,Ci=function(){s(this,pt)&&(s(this,st).disaffiliate(),s(this,K)&&s(this,K).disaffiliate(),s(this,Y)&&s(this,Jt)&&window.Wuse.WebHelpers.removeChildren(this)),c(this,pt,!1)},Le=new WeakSet,Ni=function(t){return{key:s(this,m).elementKeys&&t.key(),event:(i,n,h)=>{let l=this[`on_${i}_${n}`];if(l){let f=d(this,Xt,ze).call(this,i);f&&f[t.event](n,l,h)}},slots:()=>this.on_slot_change&&s(this,X).querySelectorAll("slot").forEach(i=>i[t.event]("slotchange",this.on_slot_change))}},rt=new WeakSet,Rt=function(t){if(s(this,q)&&!t||!s(this,q)&&t){let i=d(this,Le,Ni).call(this,t?s(this,Yt).bind:s(this,Yt).unbind);s(this,y).forEach(n=>{!n.rendering&&t||(i.key&&i.key(n),n.events.forEach(h=>h&&i.event(n.id,h.kind,h.capture)))}),s(this,Y)&&i.slots(),c(this,q,t)}},Xt=new WeakSet,ze=function(t){return u.isNonEmptyString(t)?s(this,X).querySelector(`#${t}`):void 0},qt=new WeakSet,He=function(){s(this,p).root.reset(""),s(this,p).style.reset(""),s(this,p).main.reset(s(this,j));let t=s(this,Y)?s(this,p).renderizers.children.mixed:s(this,p).renderizers.children.normal;s(this,y).forEach(i=>i.rendering&&t(i)),s(this,A).forEach(s(this,p).renderizers.rule),s(this,p).main.verify(i=>!s(this,mt).main.compute(i)),s(this,p).style.verify(i=>!s(this,mt).style.compute(i))},Qt=new WeakSet,Pe=function(){s(this,p).root.process(),s(this,p).style.process(),s(this,p).main.process(),window.Wuse.DEBUG&&d(this,tt,wt).call(this,s(this,p).getDebugInfo())},_e=new WeakSet,vi=function(){!window.Wuse.RENDERING||(window.Wuse.MEASURE&&s(this,x).partial.start(),d(this,N,W).call(this,"on_prerender"),d(this,qt,He).call(this),s(this,p).gotModified()?(d(this,rt,Rt).call(this,!1),d(this,Qt,Pe).call(this),d(this,rt,Rt).call(this,!0),this.info.updatedRounds++,d(this,N,W).call(this,"on_update"),d(this,ee,Ye).call(this,"on_refresh")):this.info.unmodifiedRounds++,window.Wuse.DEBUG&&d(this,tt,wt).call(this,`unmodified: ${this.info.unmodifiedRounds} (main: ${s(this,mt).main.rounds}, style: ${s(this,mt).style.rounds}) | updated: ${this.info.updatedRounds}`),d(this,N,W).call(this,"on_postrender"),window.Wuse.MEASURE&&s(this,x).partial.stop(window.Wuse.DEBUG))},Zt=new WeakSet,Ve=function(t){d(this,ve,Oi).call(this),d(this,Ne,Ii).call(this),d(this,N,W).call(this,"on_inject"),d(this,qt,He).call(this),s(this,p).style.verify(i=>!!s(this,K)),d(this,Qt,Pe).call(this),d(this,rt,Rt).call(this,!0),d(this,N,W).call(this,t)},Re=new WeakSet,Di=function(){window.Wuse.MEASURE&&s(this,x).full.start(),d(this,rt,Rt).call(this,!1),d(this,De,Ci).call(this),d(this,N,W).call(this,"on_unload"),s(this,Wt).call(this),d(this,Zt,Ve).call(this,"on_reload"),d(this,ee,Ye).call(this,"on_repaint"),window.Wuse.MEASURE&&s(this,x).full.stop(window.Wuse.DEBUG)},te=new WeakSet,Je=function(t,i="$none"){if(s(this,q)){let n=D.scanRulesForReplacements(s(this,A),t);n.forEach(E.cacheInvalidator);let h=D.scanChildrenForReplacements(s(this,y),t);h.forEach(E.cacheInvalidator),window.Wuse.DEBUG&&d(this,tt,wt).call(this,`reactive render (label: ${i}, field: ${t}, children: ${h.length}, rules: ${n.length})`),(!!n.length||!!h.length)&&(h.some(l=>!!l.kind.length)&&s(this,y).forEach(l=>l.kind===I.SLOTS_KIND?E.cacheInvalidator(l):void 0),this.render())}},Ue=new WeakSet,Li=function(t,i,n,h=!0){return window.Wuse.makeReactiveField(this,t,i,n,(l,f)=>d(this,te,Je).call(this,l,f||"$auto")),s(this,G).append({name:t,value:i}),h&&d(this,te,Je).call(this,t,"$init"),this},N=new WeakSet,W=function(t,i){s(this,Ut)[t]&&this[t].call(this,i)},ee=new WeakSet,Ye=function(t,i){s(this,Z)&&this.persistToElementsStore(),s(this,Ut)[t]&&window.requestAnimationFrame(()=>this[t].call(this,i))},Wt=new WeakMap,Me=new WeakSet,_i=function(){return s(this,Z)?(c(this,L,s(this,nt).hasItem(s(this,Q))?s(this,nt).getItem(s(this,Q)):{generation:0,persisted:!1}),s(this,L).generation++,d(this,Ft,Ce).call(this),!0):!1},Ft=new WeakSet,Ce=function(){window.Wuse.DEBUG&&(s(this,L).key=s(this,Q)),s(this,L).persisted=!!s(this,L).data,s(this,nt).setItem(s(this,Q),s(this,L))},ie=new WeakSet,Xe=function(){return s(this,Z)?!0:(WuseRuntimeErrors.INVALID_KEY.emit(),!1)},a(O,"RootMode",Be),a(O,"specializeClass",t=>class extends We{constructor(){super(t)}}),a(O,"instancesCount",0);var _=class{static get VERSION(){return"0.4.3"}static blockUpdate(e,t){if(u.isOf(e,Function)){_.DEBUG&&_.debug("blocking"),_.RENDERING=!1;try{e(t)}catch(i){throw i}finally{_.RENDERING=!0,_.DEBUG&&_.debug("unblocking")}}}static debug(e){window.console.log("[WUSE:DEBUG]",e)}static register(e){return T.registerClasses(u.isOf(e,window.Array)?e:new window.Array(e))}static instantiate(e,t,i){return T.instantiateClasses(u.isOf(e,window.Array)?e:new window.Array(e),t,i)}static isShadowElement(e){let t=window.Object.getPrototypeOf(e.constructor);return t===_.OpenShadowElement||t===_.ClosedShadowElement}static get elementCount(){return O.instancesCount}static makeReactiveField(e,t,i,n,h){let l=(F,$)=>window.Object.defineProperty(e,t,{get:F,set:$,enumerable:!0,configurable:!0}),f=()=>delete e[t],R=(F,$)=>_.makeReactiveField(e,t,F,$,h);l(()=>i,F=>{R(F,n),u.isOf(n,window.Function)?n({renderize:$=>h(t,$),automate:()=>R(F,null),freeze:()=>l(()=>F,$=>{}),defreeze:()=>R(F,n),dereact:()=>l(()=>F,$=>{f(),e[t]=$}),remove:()=>f()}):h(t)})}},S=_;a(S,"WebHelpers",B),a(S,"JsHelpers",u),a(S,"PerformanceMeasurement",U),a(S,"tmp",new window.Object),a(S,"DEBUG",!1),a(S,"FATALS",!1),a(S,"MEASURE",!1),a(S,"RENDERING",!0),a(S,"NonShadowElement",O.specializeClass(O.RootMode.REGULAR)),a(S,"OpenShadowElement",O.specializeClass(O.RootMode.OPEN)),a(S,"ClosedShadowElement",O.specializeClass(O.RootMode.CLOSED)),a(S,"elementsStorage",new jt),a(S,"hashRoutine",e=>{var t=0;for(let i=0;i<e.length;i++)t=(t=(t<<5)-t+e.charCodeAt(i))&t;return t}),(()=>{let e=(t,i)=>!t&&g.UNSUPPORTED_FEATURE.emit(i);try{e(u.isOf(window.document,window.HTMLDocument),"HTML Document"),e(u.isOf(window.customElements,window.CustomElementRegistry),"Custom Elements"),B.onDOMContentLoaded(()=>e(u.isOf(window.document.body.attachShadow,window.Function),"Shadow DOM"))}catch(t){g.UNKNOWN_ERROR.emit()}U.initialize((t,i)=>_.debug(JSON.stringify(u.buildArray(n=>{switch(n.push({instances:_.elementCount}),n.push(t.getDebugInfo()),i){case"stop":n.push(U.DOMUpdate.overall.getDebugInfo());break;case"finish":n.push(U.BrowserRender.overall.getDebugInfo());break}})))),T.initialize({onMisnamedClass:g.MISNAMED_CLASS.emit,onUnregistrableClass:g.UNREGISTRABLE_CLASS.emit,onUnregisteredClass:g.UNREGISTERED_CLASS.emit,onInvalidClass:g.INVALID_CLASS.emit,onDeferredInstantiation:B.onDOMContentLoaded}),et.initialize({onExtinctTemplate:g.EXTINCT_TEMPLATE.emit,onInvalidTemplate:g.INVALID_TEMPLATE.emit}),O.initialize({onFetchTemplate:et.fetch})})(),window.Wuse=S;})();
