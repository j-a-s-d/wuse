(()=>{var gi=Object.defineProperty;var yi=(p,e,s)=>e in p?gi(p,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):p[e]=s;var d=(p,e,s)=>(yi(p,typeof e!="symbol"?e+"":e,s),s),Pe=(p,e,s)=>{if(!e.has(p))throw TypeError("Cannot "+s)};var i=(p,e,s)=>(Pe(p,e,"read from private field"),s?s.call(p):e.get(p)),r=(p,e,s)=>{if(e.has(p))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(p):e.set(p,s)},f=(p,e,s,t)=>(Pe(p,e,"write to private field"),t?t.call(p,s):e.set(p,s),s);var o=(p,e,s)=>(Pe(p,e,"access private method"),s);var S=class{static get TEMPLATES_KIND(){return"%templates%"}static get SLOTS_KIND(){return"%slots%"}static get TEXTNODE_TAG(){return"^text^"}static get DEFAULT_KIND(){return""}static get DEFAULT_TAG(){return"div"}static get DEFAULT_STYLE_MEDIA(){return"screen"}static get DEFAULT_STYLE_TYPE(){return"text/css"}static get DEFAULT_REPLACEMENT_OPEN(){return"~{"}static get DEFAULT_REPLACEMENT_CLOSE(){return"}~"}};var _=class{static onDOMContentLoaded(e){if(e&&e.constructor===window.Function){let s=()=>{e(),setTimeout(()=>window.removeEventListener("DOMContentLoaded",s),100)};window.addEventListener("DOMContentLoaded",s)}}static getUniqueId(e="WUSE"){let s="_"+(e||"")+"_";for(var t;window.document.getElementById(t=s+(""+window.Math.random()).substring(2))!==null;);return t}static removeChildren(e){if(e)for(;e.firstChild;)e.removeChild(e.firstChild)}static htmlEncode(e=""){return typeof e!="string"?null:e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}static getCSSVendorPrefix(){let e=window.getComputedStyle(window.document.body,""),t=window.Array.prototype.slice.call(e).filter(n=>n.charAt(0)==="-");return t.length?"-"+t[0].split("-")[1]+"-":""}};var ee,Lt,je,u=class{static get EMPTY_ARRAY(){return i(this,ee)}static noop(){}static isNonEmptyString(e){return typeof e=="string"&&!!e.length}static forcedStringSplit(e,s){return typeof e=="string"?e.split(s):new window.Array}static buildArray(e){return o(this,Lt,je).call(this,new window.Array,e)}static buildObject(e){return o(this,Lt,je).call(this,new window.Object,e)}static ensureFunction(e,s=()=>{}){return typeof e=="function"?e:s}static isOf(e,s){return e!=null&&(e.constructor===s||s!=null&&e.constructor.name===s.name)}static hasObjectKeys(e){return!!(e&&!!window.Object.keys(e).length)}static isAssignedObject(e){return typeof e=="object"&&e!==null}static isAssignedArray(e){return typeof e=="object"&&e!==null&&e.constructor.name==="Array"}static isNonEmptyArray(e){return typeof e=="object"&&e!==null&&e.constructor.name==="Array"&&!!e.length}};ee=new WeakMap,Lt=new WeakSet,je=function(e,s){return this.isOf(s,window.Function)&&s(e),e},r(u,Lt),r(u,ee,new window.Array);var ie,N,$e=class{static get UNKNOWN_ERROR(){return i(this,N).call(this,0,e=>"Unknown error.")}static get UNSUPPORTED_FEATURE(){return i(this,N).call(this,1,e=>`Unsupported feature: ${e}.`)}static get UNREGISTERED_CLASS(){return i(this,N).call(this,2,e=>`Unregistered class: ${e}.`)}static get UNREGISTRABLE_CLASS(){return i(this,N).call(this,3,e=>`Unregistrable class: ${e}.`)}static get INVALID_CLASS(){return i(this,N).call(this,4,e=>`Invalid class: ${e}.`)}static get MISNAMED_CLASS(){return i(this,N).call(this,5,e=>`Misnamed class: ${e}.`)}static get INVALID_DEFINITION(){return i(this,N).call(this,10,e=>`Invalid definition: ${e}.`)}static get INVALID_ID(){return i(this,N).call(this,11,e=>`Invalid id: ${e}.`)}static get INVALID_KEY(){return i(this,N).call(this,12,e=>"Call first: this.setElementsStoreKey(<your-valid-key>).")}static get ALLOW_HTML(){return i(this,N).call(this,13,e=>"Call first: this.allowRawContent(true).")}static get INEXISTENT_TEMPLATE(){return i(this,N).call(this,20,e=>`Inexistent template: #${e}.`)}static get EXTINCT_TEMPLATE(){return i(this,N).call(this,21,e=>`Extinct template: #${e}.`)}static get INVALID_TEMPLATE(){return i(this,N).call(this,22,e=>`Invalid template: #${e}.`)}static get UNESPECIFIED_SLOT(){return i(this,N).call(this,30,e=>`Unespecified slot: #${e}.`)}},y=$e;ie=new WeakMap,N=new WeakMap,r(y,ie,"[WUSE:ERROR]"),r(y,N,(e,s)=>({code:e,emit:t=>{let n=`${i($e,ie)} ${e} | ${s(t)}`;if(Wuse.FATALS||e<10)throw new window.Error(n);return window.console.error(n),null}}));var Mt,Ut,xt,Ft,pt=class{constructor(e){d(this,"rounds",0);r(this,Mt,0);r(this,Ut,null);r(this,xt,!1);r(this,Ft,null);f(this,Ft,typeof e=="function"?e:()=>{})}compute(e){return this.rounds+=+f(this,xt,i(this,Mt)==f(this,Ut,i(this,Ft).call(this,e))),f(this,Mt,i(this,Ut)),i(this,xt)}};Mt=new WeakMap,Ut=new WeakMap,xt=new WeakMap,Ft=new WeakMap;var z,jt,ke,Pt=class{constructor(){r(this,jt);r(this,z,new window.Object)}get length(){return o(this,jt,ke).call(this).length}key(e){return o(this,jt,ke).call(this)[e]||null}getItem(e){return i(this,z)[e]}setItem(e,s){i(this,z)[e]=s}removeItem(e){delete i(this,z)[e]}clear(){f(this,z,new window.Object)}hasItem(e){return i(this,z).hasOwnProperty(e)}};z=new WeakMap,jt=new WeakSet,ke=function(){return window.Object.keys(i(this,z))};var rt,K,Z,se,Xe,mt=class{constructor(e,s){r(this,se);r(this,rt,null);r(this,K,null);r(this,Z,null);if(e instanceof Node&&s instanceof Node)f(this,rt,e),f(this,K,s),f(this,Z,s.cloneNode(!1));else throw new Error("[WUSE:ERROR] Wrong arguments supplied.")}get element(){return i(this,K)}affiliate(){i(this,rt).appendChild(i(this,K))}disaffiliate(){i(this,rt).removeChild(i(this,K))}promote(e){i(this,Z).innerHTML=e,i(this,rt).replaceChild(i(this,Z),i(this,K)),o(this,se,Xe).call(this)}};rt=new WeakMap,K=new WeakMap,Z=new WeakMap,se=new WeakSet,Xe=function(){let e=i(this,Z);f(this,Z,i(this,K).cloneNode(!1)),f(this,K,e)};var at,ot,ht=class{constructor(e){d(this,"owner",null);r(this,at,!1);r(this,ot,"");this.owner=e}get invalidated(){return i(this,at)}reset(e){f(this,at,!1),f(this,ot,e)}append(e){f(this,ot,i(this,ot)+e)}verify(e){f(this,at,e(i(this,ot)))}process(){i(this,at)&&this.on_content_invalidation(i(this,ot))}on_content_invalidation(e){}};at=new WeakMap,ot=new WeakMap;var ce,Je,qe,oe,he,wt,ne=p=>p>1e3?(p/1e3).toFixed(2)+"s":p.toFixed(2)+"ms",re=class{constructor(){d(this,"round",0);d(this,"domTime",window.Number.MAX_SAFE_INTEGER);d(this,"renderTime",window.Number.MAX_SAFE_INTEGER)}getDebugInfo(){var e=new window.Object;return e.round=this.round,e.domTime=ne(this.domTime),this.renderTime!==window.Number.MAX_SAFE_INTEGER&&(e.renderTime=ne(this.renderTime)),e}},ae=class{constructor(e){d(this,"name","");d(this,"rounds",0);d(this,"time",0);d(this,"average",0);this.name=e}compute(e){this.rounds++,this.time+=e,this.average=this.time/this.rounds}getDebugInfo(){let e=ne(this.time),s=ne(this.average);return{name:this.name,rounds:this.rounds,spent:e,average:s}}},M=class{static initialize(e){typeof e=="function"&&f(M,wt,e),M.DOMUpdate.overall=new ae("overall-dom-update"),M.BrowserRender.overall=new ae("overall-browser-render")}},O=M;wt=new WeakMap,r(O,wt,()=>{}),d(O,"StopWatch",(qe=class{constructor(){r(this,ce);d(this,"_begin",0);d(this,"_end",{dom:0,render:0});d(this,"rounds",0);d(this,"last",new re);d(this,"best",new re);d(this,"averages",{dom:0,render:0})}start(){(M.DOMUpdate.check||M.BrowserRender.check)&&(this.last.round=++this.rounds,this._begin=performance.now())}stop(e){var s;M.DOMUpdate.check&&(this.best.domTime>(this.last.domTime=(this._end.dom=performance.now())-this._begin)&&(this.best.round=this.last.round,this.best.domTime=this.last.domTime),this.averages.dom=(this.averages.dom*(this.rounds-1)+this.last.domTime)/this.rounds,M.DOMUpdate.overall.compute(this.last.domTime)),M.BrowserRender.check?setTimeout(()=>o(this,ce,Je).bind(this)(e)):e&&i(s=M,wt).call(s,this,"stop")}getDebugInfo(){return{rounds:this.rounds,last:this.last.getDebugInfo(),best:this.best.getDebugInfo(),averages:this.averages}}},ce=new WeakSet,Je=function(e){var s;this.best.renderTime>(this.last.renderTime=(this._end.render=performance.now())-this._begin)&&(this.best.round=this.last.round,this.best.renderTime=this.last.renderTime),this.averages.render=(this.averages.render*(this.rounds-1)+this.last.renderTime)/this.rounds,M.BrowserRender.overall.compute(this.last.renderTime),e&&i(s=M,wt).call(s,this,"finish")},qe)),d(O,"DOMUpdate",(oe=class{},d(oe,"check",!0),d(oe,"overall",null),oe)),d(O,"BrowserRender",(he=class{},d(he,"check",!1),d(he,"overall",null),he));var Et,gt,yt,At,St,le,Ze,de,ti,ue,ei,fe,ii,{noop:$t,ensureFunction:kt,isAssignedObject:Ai,isAssignedArray:Pi,isNonEmptyArray:Qe}=u,Si=p=>p.toLowerCase().replaceAll("_","-"),C=class{static registerClasses(e){Qe(e)&&window.Array.prototype.forEach.call(e,s=>typeof s=="function"?o(this,de,ti).call(this,s):i(this,yt).call(this,s))}static instantiateClasses(e,s){Qe(e)&&window.Array.prototype.forEach.call(e,t=>window.customElements.get(t.tag)?o(this,fe,ii).call(this,t,s):i(this,St).call(this,t.name))}static initialize(e){Ai(e)&&(f(this,Et,kt(e.onDeferredInstantiation,i(this,Et))),f(this,yt,kt(e.onInvalidClass,i(this,yt))),f(this,gt,kt(e.onMisnamedClass,i(this,gt))),f(this,At,kt(e.onUnregistrableClass,i(this,At))),f(this,St,kt(e.onUnregisteredClass,i(this,St))))}};Et=new WeakMap,gt=new WeakMap,yt=new WeakMap,At=new WeakMap,St=new WeakMap,le=new WeakSet,Ze=function(e){window.HTMLElement.isPrototypeOf(e)?window.customElements.define(e.tag,e):i(this,At).call(this,e.name)},de=new WeakSet,ti=function(e){e.name.indexOf("_")>0?(e.tag=Si(e.name),o(this,le,Ze).call(this,e)):i(this,gt).call(this,e.name)},ue=new WeakSet,ei=function(e,s){let t=null;try{t=window.document.querySelector(s)}finally{t=t||window.document.body}t.appendChild(window.document.createElement(e.tag))},fe=new WeakSet,ii=function(e,s){let t=()=>o(this,ue,ei).call(this,e,s);window.document.body?t():i(this,Et).call(this,t)},r(C,le),r(C,de),r(C,ue),r(C,fe),r(C,Et,$t),r(C,gt,$t),r(C,yt,$t),r(C,At,$t),r(C,St,$t);var Tt,me,si,ge,tt,ni,ye,ri,Ae,ai,Se,oi,be,hi,Rt,we,Te,_e,ci,_t,Re,Kt,P,pe,A,Bt,Ie,dt,Gt,zt,D,It,Ht,Nt,ct,et,$,I,T,B,E,Ot,H,V,it,G,Y,Vt,ut,W,st,U,X,q,m,Ct,Yt,ft,k,J,lt,Ne,li,Oe,di,Ce,ui,ve,fi,nt,bt,Wt,Ke,Xt,Be,qt,Ge,De,pi,Jt,ze,Le,mi,Qt,He,Me,wi,L,F,Zt,Ve,vt,Ue,Ei,Dt,Ee,te,Ye,g,xe,Q,Fe,v,x,a=class{static get VERSION(){return"0.3.7"}static blockUpdate(e,s){if(u.isOf(e,Function)){a.DEBUG&&a.debug("blocking"),a.RENDERING=!1;try{e(s)}catch(t){throw t}finally{a.RENDERING=!0,a.DEBUG&&a.debug("unblocking")}}}static debug(e){window.console.log("[WUSE:DEBUG]",e)}static register(e){return C.registerClasses(u.isOf(e,window.Array)?e:new window.Array(e))}static instantiate(e,s){return C.instantiateClasses(u.isOf(e,window.Array)?e:new window.Array(e),s)}static isShadowElement(e){let s=window.Object.getPrototypeOf(e.constructor);return s===a.OpenShadowElement||s===a.ClosedShadowElement}static get elementCount(){return i(a,x).instancesCount}static makeReactiveField(e,s,t,n,c){let h=(R,j)=>window.Object.defineProperty(e,s,{get:R,set:j,enumerable:!0,configurable:!0}),l=()=>delete e[s],w=(R,j)=>a.makeReactiveField(e,s,R,j,c);h(()=>t,R=>{w(R,n),u.isOf(n,window.Function)?n({renderize:j=>c(s,j),automate:()=>w(R,null),freeze:()=>h(()=>R,j=>{}),defreeze:()=>w(R,n),dereact:()=>h(()=>R,j=>{l(),e[s]=j}),remove:()=>l()}):c(s)})}},b=a;g=new WeakMap,xe=new WeakMap,Q=new WeakMap,Fe=new WeakMap,v=new WeakMap,x=new WeakMap,d(b,"WebHelpers",_),d(b,"JsHelpers",u),d(b,"PerformanceMeasurement",O),d(b,"tmp",new window.Object),d(b,"DEBUG",!1),d(b,"FATALS",!1),d(b,"MEASURE",!1),d(b,"RENDERING",!0),r(b,g,(_t=class{static makeStyleNode(e,s){var t=window.document.createElement("style");return u.isNonEmptyString(e)&&t.setAttribute("media",e),u.isNonEmptyString(s)&&t.setAttribute("type",s),t.appendChild(window.document.createTextNode("")),t}static newRule(e,s){let t=u.isOf(e,window.Array)?e.join(","):""+e;return t.length?{selector:t,properties:u.isOf(s,window.Object)?s:i(this,Kt).parse(s),cache:null}:null}static newNestedRule(e,s,t){let n=u.isOf(e,window.Array)?e.join(","):""+e,c=u.isOf(s,window.Array)?s.join(","):""+s;return!n.length||!c.length?null:{selector:n,nested:[{selector:c,properties:u.isOf(t,window.Object)?t:i(this,Kt).parse(t)}],cache:null}}static tryToJoinRules(e,s){if(e.selector===s.selector){for(let t in s.properties)e.properties[t]=s.properties[t];return e.cache=null,!0}return!1}static tryToJoinNestedRules(e,s){return u.isOf(e.nested,window.Array)&&e.selector===s.selector?(s.nested.forEach(t=>{var n=!1;for(let c in e.nested)if(n=e.nested[c].selector===t.selector){for(let h in t.properties)e.nested[c].properties[h]=t.properties[h];break}n||e.nested.push(t)}),e.cache=null,!0):!1}static makeMainNode(e){var s=window.document.createElement(e.tag);if(e.id.length&&s.setAttribute("id",e.id),e.classes.length&&s.setAttribute("class",e.classes.join(" ")),u.hasObjectKeys(e.style)){var t="";for(let n in e.style)t+=n+": "+e.style[n]+"; ";if(t.length){let n=t.trim();s.setAttribute("style",n.endsWith(";")?n.slice(0,-1):n)}}if(u.hasObjectKeys(e.attributes))for(let n in e.attributes)s.setAttribute(n,e.attributes[n]);return s}static newEvent(e,s){return typeof e=="string"&&typeof s=="boolean"?{kind:e,capture:s}:null}static performValidations(e){if(e.kind===S.TEMPLATES_KIND){if(!window.document.getElementById(e.id))return y.INEXISTENT_TEMPLATE.emit(e.id)}else if(e.kind===S.SLOTS_KIND){if(new String(e.attributes.slot).replaceAll('"',"").replaceAll("'","").length===0)return y.UNESPECIFIED_SLOT.emit(e.id)}else if(typeof e.id!="string"||e.id!==""&&window.document.getElementById(e.id)!==null)return y.INVALID_ID.emit(e.id);return e}static newChild(e,s){var t=i(this,Re).parse(e.trimLeft());return t?(t.rules=u.isOf(s,window.Array)?s:new window.Array,t.rendering=!0,t.cache=null,t):y.INVALID_DEFINITION.emit(e)}static newDefinition(){return{kind:S.DEFAULT_KIND,tag:S.DEFAULT_TAG,id:"",classes:new window.Array,attributes:new window.Object,style:new window.Object,events:new window.Array,content:"",encode:!1}}},Re=new WeakMap,Kt=new WeakMap,d(_t,"PartsHolder",(si=class extends window.Array{constructor(s){super();r(this,Tt);d(this,"owner",null);d(this,"last",null);d(this,"version",0);this.owner=s}append(s){u.isOf(s,window.Object)&&(this.push(s),o(this,Tt,me).call(this,s))}prepend(s){u.isOf(s,window.Object)&&(this.unshift(s),o(this,Tt,me).call(this,s))}replace(s,t){s>-1&&u.isOf(t,window.Object)&&o(this,Tt,me).call(this,this[s]=t)}on_version_change(){}persist(){let s=new window.Array;return window.Object.getOwnPropertyNames(this).forEach(t=>{switch(t){case"owner":case"last":case"length":break;case"version":s[t]=this[t];break;default:if(window.Number.isInteger(Number(t))){let n=window.Object.assign(new window.Object,this[t]);n.cache&&(n.cache=null),s.push(n)}break}}),s}restore(s){window.Object.getOwnPropertyNames(s).forEach(t=>{switch(t){case"length":break;case"version":this[t]=s[t];break;default:if(window.Number.isInteger(Number(t))){let n=window.Object.assign(new window.Object,s[t]);n.cache&&(n.cache=null),this.push(n)}break}})}},Tt=new WeakSet,me=function(s){this.last=s,this.version++,this.on_version_change()},si)),r(_t,Re,(tt=class{static parse(e){if(u.isNonEmptyString(e)){var s=i(a,g).newDefinition();return e.charAt(0)==="%"?e.startsWith(S.TEMPLATES_KIND)?o(this,Rt,we).call(this,s,e.replace(s.kind=S.TEMPLATES_KIND,"")):e.startsWith(S.SLOTS_KIND)?o(this,Rt,we).call(this,s,e.replace(s.kind=S.SLOTS_KIND,"")):null:o(this,Rt,we).call(this,s,e)}return null}},ge=new WeakSet,ni=function(e,s){let t=s.indexOf("["),n=s.indexOf("]");if(t>-1&&n>-1&&n>t){let h=s.substr(t,n-t+1),l=h.substr(1,h.length-2).split("|");for(var c in l){let w=l[c].split("=");w[0]==="style"?w[1].split(";").forEach(R=>{let j=R.split(":"),We=j[0].trim();We.length&&(e.style[We]=j[1].trim())}):e.attributes[w[0]]=w[1]}return s.replace(h,"")}return s},ye=new WeakSet,ri=function(e,s){let t=s.indexOf("=");return t>-1?(e.content=s.slice(t+1),!!e.content.length&&e.content.charAt(0)==="&"&&(e.content=e.content.slice(1),e.encode=!!e.content.length&&e.content.charAt(0)!=="&"),s.slice(0,t)):s},Ae=new WeakSet,ai=function(e,s){let t=s.replaceAll("!"," ").split(" ");return t.slice(1).map(n=>{let[c,...h]=n.toLowerCase().split("+"),l=(h||u.EMPTY_ARRAY).indexOf("capture")>-1;e.events.push(i(a,g).newEvent(c,l))}),t[0]},Se=new WeakSet,oi=function(e,s){let t=s.replaceAll("."," ").split(" ");return e.classes=t.slice(1),t[0]},be=new WeakSet,hi=function(e,s){if(s!==""){let t=s.indexOf("#");t===-1?e.tag=s:(t>0&&(e.tag=s.substr(0,t)),e.id=s.substr(t+1))}return e},Rt=new WeakSet,we=function(e,s){return o(this,be,hi).call(this,e,o(this,Se,oi).call(this,e,o(this,Ae,ai).call(this,e,o(this,ye,ri).call(this,e,o(this,ge,ni).call(this,e,s)))))},r(tt,ge),r(tt,ye),r(tt,Ae),r(tt,Se),r(tt,be),r(tt,Rt),tt)),r(_t,Kt,(_e=class{static parse(e){let s=new window.Object;return(u.isOf(e,window.Array)?e:u.forcedStringSplit(e,`
`).map(t=>t.trim()).join("").split(";")).forEach(t=>u.isNonEmptyString(t)&&o(this,Te,ci).call(this,s,t.trim())),s}},Te=new WeakSet,ci=function(e,s){if(!!s.length&&s.indexOf(":")>-1){let[t,...n]=s.split(":"),c=t.trim();if(c.length){let h=n.join(":").trim();e[c]=h.endsWith(";")?h.slice(0,-1):h}}},r(_e,Te),_e)),_t)),r(b,xe,new Pt),d(b,"hashRoutine",e=>{var s=0;for(let t=0;t<e.length;t++)s=(s=(s<<5)-s+e.charCodeAt(t))&s;return s}),r(b,Q,(D=class{static initialize(s,t){i(this,It).initialize(s,t),i(this,Nt).initialize(i(this,It).makeRegExp())}},It=new WeakMap,Ht=new WeakMap,Nt=new WeakMap,r(D,It,(P=class{static initialize(t,n){this.begin=t,this.end=n}},d(P,"begin",null),d(P,"end",null),d(P,"enclose",t=>P.begin+t+P.end),d(P,"makeRegExp",()=>new window.RegExp("(?<="+P.begin+").*?(?="+P.end+")","gs")),P)),r(D,Ht,(pe=class{},d(pe,"rules",(s,t)=>u.buildArray(n=>s.forEach(c=>c.replacements.forEach(h=>h.field===t&&n.push(c))))),d(pe,"children",(s,t)=>u.buildArray(n=>{let c=h=>{let l=w=>w.forEach(R=>R.field===t&&n.push(h));["contents","classes","styles","attributes"].forEach(w=>l(h.replacements[w])),h.rules.forEach(w=>w.replacements.forEach(R=>R.field===t&&n.push(h)))};s.forEach(h=>h.rendering&&c(h))})),pe)),r(D,Nt,(A=class{static initialize(t){f(this,Bt,t)}},Bt=new WeakMap,Ie=new WeakMap,dt=new WeakMap,Gt=new WeakMap,zt=new WeakMap,r(A,Bt,null),r(A,Ie,(t,n,c)=>t.push({at:n,field:c.trim(),find:i(i(a,Q),It).enclose(c)})),r(A,dt,(t,n,c)=>u.isNonEmptyString(c)&&(c.match(i(A,Bt))||u.EMPTY_ARRAY).forEach(h=>{var l;return i(l=A,Ie).call(l,t,n,h)})),r(A,Gt,(t,n,c)=>{var h;t[n]=new window.Array,i(h=A,dt).call(h,t[n],n,c)}),r(A,zt,(t,n,c)=>{t[n]=new window.Array,window.Object.keys(c).forEach(h=>{var l,w;i(l=A,dt).call(l,t[n],n,h),i(w=A,dt).call(w,t[n],n,c[h])})}),d(A,"child",t=>u.buildObject(n=>{var c,h,l,w;i(c=A,Gt).call(c,n,"contents",t.content),i(h=A,Gt).call(h,n,"classes",t.classes.join(" ")),i(l=A,zt).call(l,n,"styles",t.style),i(w=A,zt).call(w,n,"attributes",t.attributes),t.rules.forEach(R=>R.replacements=A.rule(R))})),d(A,"rule",t=>u.buildArray(n=>{var h;if(u.isOf(t.nested,window.Array))return t.nested.map(l=>A.rule(l));var c="";for(let l in t.properties)c+=l+":"+t.properties[l]+";";i(h=A,dt).call(h,n,"rules",c)})),A)),d(D,"extractReplacementsFromRule",i(D,Nt).rule),d(D,"extractReplacementsFromChild",i(D,Nt).child),d(D,"scanRulesForReplacements",i(D,Ht).rules),d(D,"scanChildrenForReplacements",i(D,Ht).children),D)),r(b,Fe,e=>{let s=window.document.getElementById(e);return s===null?y.EXTINCT_TEMPLATE.emit(e):s.tagName!=="TEMPLATE"?y.INVALID_TEMPLATE.emit(e):s.innerHTML}),r(b,v,(ct=class{},d(ct,"cacheInvalidator",e=>e.cache=null),d(ct,"renderingIncluder",e=>e.rendering=!0),d(ct,"renderingExcluder",e=>e.rendering=!1),d(ct,"renderRule",(e,s)=>{if(u.isOf(s.nested,window.Array))return s.selector+"{"+s.nested.map(n=>i(a,v).renderRule(e,n)).join(`
`)+"}";if(s.selector!==""){var t="";for(let n in s.properties)t+=n+":"+s.properties[n]+";";return u.isOf(s.replacements,window.Array)&&!!s.replacements.length&&s.replacements.forEach(n=>t=e(t,n)),s.selector+"{"+t+"}"}return null}),d(ct,"renderChild",(e,s)=>{var c;if(s.kind===S.TEMPLATES_KIND)return i(c=a,Fe).call(c,s.id);if(s.tag===S.TEXTNODE_TAG){var t=s.content;return s.replacements.contents.forEach(h=>t=e(t,h)),s.encode?_.htmlEncode(t):t}var n=u.isNonEmptyString(s.id)?`<${s.tag} id='${s.id}'`:"<"+s.tag;if(s.classes.length){var t=s.classes.join(" ");s.replacements.classes.forEach(l=>t=e(t,l)),n+=` class='${t}'`}if(u.hasObjectKeys(s.style)){var t=" style='";for(let l in s.style)t+=l+": "+s.style[l]+"; ";t+="'",s.replacements.styles.forEach(l=>t=e(t,l)),n+=t}if(u.hasObjectKeys(s.attributes)){var t="";for(let l in s.attributes)t+=" "+l+"="+s.attributes[l];s.replacements.attributes.forEach(l=>t=e(t,l)),n+=t}if(typeof s.content=="string"){var t=s.content;s.replacements.contents.forEach(l=>t=e(t,l)),n+=`>${s.encode?_.htmlEncode(t):t}</${s.tag}>`}else n+="/>";return n}),ct)),r(b,x,(et=class extends window.HTMLElement{constructor(t){super();r(this,J);r(this,Ne);r(this,Oe);r(this,Ce);r(this,ve);r(this,nt);r(this,Wt);r(this,Xt);r(this,qt);r(this,De);r(this,Jt);r(this,Le);r(this,Qt);r(this,Me);r(this,L);r(this,Zt);r(this,Ue);r(this,Dt);r(this,te);r(this,$,"");r(this,I,new class extends i(a,g).PartsHolder{on_version_change(){var t;this.last.version=this.version,this.last.replacements=i(a,Q).extractReplacementsFromRule(this.last),a.DEBUG&&o(t=this.owner,J,lt).call(t,`rules list version change: ${this.version}`)}}(this));r(this,T,new class extends i(a,g).PartsHolder{on_version_change(){var t,n;this.last.version=this.version,this.last.replacements=i(a,Q).extractReplacementsFromChild(this.last),f(t=this.owner,V,i(t,V)|this.last.kind===S.SLOTS_KIND),a.DEBUG&&o(n=this.owner,J,lt).call(n,`children list version change: ${this.version}`)}}(this));r(this,B,new class extends i(a,g).PartsHolder{on_version_change(){var t;a.DEBUG&&o(t=this.owner,J,lt).call(t,`fields list version change: ${this.version}`)}snapshot(){this.forEach(t=>t.value=this.owner[t.name])}recall(){this.forEach(t=>this.owner[t.name]=t.value)}}(this));r(this,E,{mainDefinition:i(a,g).newDefinition(),styleMedia:S.DEFAULT_STYLE_MEDIA,styleType:S.DEFAULT_STYLE_TYPE,rawContent:!1,attributeKeys:!1,elementKeys:!0});r(this,Ot,new window.Object);r(this,H,!1);r(this,V,!1);r(this,it,void 0);r(this,G,void 0);r(this,Y,null);r(this,Vt,a.isShadowElement(this));r(this,ut,!1);r(this,W,!1);r(this,st,i(a,xe));r(this,U,null);r(this,X,"");r(this,q,!1);r(this,m,{root:new class extends ht{on_content_invalidation(t){this.owner.innerHTML=t}}(this),style:new class extends ht{on_content_invalidation(t){i(this.owner,G).promote(t)}}(this),main:new class extends ht{on_content_invalidation(t){i(this.owner,it).promote(t)}}(this),renderizers:{rule:t=>i(this,m).style.append(t.cache?t.cache:t.cache=i(a,v).renderRule(i(this,Ct),t)),children:{mixed:t=>i(this,Vt)&&t.kind===S.SLOTS_KIND?i(this,m).renderizers.children.slot(t):i(this,m).renderizers.children.normal(t),slot:t=>{t.cache||(i(this,m).root.verify(n=>!0),i(this,m).root.append(t.cache=i(a,v).renderChild(i(this,Ct),t)))},normal:t=>{i(this,m).main.append(t.cache?t.cache:t.cache=i(a,v).renderChild(i(this,Ct),t)),t.rules.forEach(i(this,m).renderizers.rule)}}},gotModified:()=>i(this,m).root.invalidated||i(this,m).main.invalidated||i(this,m).style.invalidated,getDebugInfo:()=>`updated (root: ${i(this,m).root.invalidated}, main: ${i(this,m).main.invalidated}, style: ${i(this,m).style.invalidated})`});r(this,Ct,(t,n)=>t.replace(n.find,this[n.field]!==void 0?this[n.field]:""));r(this,Yt,{bind:{key:()=>{let t=n=>{u.isNonEmptyString(n)&&(this[n]=o(this,Wt,Ke).call(this,n))};return i(this,H)&&t(i(this,E).mainDefinition.id),n=>t(n.id)},event:"addEventListener"},unbind:{key:()=>{let t=n=>delete this[n];return i(this,H)&&t(i(this,E).mainDefinition.id),n=>t(n.id)},event:"removeEventListener"}});r(this,ft,{main:new pt(a.hashRoutine),style:new pt(a.hashRoutine)});r(this,k,{attachment:new O.StopWatch,partial:new O.StopWatch,full:new O.StopWatch,dettachment:new O.StopWatch});r(this,vt,()=>i(a,x).EVENT_NAMES.forEach(t=>i(this,Ot)[t]=typeof this[t]=="function"));d(this,"info",{instanceNumber:++i(a,x).instancesCount,unmodifiedRounds:0,updatedRounds:0});f(this,Y,t!==i(a,x).RootMode.REGULAR?this.attachShadow({mode:t}):this),i(this,vt).call(this),o(this,L,F).call(this,"on_create"),i(this,E).attributeKeys&&this.getAttributeNames().forEach(n=>this[n]=this.getAttribute(n)),o(this,Ue,Ei).call(this)&&i(this,U).generation>1?o(this,L,F).call(this,"on_reconstruct",i(this,U)):o(this,L,F).call(this,"on_construct")}static get EVENT_NAMES(){return["on_create","on_construct","on_reconstruct","on_connect","on_inject","on_load","on_prerender","on_update","on_postrender","on_refresh","on_unload","on_reload","on_repaint","on_disconnect"]}get render(){return i(this,W)?o(this,De,pi):u.noop}get redraw(){return i(this,W)?o(this,Le,mi):u.noop}connectedCallback(){a.MEASURE&&i(this,k).attachment.start(),i(this,vt).call(this),o(this,L,F).call(this,"on_connect"),o(this,Jt,ze).call(this,"on_load"),i(this,q)&&this.persistToElementsStore(),a.MEASURE&&i(this,k).attachment.stop(a.DEBUG)}disconnectedCallback(){a.MEASURE&&i(this,k).dettachment.start(),o(this,nt,bt).call(this,!1),o(this,L,F).call(this,"on_disconnect"),a.MEASURE&&i(this,k).dettachment.stop(a.DEBUG)}getElementsStore(){return i(this,st)}setElementsStore(t){f(this,st,t)}hasElementsStoreKey(t){return i(this,q)}getElementsStoreKey(t){return i(this,X)}setElementsStoreKey(t){return f(this,q,u.isNonEmptyString(f(this,X,t))),this}persistToElementsStore(){if(o(this,te,Ye).call(this)){let t=i(this,U);if(t)return i(this,B).snapshot(),t.data=new window.Object({options:i(this,E),html:i(this,$),children:i(this,T).persist(),rules:i(this,I).persist(),fields:i(this,B).persist(),slotted:i(this,V),identified:i(this,H)}),o(this,Dt,Ee).call(this),!0}return!1}restoreFromElementsStore(t){if(o(this,te,Ye).call(this)){let n=i(this,U);if(n&&n.persisted&&n.data)return f(this,E,n.data.options),f(this,V,n.data.slotted),f(this,H,n.data.identified),f(this,$,n.data.html),i(this,T).restore(n.data.children),i(this,T).owner=this,i(this,I).restore(n.data.rules),i(this,I).owner=this,i(this,B).restore(n.data.fields),i(this,B).owner=this,i(this,B).recall(),t||(delete n.data,o(this,Dt,Ee).call(this)),!0}return!1}selectChildElement(t){return i(this,Y).querySelector(t)}setMainAttribute(t,n){i(this,ut)&&i(this,it).element.setAttribute(t,n)}setMainElement(t){let n=i(a,g).newChild(t);if(i(a,g).performValidations(n)){if(n.content!==""||!!n.events.length)return y.INVALID_DEFINITION.emit(t);f(this,H,!!n.id.length)&&(i(this,E).mainDefinition.id=n.id),n.tag.length&&(i(this,E).mainDefinition.tag=n.tag),n.classes.length&&(i(this,E).mainDefinition.classes=n.classes),n.style&&(i(this,E).mainDefinition.style=n.style),n.attributes&&(i(this,E).mainDefinition.attributes=n.attributes)}return this}setStyleOptions(t,n){return i(this,E).styleMedia=t||"",i(this,E).styleType=n||"",this}setElementsAsKeys(t){return i(this,E).elementKeys=!!t,this}setAttributesAsKeys(t){return i(this,E).attributeKeys=!!t,this}allowRawContent(t){return i(this,E).rawContent=!!t,this}setRawContent(t){return i(this,E).rawContent?f(this,$,t):y.ALLOW_HTML.emit(),this}appendRawContent(t){return i(this,E).rawContent?f(this,$,i(this,$)+t):y.ALLOW_HTML.emit(),this}prependRawContent(t){return i(this,E).rawContent?f(this,$,t+i(this,$)):y.ALLOW_HTML.emit(),this}appendCSSRule(t,n,c){if(c)return this.appendCSSNestedRule(t,n,c);let h=i(this,I).slice(-1),l=i(a,g).newRule(t,n);return(!h.length||!i(a,g).tryToJoinRules(h[0],l))&&i(this,I).append(l),this}prependCSSRule(t,n,c){if(c)return this.prependCSSNestedRule(t,n,c);let h=i(this,I).slice(0,1),l=i(a,g).newRule(t,n);return(!h.length||!i(a,g).tryToJoinRules(h[0],l))&&i(this,I).prepend(l),this}appendCSSNestedRule(t,n,c){let h=i(this,I).slice(-1),l=i(a,g).newNestedRule(t,n,c);return(!h.length||!i(a,g).tryToJoinNestedRules(h[0],l))&&i(this,I).append(l),this}prependCSSNestedRule(t,n,c){let h=i(this,I).slice(0,1),l=i(a,g).newNestedRule(t,n,c);return(!h.length||!i(a,g).tryToJoinNestedRules(h[0],l))&&i(this,I).prepend(l),this}appendChildElement(t,n){return i(this,T).append(i(a,g).performValidations(i(a,g).newChild(t,n))),this}prependChildElement(t,n){return i(this,T).prepend(i(a,g).performValidations(i(a,g).newChild(t,n))),this}replaceChildElement(t,n){return i(this,T).replace(i(this,T).findIndex(c=>c.id===t),i(a,g).newChild(n)),this}appendChildElements(t){return(u.isOf(t,window.Array)?t:u.forcedStringSplit(t,`
`)).forEach(n=>typeof n=="string"&&!!n.trim().length&&this.appendChildElement(n)),this}prependChildElements(t){return(u.isOf(t,window.Array)?t:u.forcedStringSplit(t,`
`)).forEach(n=>typeof n=="string"&&!!n.trim().length&&this.prependChildElement(n)),this}checkChildElementIsIncludedById(t,n,c){let h=l=>u.isOf(l,window.Function)?l():void 0;return i(this,T).some(l=>l.id===t&&l.rendering)?h(n):h(c),this}includeChildElementById(t){return i(this,T).forEach(n=>n.id===t&&i(a,v).renderingIncluder(n)),this}excludeChildElementById(t){return i(this,T).forEach(n=>n.id===t&&i(a,v).renderingExcluder(n)),this}invalidateChildElementsById(t){return i(this,T).forEach(n=>t.indexOf(n.id)>-1&&i(a,v).cacheInvalidator(n)),this}invalidateChildElements(t){return u.isOf(t,window.Array)&&t.forEach(i(a,v).cacheInvalidator),this}makeField(t,n){return this[t]=n,i(this,B).append({name:t,value:n}),this}makeReactiveField(t,n,c,h=!0){return o(this,Me,wi).call(this,t,n,c,h)}makeExternalReactiveField(t,n,c,h,l=!0){return this.makeReactiveField(n,t[n]||c,w=>{t[n]=this[n],h(w)},l)}},$=new WeakMap,I=new WeakMap,T=new WeakMap,B=new WeakMap,E=new WeakMap,Ot=new WeakMap,H=new WeakMap,V=new WeakMap,it=new WeakMap,G=new WeakMap,Y=new WeakMap,Vt=new WeakMap,ut=new WeakMap,W=new WeakMap,st=new WeakMap,U=new WeakMap,X=new WeakMap,q=new WeakMap,m=new WeakMap,Ct=new WeakMap,Yt=new WeakMap,ft=new WeakMap,k=new WeakMap,J=new WeakSet,lt=function(t){i(this,H)&&a.debug(`#${i(this,E).mainDefinition.id} (${this.info.instanceNumber}) | ${typeof t=="string"?t:JSON.stringify(t)}`)},Ne=new WeakSet,li=function(){i(this,G)&&i(this,G).affiliate(),i(this,it).affiliate(),f(this,ut,!0)},Oe=new WeakSet,di=function(){f(this,G,i(this,I).length?new mt(i(this,Y),i(a,g).makeStyleNode(i(this,E).styleMedia,i(this,E).styleType)):null),f(this,it,new mt(i(this,Y),i(a,g).makeMainNode(i(this,E).mainDefinition))),i(this,T).forEach(i(a,v).cacheInvalidator),i(this,I).forEach(i(a,v).cacheInvalidator)},Ce=new WeakSet,ui=function(){i(this,ut)&&(i(this,it).disaffiliate(),i(this,G)&&i(this,G).disaffiliate(),i(this,V)&&i(this,Vt)&&_.removeChildren(this)),f(this,ut,!1)},ve=new WeakSet,fi=function(t){return{key:i(this,E).elementKeys&&t.key(),event:(n,c,h)=>{let l=this[`on_${n}_${c}`];if(l){let w=o(this,Wt,Ke).call(this,n);w&&w[t.event](c,l,h)}},slots:()=>this.on_slot_change&&i(this,Y).querySelectorAll("slot").forEach(n=>n[t.event]("slotchange",this.on_slot_change))}},nt=new WeakSet,bt=function(t){if(i(this,W)&&!t||!i(this,W)&&t){let n=o(this,ve,fi).call(this,t?i(this,Yt).bind:i(this,Yt).unbind);i(this,T).forEach(c=>{!c.rendering&&t||(n.key&&n.key(c),c.events.forEach(h=>h&&n.event(c.id,h.kind,h.capture)))}),i(this,V)&&n.slots(),f(this,W,t)}},Wt=new WeakSet,Ke=function(t){return u.isNonEmptyString(t)?i(this,Y).querySelector(`#${t}`):void 0},Xt=new WeakSet,Be=function(){i(this,m).root.reset(""),i(this,m).style.reset(""),i(this,m).main.reset(i(this,$));let t=i(this,V)?i(this,m).renderizers.children.mixed:i(this,m).renderizers.children.normal;i(this,T).forEach(n=>n.rendering&&t(n)),i(this,I).forEach(i(this,m).renderizers.rule),i(this,m).main.verify(n=>!i(this,ft).main.compute(n)),i(this,m).style.verify(n=>!i(this,ft).style.compute(n))},qt=new WeakSet,Ge=function(){i(this,m).root.process(),i(this,m).style.process(),i(this,m).main.process(),a.DEBUG&&o(this,J,lt).call(this,i(this,m).getDebugInfo())},De=new WeakSet,pi=function(){!a.RENDERING||(a.MEASURE&&i(this,k).partial.start(),o(this,L,F).call(this,"on_prerender"),o(this,Xt,Be).call(this),i(this,m).gotModified()?(o(this,nt,bt).call(this,!1),o(this,qt,Ge).call(this),o(this,nt,bt).call(this,!0),this.info.updatedRounds++,o(this,L,F).call(this,"on_update"),o(this,Zt,Ve).call(this,"on_refresh")):this.info.unmodifiedRounds++,a.DEBUG&&o(this,J,lt).call(this,`unmodified: ${this.info.unmodifiedRounds} (main: ${i(this,ft).main.rounds}, style: ${i(this,ft).style.rounds}) | updated: ${this.info.updatedRounds}`),o(this,L,F).call(this,"on_postrender"),a.MEASURE&&i(this,k).partial.stop(a.DEBUG))},Jt=new WeakSet,ze=function(t){o(this,Oe,di).call(this),o(this,Ne,li).call(this),o(this,L,F).call(this,"on_inject"),o(this,Xt,Be).call(this),i(this,m).style.verify(n=>!!i(this,G)),o(this,qt,Ge).call(this),o(this,nt,bt).call(this,!0),o(this,L,F).call(this,t)},Le=new WeakSet,mi=function(t){a.MEASURE&&i(this,k).full.start(),o(this,nt,bt).call(this,!1),o(this,Ce,ui).call(this),o(this,L,F).call(this,"on_unload"),i(this,vt).call(this),o(this,Jt,ze).call(this,"on_reload"),o(this,Zt,Ve).call(this,"on_repaint"),a.MEASURE&&i(this,k).full.stop(a.DEBUG)},Qt=new WeakSet,He=function(t,n="$none"){if(i(this,W)){let c=i(a,Q).scanRulesForReplacements(i(this,I),t);c.forEach(i(a,v).cacheInvalidator);let h=i(a,Q).scanChildrenForReplacements(i(this,T),t);h.forEach(i(a,v).cacheInvalidator),a.DEBUG&&o(this,J,lt).call(this,`reactive render (label: ${n}, field: ${t}, children: ${h.length}, rules: ${c.length})`),(!!c.length||!!h.length)&&(h.some(l=>!!l.kind.length)&&i(this,T).forEach(l=>l.kind===S.SLOTS_KIND?i(a,v).cacheInvalidator(l):void 0),this.render())}},Me=new WeakSet,wi=function(t,n,c,h=!0){return a.makeReactiveField(this,t,n,c,(l,w)=>o(this,Qt,He).call(this,l,w||"$auto")),i(this,B).append({name:t,value:n}),h&&o(this,Qt,He).call(this,t,"$init"),this},L=new WeakSet,F=function(t,n){i(this,Ot)[t]&&this[t].call(this,n)},Zt=new WeakSet,Ve=function(t,n){i(this,q)&&this.persistToElementsStore(),i(this,Ot)[t]&&window.requestAnimationFrame(()=>this[t].call(this,n))},vt=new WeakMap,Ue=new WeakSet,Ei=function(){return i(this,q)?(f(this,U,i(this,st).hasItem(i(this,X))?i(this,st).getItem(i(this,X)):{generation:0,persisted:!1}),i(this,U).generation++,o(this,Dt,Ee).call(this),!0):!1},Dt=new WeakSet,Ee=function(){a.DEBUG&&(i(this,U).key=i(this,X)),i(this,U).persisted=!!i(this,U).data,i(this,st).setItem(i(this,X),i(this,U))},te=new WeakSet,Ye=function(){return i(this,q)?!0:(y.INVALID_KEY.emit(),!1)},d(et,"RootMode",class{static get REGULAR(){return"regular"}static get OPEN(){return"open"}static get CLOSED(){return"closed"}}),d(et,"specializeClass",t=>class extends et{constructor(){super(t)}}),d(et,"instancesCount",0),et)),d(b,"NonShadowElement",i(a,x).specializeClass(i(a,x).RootMode.REGULAR)),d(b,"OpenShadowElement",i(a,x).specializeClass(i(a,x).RootMode.OPEN)),d(b,"ClosedShadowElement",i(a,x).specializeClass(i(a,x).RootMode.CLOSED)),(()=>{let e=(s,t)=>!s&&y.UNSUPPORTED_FEATURE.emit(t);try{e(u.isOf(window.document,window.HTMLDocument),"HTML Document"),e(u.isOf(window.customElements,window.CustomElementRegistry),"Custom Elements"),_.onDOMContentLoaded(()=>e(u.isOf(window.document.body.attachShadow,window.Function),"Shadow DOM"))}catch(s){y.UNKNOWN_ERROR.emit()}O.initialize((s,t)=>a.debug(JSON.stringify(u.buildArray(n=>{switch(n.push({instances:a.elementCount}),n.push(s.getDebugInfo()),t){case"stop":n.push(O.DOMUpdate.overall.getDebugInfo());break;case"finish":n.push(O.BrowserRender.overall.getDebugInfo());break}})))),C.initialize({onMisnamedClass:y.MISNAMED_CLASS.emit,onUnregistrableClass:y.UNREGISTRABLE_CLASS.emit,onUnregisteredClass:y.UNREGISTERED_CLASS.emit,onInvalidClass:y.INVALID_CLASS.emit,onDeferredInstantiation:_.onDOMContentLoaded}),i(a,Q).initialize(S.DEFAULT_REPLACEMENT_OPEN,S.DEFAULT_REPLACEMENT_CLOSE)})(),window.Wuse=b;})();
